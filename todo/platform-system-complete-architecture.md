# ğŸ—ï¸ åœ°å°ç³»ç»Ÿå®Œæ•´æŠ€æœ¯åˆ†ææŠ¥å‘Š

> **æ¨¡å—**: NCustomizedPlatform (åœ°å°/Platform)  
> **åˆ†ææ—¥æœŸ**: 2026-01-22  
> **æºç æ–‡ä»¶**: dist/core-hs.fe5726b7.bundle_dewebpack/  
> **çŠ¶æ€**: âœ… å®Œæ•´ç‰ˆï¼ˆæ— çœç•¥ï¼‰

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [æ ¸å¿ƒæ¶æ„](#æ ¸å¿ƒæ¶æ„)
3. [Sketchåˆ°Brepè½¬æ¢ç®—æ³•](#sketchåˆ°brepè½¬æ¢ç®—æ³•)
4. [æ ¸å¿ƒç®—æ³•è¯¦è§£](#æ ¸å¿ƒç®—æ³•è¯¦è§£)
5. [å®Œæ•´å·¥ä½œæµç¨‹](#å®Œæ•´å·¥ä½œæµç¨‹)
6. [æ•°æ®ç»“æ„è®¾è®¡](#æ•°æ®ç»“æ„è®¾è®¡)
7. [æºç ç´¢å¼•](#æºç ç´¢å¼•)
8. [APIå‚è€ƒ](#apiå‚è€ƒ)

---

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

### ä»€ä¹ˆæ˜¯åœ°å°ç³»ç»Ÿï¼Ÿ

**åœ°å°ç³»ç»Ÿ**æ˜¯åŸºäº**Sketchè‰å›¾**å’Œ**Brepè¾¹ç•Œè¡¨ç¤º**çš„3Då»ºæ¨¡ç³»ç»Ÿï¼Œç”¨äºåˆ›å»ºå„ç§é«˜åº¦çš„å¹³å°ç»“æ„ï¼ˆåœ°å°ã€å°é˜¶ã€æ¦»æ¦»ç±³ç­‰ï¼‰ã€‚

**æ ¸å¿ƒç‰¹ç‚¹**:
- âœ… **è‰å›¾é©±åŠ¨**: åŸºäº2Dè‰å›¾è‡ªåŠ¨ç”Ÿæˆ3Dæ¨¡å‹
- âœ… **å¤šé¢æ‹‰ä¼¸**: æ”¯æŒä¸åŒåŒºåŸŸä¸åŒé«˜åº¦çš„æ‹‰ä¼¸
- âœ… **å†…å®¹é™„ç€**: è‡ªåŠ¨è°ƒæ•´å¹³å°ä¸Šç‰©ä½“çš„é«˜åº¦
- âœ… **å®æ—¶é¢„è§ˆ**: è‰å›¾ä¿®æ”¹åè‡ªåŠ¨é‡æ–°ç”ŸæˆBrep
- âœ… **æè´¨æ˜ å°„**: æ”¯æŒè‰å›¾é¢åˆ°Brepé¢çš„æè´¨å…³è”

**æŠ€æœ¯æ ˆ**:
```
Sketch2D (è‰å›¾) â†’ Brepç”Ÿæˆå¼•æ“ â†’ 3D Shell â†’ æè´¨æ˜ å°„ â†’ æœ€ç»ˆæ¨¡å‹
```

---

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„

### ç³»ç»Ÿå…¨æ™¯å›¾ï¼ˆå®Œæ•´ç‰ˆï¼Œæ— çœç•¥ï¼‰

```
åœ°å°ç³»ç»Ÿæ¶æ„ (Platform System Architecture)
â”‚
â”œâ”€ ğŸ“ 1. Sketchè‰å›¾å±‚ (Sketch Layer)
â”‚   â”‚
â”‚   â”œâ”€ DecorateSketch2d (è£…é¥°è‰å›¾)
â”‚   â”‚   â”œâ”€ faces: SketchFace[] - è‰å›¾é¢åˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€ id: string - é¢ID
â”‚   â”‚   â”‚   â”œâ”€ outerLoop: SketchLoop - å¤–è½®å»“
â”‚   â”‚   â”‚   â”œâ”€ innerLoops: SketchLoop[] - å†…å­”æ´
â”‚   â”‚   â”‚   â””â”€ bound: BoundingBox - åŒ…å›´ç›’
â”‚   â”‚   â”œâ”€ convert3dMatrix: Matrix4 - 3Då˜æ¢çŸ©é˜µ
â”‚   â”‚   â”œâ”€ background: SketchBackground - èƒŒæ™¯åŒºåŸŸ
â”‚   â”‚   â”‚   â””â”€ regions: Region[] - åŒºåŸŸåˆ—è¡¨
â”‚   â”‚   â”œâ”€ getExtrusionValue(faceId) - è·å–æ‹‰ä¼¸é«˜åº¦
â”‚   â”‚   â”œâ”€ signalDirty: Signal - è„æ ‡è®°ä¿¡å·
â”‚   â”‚   â”œâ”€ face2dCopied: Signal - é¢å¤åˆ¶ä¿¡å·
â”‚   â”‚   â””â”€ signalBuildComplete: Signal - æ„å»ºå®Œæˆä¿¡å·
â”‚   â”‚
â”‚   â”œâ”€ SketchLoop (è‰å›¾å¾ªç¯)
â”‚   â”‚   â”œâ”€ curves: Curve2d[] - æ›²çº¿åˆ—è¡¨
â”‚   â”‚   â”œâ”€ bound: BoundingBox - åŒ…å›´ç›’
â”‚   â”‚   â”œâ”€ getDiscretePoints() - è·å–ç¦»æ•£ç‚¹
â”‚   â”‚   â”œâ”€ isAnticlockwise() - æ˜¯å¦é€†æ—¶é’ˆ
â”‚   â”‚   â””â”€ reversed() - åè½¬æ–¹å‘
â”‚   â”‚
â”‚   â””â”€ SketchEncoder (è‰å›¾ç¼–ç å™¨)
â”‚       â”œâ”€ generateEncodedSketchFaces() - ç”Ÿæˆç¼–ç é¢
â”‚       â””â”€ è¿”å›: EncodedSketchFace[]
â”‚           â”œâ”€ id: string - é¢ID
â”‚           â”œâ”€ face2d: SketchFace - 2Dé¢
â”‚           â””â”€ value: number - æ‹‰ä¼¸é«˜åº¦
â”‚
â”œâ”€ ğŸ”„ 2. Brepè½¬æ¢å±‚ (Brep Conversion Layer)
â”‚   â”‚
â”‚   â”œâ”€ Sketch2BrepHelper (æ ¸å¿ƒè½¬æ¢å¼•æ“) â­
â”‚   â”‚   â”œâ”€ generateBrep(sketch, faceShells) - ç”ŸæˆBrep
â”‚   â”‚   â”‚   â”œâ”€ è¾“å…¥: DecorateSketch2d, Shell[]
â”‚   â”‚   â”‚   â””â”€ è¾“å‡º: {brep: Shell, faceShells: Shell[]}
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€ æ ¸å¿ƒç®—æ³•æµç¨‹:
â”‚   â”‚   â”‚   â”œâ”€ æ­¥éª¤1: ç¼–ç è‰å›¾é¢ (SketchEncoder)
â”‚   â”‚   â”‚   â”œâ”€ æ­¥éª¤2: å¤„ç†å·²æœ‰Shell (å¤ç”¨/å…‹éš†)
â”‚   â”‚   â”‚   â”œâ”€ æ­¥éª¤3: ç”Ÿæˆæ–°Shell (sketchFace2BrepShell)
â”‚   â”‚   â”‚   â”œâ”€ æ­¥éª¤4: PullPushæ‹‰ä¼¸ (ShellEdit.pullPushFace)
â”‚   â”‚   â”‚   â”œâ”€ æ­¥éª¤5: åˆå¹¶æ‰€æœ‰Shell (facesAndShellsMerge)
â”‚   â”‚   â”‚   â”œâ”€ æ­¥éª¤6: æ¸…ç†èƒŒæ™¯è¾¹ (clearMergedBreps)
â”‚   â”‚   â”‚   â””â”€ æ­¥éª¤7: é‡å»ºBrepåç§° (reconstructBrepNames)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€ calcSketchBrepMp(shell, sketch) - è®¡ç®—æ˜ å°„å…³ç³»
â”‚   â”‚   â”‚   â”œâ”€ é¡¶ç‚¹æ˜ å°„ (Vertex â†’ SketchPoint)
â”‚   â”‚   â”‚   â”œâ”€ è¾¹æ˜ å°„ (Edge â†’ SketchCurve)
â”‚   â”‚   â”‚   â”œâ”€ é¢æ˜ å°„ (Face â†’ SketchFace)
â”‚   â”‚   â”‚   â””â”€ å¹³æ»‘è¾¹æ˜ å°„ (ContinuousEdge â†’ Arc)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€ matchFace(polygon, sketchFaces) - é¢åŒ¹é…
â”‚   â”‚   â”‚   â”œâ”€ ä¸­å¿ƒç‚¹åŒ¹é…
â”‚   â”‚   â”‚   â””â”€ è¾¹ç•Œç‚¹éªŒè¯
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€ fittingContEdge(contEdge) - å¹³æ»‘è¾¹æ‹Ÿåˆ
â”‚   â”‚   â”‚   â”œâ”€ è®¡ç®—ä¸­ç‚¹å’Œåˆ‡çº¿
â”‚   â”‚   â”‚   â”œâ”€ æ±‚äº¤ç‚¹
â”‚   â”‚   â”‚   â””â”€ ç”Ÿæˆåœ†å¼§
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€ matchArcsByPts(points, curves) - åœ†å¼§åŒ¹é…
â”‚   â”‚   â”‚   â”œâ”€ åŒ¹é…Circle2d
â”‚   â”‚   â”‚   â””â”€ åŒ¹é…CircleArc2d
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€ clearMergedBreps(shells, backgroundCurves) - æ¸…ç†èƒŒæ™¯è¾¹
â”‚   â”‚   â”‚   â”œâ”€ è¯†åˆ«Z=0çš„è¾¹
â”‚   â”‚   â”‚   â”œâ”€ è¿‡æ»¤èƒŒæ™¯æ›²çº¿
â”‚   â”‚   â”‚   â””â”€ åˆ é™¤å¤šä½™è¾¹å’Œé¢
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€ isSketchBackgroundCurve(edge, curves) - èƒŒæ™¯æ›²çº¿åˆ¤æ–­
â”‚   â”‚       â”œâ”€ æ›²çº¿é‡å æ£€æµ‹
â”‚   â”‚       â””â”€ ä½ç½®åˆ¤æ–­ (IN/OUT/ON)
â”‚   â”‚
â”‚   â””â”€ SketchHelper (è‰å›¾è¾…åŠ©å·¥å…·)
â”‚       â”œâ”€ sketchFace2BrepShell(face2d) - 2Dé¢è½¬Shell
â”‚       â”œâ”€ extract3DFaceCurvesFromSketch(sketch) - æå–3Dæ›²çº¿
â”‚       â”œâ”€ matchCurve(curve, sketchCurves) - æ›²çº¿åŒ¹é…
â”‚       â””â”€ SketchTolerance: å®¹å·®é…ç½®
â”‚
â”œâ”€ ğŸ¨ 3. æ¨¡å‹å±‚ (Model Layer)
â”‚   â”‚
â”‚   â”œâ”€ NCustomizedPlatform (æ–°ç‰ˆåœ°å°) â­
â”‚   â”‚   â”œâ”€ ç»§æ‰¿: NCustomizedSketchModel
â”‚   â”‚   â”œâ”€ sketch: DecorateSketch2d - å…³è”è‰å›¾
â”‚   â”‚   â”œâ”€ breps: Shell[] - Brepå®ä½“åˆ—è¡¨
â”‚   â”‚   â”œâ”€ faceShells: Shell[] - é¢Shellç¼“å­˜
â”‚   â”‚   â”œâ”€ signalHook: SignalHook - ä¿¡å·é’©å­
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€ æ ¸å¿ƒæ–¹æ³•:
â”‚   â”‚   â”‚   â”œâ”€ generateBrep(force) - ç”ŸæˆBrep
â”‚   â”‚   â”‚   â”‚   â”œâ”€ åˆå§‹åŒ–å†…å®¹ä½ç½®
â”‚   â”‚   â”‚   â”‚   â”œâ”€ è°ƒç”¨Sketch2BrepHelper
â”‚   â”‚   â”‚   â”‚   â”œâ”€ æ˜ å°„è‰å›¾é¢åˆ°Shell
â”‚   â”‚   â”‚   â”‚   â”œâ”€ PullPushæ‹‰ä¼¸ä¸åŒé«˜åº¦
â”‚   â”‚   â”‚   â”‚   â”œâ”€ åº”ç”¨å˜æ¢çŸ©é˜µ
â”‚   â”‚   â”‚   â”‚   â””â”€ æ›´æ–°æè´¨æ˜ å°„
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€ onSketchDirty(event) - è‰å›¾å˜åŒ–å“åº”
â”‚   â”‚   â”‚   â”‚   â””â”€ è§¦å‘generateBrepé‡å»º
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€ moveAttachedContents(type, offset) - ç§»åŠ¨é™„ç€å†…å®¹
â”‚   â”‚   â”‚   â”‚   â”œâ”€ éå†å¹³å°ä¸Šçš„ç‰©ä½“
â”‚   â”‚   â”‚   â”‚   â”œâ”€ ç‚¹åœ¨å¤šè¾¹å½¢åˆ¤æ–­
â”‚   â”‚   â”‚   â”‚   â””â”€ æ›´æ–°ç‰©ä½“Zåæ ‡
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€ initializeContentPositionBySketch() - åˆå§‹åŒ–ä½ç½®
â”‚   â”‚   â”‚   â”‚   â”œâ”€ è®¡ç®—è‰å›¾åŒ…å›´ç›’
â”‚   â”‚   â”‚   â”‚   â”œâ”€ åº”ç”¨å˜æ¢çŸ©é˜µ
â”‚   â”‚   â”‚   â”‚   â””â”€ æ›´æ–°XYZå°ºå¯¸
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€ getSketchTransformMatrix() - è·å–å˜æ¢çŸ©é˜µ
â”‚   â”‚   â”‚   â”‚   â”œâ”€ è¯»å–convert3dMatrix
â”‚   â”‚   â”‚   â”‚   â”œâ”€ è®¡ç®—ä¸­å¿ƒç‚¹
â”‚   â”‚   â”‚   â”‚   â””â”€ ç”Ÿæˆå¹³ç§»çŸ©é˜µ
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€ calcShellSketchFaceMp(shell, faces) - è®¡ç®—é¢æ˜ å°„
â”‚   â”‚   â”‚   â”‚   â”œâ”€ éå†ç¼–ç é¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€ æŒ‰æ‹‰ä¼¸é«˜åº¦æ’åº
â”‚   â”‚   â”‚   â”‚   â””â”€ è¿”å›æ˜ å°„åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€ getBottomProjectionPlane() - è·å–åº•é¢æŠ•å½±å¹³é¢
â”‚   â”‚   â”‚   â”‚   â””â”€ Z = -ZSize (è´Ÿé«˜åº¦)
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€ mirror(mirrorInfo) - é•œåƒæ“ä½œ
â”‚   â”‚   â”‚       â”œâ”€ é•œåƒè‰å›¾
â”‚   â”‚   â”‚       â”œâ”€ é‡ç½®å˜æ¢çŸ©é˜µ
â”‚   â”‚   â”‚       â””â”€ è°ƒç”¨çˆ¶ç±»é•œåƒ
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€ ç”Ÿå‘½å‘¨æœŸ:
â”‚   â”‚       â”œâ”€ constructor() - åˆ›å»ºä¿¡å·é’©å­
â”‚   â”‚       â”œâ”€ bindSketchSignal() - ç»‘å®šè‰å›¾ä¿¡å·
â”‚   â”‚       â”œâ”€ onSketchDirty() - è‰å›¾å˜åŒ–
â”‚   â”‚       â””â”€ remove() - ç§»é™¤æ—¶æ¸…ç†
â”‚   â”‚
â”‚   â”œâ”€ CustomizedPlatform (æ—§ç‰ˆåœ°å°)
â”‚   â”‚   â”œâ”€ ç»§æ‰¿: CustomizedFeatureModel
â”‚   â”‚   â”œâ”€ _getZOffsetScale() - Zåç§»ç¼©æ”¾ 
return 0
â”‚   â”‚   â”œâ”€ onSketchDirty() - è‰å›¾å˜åŒ–å“åº”
â”‚   â”‚   â””â”€ moveAttachedContents() - ç§»åŠ¨é™„ç€å†…å®¹
â”‚   â”‚
â”‚   â””â”€ NCustomizedSketchModel (è‰å›¾æ¨¡å‹åŸºç±»)
â”‚       â”œâ”€ sketch: DecorateSketch2d - è‰å›¾å¯¹è±¡
â”‚       â”œâ”€ breps: Shell[] - Brepåˆ—è¡¨
â”‚       â”œâ”€ faceShells: Shell[] - é¢Shellç¼“å­˜
â”‚       â”œâ”€ defaultmaterialmap: Map - é»˜è®¤æè´¨æ˜ å°„
â”‚       â”œâ”€ facematerialmap: Map - é¢æè´¨æ˜ å°„
â”‚       â”‚
â”‚       â”œâ”€ æ ¸å¿ƒæ–¹æ³•:
â”‚       â”‚   â”œâ”€ generateBrep(force) - ç”ŸæˆBrep (åŸºç¡€å®ç°)
â”‚       â”‚   â”œâ”€ generateBrepBefore(force) - æ—§ç‰ˆç”Ÿæˆæ–¹æ³•
â”‚       â”‚   â”œâ”€ generateSketchShells() - ç”Ÿæˆè‰å›¾Shell
â”‚       â”‚   â”œâ”€ generateSketchShellsFromOrigin() - ä»åŸç‚¹ç”Ÿæˆ
â”‚       â”‚   â”œâ”€ pullPushSketchFaces(faces, shells) - æ‹‰ä¼¸è‰å›¾é¢
â”‚       â”‚   â”œâ”€ extract3DCurvesFromSketch() - æå–3Dæ›²çº¿
â”‚       â”‚   â”œâ”€ calcShellSketchFaceMp(shell, faces) - è®¡ç®—æ˜ å°„
â”‚       â”‚   â”œâ”€ updateMaterialMpBysketchAssoc() - æ›´æ–°æè´¨æ˜ å°„
â”‚       â”‚   â”œâ”€ onCopyFace2d(event) - é¢å¤åˆ¶å“åº”
â”‚       â”‚   â”œâ”€ extractSketchFaceRelatedMaterials() - æå–ç›¸å…³æè´¨
â”‚       â”‚   â”œâ”€ extractCopySketchFaceAsso() - æå–å¤åˆ¶å…³è”
â”‚       â”‚   â””â”€ dirtyGeometry() - æ ‡è®°å‡ ä½•è„
â”‚       â”‚
â”‚       â””â”€ ä¿¡å·ç³»ç»Ÿ:
â”‚           â”œâ”€ signalSketchDirty - è‰å›¾è„ä¿¡å·
â”‚           â”œâ”€ signalBrepChanged - Brepå˜åŒ–ä¿¡å·
â”‚           â””â”€ _sketchSignalHook - ä¿¡å·é’©å­
â”‚
â”œâ”€ ğŸ”§ 4. Brepæ“ä½œå±‚ (Brep Operations Layer)
â”‚   â”‚
â”‚   â”œâ”€ ShellEdit (Shellç¼–è¾‘å™¨) - Brepæ ¸å¿ƒç®—æ³•
â”‚   â”‚   â”œâ”€ pullPushFace(face, direction, shells) - æ‹‰ä¼¸/æ¨åŠ¨é¢ â­
â”‚   â”‚   â”‚   â”œâ”€ è¾“å…¥:
â”‚   â”‚   â”‚   â”‚   â”œâ”€ face: Face - è¦æ“ä½œçš„é¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€ direction: Vector3 - æ‹‰ä¼¸æ–¹å‘å’Œè·ç¦»
â”‚   â”‚   â”‚   â”‚   â””â”€ shells: Shell[] - ç›¸å…³Shellåˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€ è¾“å‡º:
â”‚   â”‚   â”‚   â”‚   â”œâ”€ modifiedShellsMap: Map<Shell, Shell> - ä¿®æ”¹æ˜ å°„
â”‚   â”‚   â”‚   â”‚   â””â”€ errorStr: string - é”™è¯¯ä¿¡æ¯
â”‚   â”‚   â”‚   â””â”€ ç®—æ³•:
â”‚   â”‚   â”‚       â”œâ”€ è¯†åˆ«é¢çš„è¾¹ç•Œ
â”‚   â”‚   â”‚       â”œâ”€ åˆ›å»ºæ‹‰ä¼¸å‘é‡
â”‚   â”‚   â”‚       â”œâ”€ ç”Ÿæˆä¾§é¢
â”‚   â”‚   â”‚       â”œâ”€ æ›´æ–°æ‹“æ‰‘å…³ç³»
â”‚   â”‚   â”‚       â””â”€ è¿”å›æ–°Shell
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€ facesAndShellsMerge(faces, shells, merge) - åˆå¹¶é¢å’ŒShell â­
â”‚   â”‚   â”‚   â”œâ”€ è¾“å…¥:
â”‚   â”‚   â”‚   â”‚   â”œâ”€ faces: Face[] - è¦åˆå¹¶çš„é¢åˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€ shells: Shell[] - è¦åˆå¹¶çš„Shellåˆ—è¡¨
â”‚   â”‚   â”‚   â”‚   â””â”€ merge: boolean - æ˜¯å¦åˆå¹¶
â”‚   â”‚   â”‚   â”œâ”€ è¾“å‡º:
â”‚   â”‚   â”‚   â”‚   â”œâ”€ modifiedShellsMap: Map<Shell, Shell>
â”‚   â”‚   â”‚   â”‚   â””â”€ errorStr: string
â”‚   â”‚   â”‚   â””â”€ ç®—æ³•:
â”‚   â”‚   â”‚       â”œâ”€ æ”¶é›†æ‰€æœ‰é¢å’Œè¾¹
â”‚   â”‚   â”‚       â”œâ”€ æ£€æµ‹ç›¸é‚»å…³ç³»
â”‚   â”‚   â”‚       â”œâ”€ åˆå¹¶å…±äº«è¾¹
â”‚   â”‚   â”‚       â”œâ”€ ç”Ÿæˆç»Ÿä¸€Shell
â”‚   â”‚   â”‚       â””â”€ é‡å»ºæ‹“æ‰‘
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€ addEdges(curves, shells, plane) - æ·»åŠ è¾¹
â”‚   â”‚   â”‚   â”œâ”€ åœ¨æŒ‡å®šå¹³é¢ä¸Šæ·»åŠ æ›²çº¿
â”‚   â”‚   â”‚   â”œâ”€ ç”Ÿæˆæ–°çš„Shell
â”‚   â”‚   â”‚   â””â”€ è¿”å›æ·»åŠ çš„Shellåˆ—è¡¨
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€ deleteFacesAndEdges(faces, edges) - åˆ é™¤é¢å’Œè¾¹
â”‚   â”‚       â”œâ”€ åˆ é™¤æŒ‡å®šçš„é¢
â”‚   â”‚       â”œâ”€ åˆ é™¤æŒ‡å®šçš„è¾¹
â”‚   â”‚       â””â”€ æ›´æ–°Shellæ‹“æ‰‘
â”‚   â”‚
â”‚   â”œâ”€ ShellBuilder (Shellæ„å»ºå™¨)
â”‚   â”‚   â””â”€ createFacesFromCurves(plane, curves, options) - ä»æ›²çº¿åˆ›å»ºé¢
â”‚   â”‚       â”œâ”€ è¾“å…¥:
â”‚   â”‚       â”‚   â”œâ”€ plane: Plane - æ„å»ºå¹³é¢
â”‚   â”‚       â”‚   â”œâ”€ curves: Curve3d[][] - æ›²çº¿åˆ—è¡¨
â”‚   â”‚       â”‚   â””â”€ options: {checkOverlap: boolean}
â”‚   â”‚       â”œâ”€ ç®—æ³•:
â”‚   â”‚       â”‚   â”œâ”€ æŠ•å½±æ›²çº¿åˆ°å¹³é¢
â”‚   â”‚       â”‚   â”œâ”€ æ„å»ºå¾ªç¯ (Loop)
â”‚   â”‚       â”‚   â”œâ”€ æ£€æµ‹é‡å  (å¯é€‰)
â”‚   â”‚       â”‚   â”œâ”€ åˆ›å»ºé¢ (Face)
â”‚   â”‚       â”‚   â””â”€ ç”ŸæˆShell
â”‚   â”‚       â””â”€ è¾“å‡º:
â”‚   â”‚           â”œâ”€ addShells: Shell[]
â”‚   â”‚           â””â”€ errorStr: string
â”‚   â”‚
â”‚   â”œâ”€ BRepCalculateProject (BrepæŠ•å½±è®¡ç®—)
â”‚   â”‚   â””â”€ face(face, coordinate) - é¢æŠ•å½±
â”‚   â”‚       â”œâ”€ å°†3Dé¢æŠ•å½±åˆ°2Dåæ ‡ç³»
â”‚   â”‚       â”œâ”€ è¿”å›Polygonæˆ–PolyCurve
â”‚   â”‚       â””â”€ ç”¨äºè‰å›¾é¢åŒ¹é…
â”‚   â”‚
â”‚   â””â”€ Continuous (è¿ç»­æ€§å·¥å…·)
â”‚       â”œâ”€ ContinuousUtil.getAllInteractiveFaces(shell) - è·å–äº¤äº’é¢
â”‚       â”œâ”€ ContinuousUtil.getAllInteractiveEdges(shell) - è·å–äº¤äº’è¾¹
â”‚       â””â”€ ç”¨äºè¯†åˆ«å¹³æ»‘è¾¹å’Œå¹³æ»‘é¢
â”‚
â”œâ”€ ğŸ“Š 5. æè´¨ç®¡ç†å±‚ (Material Management Layer)
â”‚   â”‚
â”‚   â”œâ”€ SketchBrepNameHelper (Sketch-Brepåç§°åŠ©æ‰‹)
â”‚   â”‚   â””â”€ reconstructBrepNames(shells, sketch) - é‡å»ºBrepåç§°
â”‚   â”‚       â”œâ”€ éå†Shellä¸­çš„æ‰€æœ‰é¢
â”‚   â”‚       â”œâ”€ æ ¹æ®è‰å›¾é¢IDè®¾ç½®tag
â”‚   â”‚       â”œâ”€ ç»´æŠ¤Sketchåˆ°Brepçš„æ˜ å°„å…³ç³»
â”‚   â”‚       â””â”€ ç”¨äºæè´¨æ˜ å°„å’Œé¢é€‰æ‹©
â”‚   â”‚
â”‚   â”œâ”€ æè´¨æ˜ å°„æµç¨‹:
â”‚   â”‚   â”œâ”€ æ­¥éª¤1: calcSketchBrepMp() - è®¡ç®—æ˜ å°„å…³ç³»
â”‚   â”‚   â”‚   â”œâ”€ sketchBrepMp: Map<sketchComId, BrepElements[]>
â”‚   â”‚   â”‚   â””â”€ å…³è”è‰å›¾ç»„ä»¶åˆ°Brepå…ƒç´ 
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€ æ­¥éª¤2: updateMaterialMpBysketchAssoc() - æ›´æ–°æè´¨æ˜ å°„
â”‚   â”‚   â”‚   â”œâ”€ è¯»å–defaultmaterialmap
â”‚   â”‚   â”‚   â”œâ”€ è¯»å–facematerialmap
â”‚   â”‚   â”‚   â”œâ”€ åº”ç”¨åˆ°Brepé¢
â”‚   â”‚   â”‚   â””â”€ è§¦å‘æè´¨æ›´æ–°ä¿¡å·
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€ æ­¥éª¤3: é¢å¤åˆ¶æ—¶çš„æè´¨ç»§æ‰¿
â”‚   â”‚       â”œâ”€ onCopyFace2d() å“åº”å¤åˆ¶äº‹ä»¶
â”‚   â”‚       â”œâ”€ extractSketchFaceRelatedMaterials() æå–æè´¨
â”‚   â”‚       â”œâ”€ extractCopySketchFaceAsso() å»ºç«‹å…³è”
â”‚   â”‚       â””â”€ æ›´æ–°æè´¨æ˜ å°„è¡¨
â”‚   â”‚
â”‚   â””â”€ è£…é¥°å…ƒç´ åŒæ­¥:
â”‚       â”œâ”€ ç¯æ§½ (LightSlot) - pathCoedge3dsTagsæ˜ å°„
â”‚       â”œâ”€ çº¿æ¡ (Molding) - relyerId + pathCoedge3dsTags
â”‚       â””â”€ ç¯å¸¦ (LightBand) - relyerId + pathCoedge3dsTags
â”‚
â””â”€ ğŸ”Œ 6. IOå±‚ (Input/Output Layer)
    â”‚
    â”œâ”€ NCustomizedPlatform_IO (åœ°å°IO)
    â”‚   â”œâ”€ dump(entity, callback, includeChildren, context) - åºåˆ—åŒ–
    â”‚   â”‚   â”œâ”€ è°ƒç”¨çˆ¶ç±»dump
    â”‚   â”‚   â”œâ”€ æ‰§è¡Œå›è°ƒ
    â”‚   â”‚   â””â”€ è¿”å›JSONæ•°æ®
    â”‚   â”‚
    â”‚   â””â”€ load(entity, data, context) - ååºåˆ—åŒ–
    â”‚       â”œâ”€ è°ƒç”¨çˆ¶ç±»load
    â”‚       â”œâ”€ åŠ è½½è‰å›¾ (sketchId)
    â”‚       â”œâ”€ ç»‘å®šè‰å›¾ä¿¡å·
    â”‚       â””â”€ ç”ŸæˆBrep (å¯é€‰)
    â”‚
    â””â”€ NCustomizedSketchModel_IO (è‰å›¾æ¨¡å‹IOåŸºç±»)
        â”œâ”€ dump(entity, callback, includeChildren, context)
        â”‚   â”œâ”€ åºåˆ—åŒ–sketchId
        â”‚   â””â”€ è°ƒç”¨å›è°ƒ
        â”‚
        â””â”€ load(entity, data, context)
            â”œâ”€ åŠ è½½è‰å›¾å¯¹è±¡
            â”œâ”€ ç»‘å®šä¿¡å·
            â””â”€ ç”ŸæˆBrep
```

---

## ğŸ”„ Sketchåˆ°Brepè½¬æ¢ç®—æ³•

### ç®—æ³•æ¦‚è¿°

**Sketch2Brepè½¬æ¢**æ˜¯åœ°å°ç³»ç»Ÿçš„æ ¸å¿ƒç®—æ³•ï¼Œå°†2Dè‰å›¾è½¬æ¢ä¸º3Dè¾¹ç•Œè¡¨ç¤ºæ¨¡å‹ã€‚

**è½¬æ¢æµç¨‹å›¾**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¾“å…¥: DecorateSketch2d + å·²æœ‰faceShells                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤1: ç¼–ç è‰å›¾é¢ (SketchEncoder)                          â”‚
â”‚  - generateEncodedSketchFaces()                             â”‚
â”‚  - è¾“å‡º: EncodedSketchFace[]                                â”‚
â”‚    â”œâ”€ id: é¢ID                                              â”‚
â”‚    â”œâ”€ face2d: è‰å›¾é¢å¯¹è±¡                                    â”‚
â”‚    â””â”€ value: æ‹‰ä¼¸é«˜åº¦                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤2: å¤„ç†å·²æœ‰Shell (å¤ç”¨æœºåˆ¶)                            â”‚
â”‚  - éå†ç¼–ç é¢                                                â”‚
â”‚  - æŸ¥æ‰¾userDat.idåŒ¹é…çš„Shell                                â”‚
â”‚  - å¦‚æœæ‰¾åˆ°:                                                 â”‚
â”‚    â”œâ”€ æ·»åŠ åˆ°ç»“æœåˆ—è¡¨                                         â”‚
â”‚    â”œâ”€ å…‹éš†Shell (update=false)                              â”‚
â”‚    â””â”€ æ·»åŠ åˆ°ç¼“å­˜åˆ—è¡¨                                         â”‚
â”‚  - å¦‚æœæœªæ‰¾åˆ°: ç»§ç»­ä¸‹ä¸€æ­¥                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤3: ç”Ÿæˆæ–°Shell (sketchFace2BrepShell)                  â”‚
â”‚  - å°†2Dé¢è½¬æ¢ä¸º3D Shell                                     â”‚
â”‚  - åœ¨Z=0å¹³é¢ä¸Šåˆ›å»º                                           â”‚
â”‚  - è®¾ç½®userData.id = face.id                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤4: PullPushæ‹‰ä¼¸ (ShellEdit.pullPushFace) â­            â”‚
â”‚  - å¦‚æœ value > 0:                                           â”‚
â”‚    â”œâ”€ è·å–Shellçš„åº•é¢ (getFaces()[0])                       â”‚
â”‚    â”œâ”€ è®¡ç®—æ‹‰ä¼¸å‘é‡: Vector3.Z() * value                     â”‚
â”‚    â”œâ”€ è°ƒç”¨ pullPushFace(face, vector, [])                   â”‚
â”‚    â”œâ”€ è·å–ä¿®æ”¹åçš„Shell                                     â”‚
â”‚    â”œâ”€ å…‹éš†Shell (update=true)                               â”‚
â”‚    â””â”€ æ·»åŠ åˆ°ç»“æœå’Œç¼“å­˜                                       â”‚
â”‚  - å¦‚æœ value <= 0:                                          â”‚
â”‚    â””â”€ ç›´æ¥ä½¿ç”¨å¹³é¢Shell                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤5: æ”¶é›†æ‰€æœ‰é¢ (Faces Collection)                        â”‚
â”‚  - éå†æ‰€æœ‰Shell                                             â”‚
â”‚  - è°ƒç”¨ shell.getFaces()                                    â”‚
â”‚  - åˆå¹¶åˆ° allFaces åˆ—è¡¨                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤6: åˆå¹¶Shell (facesAndShellsMerge) â­                  â”‚
â”‚  - è°ƒç”¨ ShellEdit.facesAndShellsMerge(allFaces, 
[], true)       â”‚
â”‚  - åˆå¹¶æ‰€æœ‰é¢ä¸ºä¸€ä¸ªShell                                    â”‚
â”‚  - å¤„ç†å…±äº«è¾¹å’Œé¡¶ç‚¹                                          â”‚
â”‚  - è¿”å›: modifiedShellsMap                                  â”‚
â”‚  - è·å–åˆå¹¶åçš„Shell: Array.from(map.keys())[0]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤7: æ¸…ç†èƒŒæ™¯è¾¹ (clearMergedBreps) â­                    â”‚
â”‚  - æå–è‰å›¾èƒŒæ™¯æ›²çº¿                                          â”‚
â”‚  - è¯†åˆ«Z=0çš„è¾¹                                               â”‚
â”‚  - åˆ¤æ–­æ˜¯å¦ä¸ºèƒŒæ™¯æ›²çº¿                                        â”‚
â”‚  - åˆ é™¤èƒŒæ™¯ç›¸å…³çš„è¾¹å’Œé¢                                      â”‚
â”‚  - è¿”å›æ¸…ç†åçš„Shellåˆ—è¡¨                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ­¥éª¤8: é‡å»ºBrepåç§° (SketchBrepNameHelper)                 â”‚
â”‚  - reconstructBrepNames([shell], sketch)                    â”‚
â”‚  - ä¸ºæ‰€æœ‰é¢è®¾ç½®tag = sketchFaceId                           â”‚
â”‚  - å»ºç«‹Sketchåˆ°Brepçš„æ˜ å°„å…³ç³»                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¾“å‡º: {brep: Shell, faceShells: Shell[]}                    â”‚
â”‚  - brep: æœ€ç»ˆçš„åˆå¹¶Shell                                     â”‚
â”‚  - faceShells: å„ä¸ªé¢çš„Shellç¼“å­˜ (ç”¨äºå¢é‡æ›´æ–°)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§® æ ¸å¿ƒç®—æ³•è¯¦è§£

### ç®—æ³•1: PullPushé¢æ‹‰ä¼¸ç®—æ³•

**ğŸ“ æºç ä½ç½®**: `ncustomizedplatform_io.js:138` / `sketch2brephelper.js:57`

**ğŸ¯ åŠŸèƒ½**: å°†å¹³é¢å‘æŒ‡å®šæ–¹å‘æ‹‰ä¼¸ç”Ÿæˆç«‹ä½“

**ğŸ“ ç®—æ³•åŸç†**:

```
è¾“å…¥:
  - face: è¦æ‹‰ä¼¸çš„é¢ (åº•é¢)
  - direction: Vector3 æ‹‰ä¼¸å‘é‡ (æ–¹å‘+è·ç¦»)
  - shells: ç›¸å…³Shellåˆ—è¡¨

ç®—æ³•æµç¨‹:
  1. è·å–é¢çš„è¾¹ç•Œå¾ªç¯ (Wire)
  2. å¯¹æ¯æ¡è¾¹:
     a. åˆ›å»ºæ‹‰ä¼¸çº¿æ®µ
     b. ç”Ÿæˆä¾§é¢ (Face)
  3. å¤åˆ¶é¡¶é¢ (åç§»directionè·ç¦»)
  4. è¿æ¥åº•é¢ã€ä¾§é¢ã€é¡¶é¢
  5. æ›´æ–°æ‹“æ‰‘å…³ç³»
  6. è¿”å›æ–°Shell

è¾“å‡º:
  - modifiedShellsMap: Map<åŸShell, æ–°Shell>
  - errorStr: é”™è¯¯ä¿¡æ¯
```

**ğŸ’» æ ¸å¿ƒä»£ç **:

```javascript
// æºç ä½ç½®: ncustomizedplatform_io.js:134-139
for (const sketchFace of sketchFaceMappings) {
    // è·³è¿‡é›¶é«˜åº¦æˆ–è´Ÿé«˜åº¦
    if (sketchFace.value < Tolerance.NUMBER_EPS) continue;
    
    // è·å–å¯¹åº”çš„Brepé¢
    const brepFace = shell.getFaceByTag(sketchFace.face.tag);
    
    // PullPushæ‹‰ä¼¸
    const result = Brep.alg.ShellEdit.pullPushFace(
        brepFace,                              // è¦æ‹‰ä¼¸çš„é¢
        Vector3.Z().multiply(sketchFace.value), // Zæ–¹å‘ Ã— é«˜åº¦
        [shell]                                // ç›¸å…³Shell
    );
    
    // é”™è¯¯æ£€æŸ¥
    if (result.errorStr) {
        Logger.console.assert(false, 
            "generateBrep: pullPushFace error: " + result.errorStr);
    }
}
```

**âš™ï¸ å‚æ•°è¯´æ˜**:

| å‚æ•° | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `face` | Face | åº•é¢å¯¹è±¡ | shell.getFaces()[0] |
| `direction` | Vector3 | æ‹‰ä¼¸å‘é‡ | Vector3(0, 0, 0.3) |
| `shells` | Shell[] | ç›¸å…³Shell | [shell] |

**â±ï¸ æ€§èƒ½æŒ‡æ ‡**:
- **æ—¶é—´å¤æ‚åº¦**: O(n) - nä¸ºè¾¹æ•°
- **ç©ºé—´å¤æ‚åº¦**: O(n) - åˆ›å»ºä¾§é¢æ•°
- **å…¸å‹è¿è¡Œæ—¶é—´**: 5-20ms (10æ¡è¾¹)

**ğŸ“Š åº”ç”¨åœºæ™¯**:
- âœ… åœ°å°é«˜åº¦æ‹‰ä¼¸
- âœ… å°é˜¶åˆ†å±‚åˆ›å»º
- âœ… æ¦»æ¦»ç±³åŒºåŸŸå»ºæ¨¡

---

### ç®—æ³•2: é¢å’ŒShellåˆå¹¶ç®—æ³•

**ğŸ“ æºç ä½ç½®**: `sketch2brephelper.js:87`

**ğŸ¯ åŠŸèƒ½**: å°†å¤šä¸ªç‹¬ç«‹çš„Shellåˆå¹¶ä¸ºä¸€ä¸ªç»Ÿä¸€çš„Shell

**ğŸ“ ç®—æ³•æµç¨‹**:

```
è¾“å…¥: faces[] + shells[] + mergeFlag

æ­¥éª¤1: æ”¶é›†æ‰€æœ‰é¢
  - éå†shells
  - è°ƒç”¨shell.getFaces()
  - åˆå¹¶åˆ°allFaces[]

æ­¥éª¤2: è°ƒç”¨åˆå¹¶ç®—æ³•
  - ShellEdit.facesAndShellsMerge(allFaces, [], true)
  - æ£€æµ‹ç›¸é‚»å…³ç³»
  - åˆå¹¶å…±äº«è¾¹å’Œé¡¶ç‚¹
  - é‡å»ºæ‹“æ‰‘ç»“æ„

æ­¥éª¤3: æå–ç»“æœ
  - modifiedShellsMap.keys()
  - è·å–åˆå¹¶åçš„Shell

æ­¥éª¤4: é”™è¯¯å¤„ç†
  - æ£€æŸ¥errorStr
  - æ–­è¨€å¤±è´¥åˆ™ç»ˆæ­¢

è¾“å‡º: å•ä¸ªåˆå¹¶åçš„Shell
```

**ğŸ’» æ ¸å¿ƒä»£ç **:

```javascript
// æºç ä½ç½®: sketch2brephelper.js:82-89
let allFaces = [];
for (const shell of shells) {
    const faces = shell.getFaces();
    allFaces = allFaces.concat(...faces);
}

// åˆå¹¶æ‰€æœ‰é¢ä¸ºä¸€ä¸ªShell
const mergeResult = Brep.alg.ShellEdit.facesAndShellsMerge(
    allFaces,  // æ‰€æœ‰é¢
    [],        // é¢å¤–Shell (ç©º)
    true       // åˆå¹¶æ ‡å¿—
);

// é”™è¯¯æ£€æŸ¥
if (mergeResult.errorStr) {
    Logger.console.assert(false, mergeResult.errorStr);
}

// è·å–åˆå¹¶åçš„Shell
let mergedShell = Array.from(mergeResult.modifiedShellsMap.keys())[0].clone();
```

**ğŸ”§ åˆå¹¶è§„åˆ™**:

1. **å…±äº«é¡¶ç‚¹**: è·ç¦» < tolerance çš„é¡¶ç‚¹åˆå¹¶
2. **å…±äº«è¾¹**: å®Œå…¨é‡å çš„è¾¹åˆå¹¶
3. **ç›¸é‚»é¢**: å…±äº«è¾¹çš„é¢ä¿æŒæ‹“æ‰‘å…³ç³»
4. **å­¤ç«‹é¢**: ä¿æŒç‹¬ç«‹ï¼Œä½†åœ¨åŒä¸€Shellä¸­

**â±ï¸ æ€§èƒ½æŒ‡æ ‡**:
- **æ—¶é—´å¤æ‚åº¦**: O(nÂ²) - nä¸ºé¢æ•°
- **ç©ºé—´å¤æ‚åº¦**: O(n)
- **å…¸å‹è¿è¡Œæ—¶é—´**: 10-50ms (50ä¸ªé¢)

---

### ç®—æ³•3: èƒŒæ™¯è¾¹æ¸…ç†ç®—æ³•

**ğŸ“ æºç ä½ç½®**: `sketch2brephelper.js:419-453`

**ğŸ¯ åŠŸèƒ½**: åˆ é™¤è‰å›¾èƒŒæ™¯è¾¹ç•Œäº§ç”Ÿçš„å¤šä½™è¾¹å’Œé¢

**ğŸ“ ç®—æ³•åŸç†**:

```
é—®é¢˜: 
  SketchèƒŒæ™¯åŒºåŸŸä¼šåœ¨Z=0å¹³é¢ç”Ÿæˆè¾¹
  è¿™äº›è¾¹åœ¨3Dæ¨¡å‹ä¸­æ˜¯å¤šä½™çš„ï¼Œéœ€è¦æ¸…ç†

è§£å†³æ–¹æ¡ˆ:
  1. è¯†åˆ«Z=0çš„è¾¹
  2. åˆ¤æ–­æ˜¯å¦ä¸ºèƒŒæ™¯æ›²çº¿
  3. åˆ é™¤èƒŒæ™¯ç›¸å…³çš„è¾¹å’Œé¢

åˆ¤æ–­è§„åˆ™:
  - è¾¹çš„èµ·ç‚¹ã€ç»ˆç‚¹ã€ä¸­å¿ƒç‚¹éƒ½åœ¨Z=0
  - è¾¹ä¸èƒŒæ™¯æ›²çº¿é‡å 
  - è¾¹çš„é¢æ˜¯ä¾§é¢ (éæ°´å¹³é¢)
```

**ğŸ’» æ ¸å¿ƒä»£ç **:

```javascript
// æºç ä½ç½®: sketch2brephelper.js:419-453
clearMergedBreps(shells, backgroundCurves) {
    const edgesToDelete = [];
    
    for (const shell of shells) {
        const edges = shell.getEdges();
        
        for (const edge of edges) {
            const curve = edge.getCurve();
            let isZ0Edge = false;
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºZ=0çš„è¾¹
            if (curve instanceof Arc3d) {
                const start = curve.getStartPt();
                const end = curve.getEndPt();
                const center = curve.getCenter();
                
                if (Math.abs(center.z) < Tolerance.NUMBER_EPS &&
                    Math.abs(start.z) < Tolerance.NUMBER_EPS &&
                    Math.abs(end.z) < Tolerance.NUMBER_EPS) {
                    isZ0Edge = true;
                }
            } else {
                const start = curve.getStartPt();
                const end = curve.getEndPt();
                
                if (Math.abs(start.z) < Tolerance.NUMBER_EPS &&
                    Math.abs(end.z) < Tolerance.NUMBER_EPS) {
                    isZ0Edge = true;
                }
            }
            
            if (isZ0Edge) {
                // æ£€æŸ¥æ˜¯å¦ä¸ºèƒŒæ™¯æ›²çº¿
                if (this.isSketchBackgroundCurve(edge.getCurve(), backgroundCurves)) {
                    continue;
                }
                
                // æ£€æŸ¥é¢çš„ç±»å‹
                const faces = edge.getFaces();
                if (faces.length !== 1) continue;
                
                // å¦‚æœæ˜¯ä¾§é¢ï¼Œæ·»åŠ åˆ°åˆ é™¤åˆ—è¡¨
                if (faces[0].getSurface().isPlane()) {
                    if (!Vector3.Z().equals(faces[0].getSurface().getNorm())) {
                        edgesToDelete.push(edge);
                    }
                } else {
                    edgesToDelete.push(edge);
                }
            }
        }
    }
    
    // åˆ é™¤è¾¹
    if (edgesToDelete.length === 0) return shells;
    
    const deleteResult = Brep.alg.ShellEdit.deleteFacesAndEdges([], edgesToDelete);
    return Array.from(deleteResult.modifiedShellsMap.keys());
}
```

**ğŸ” èƒŒæ™¯æ›²çº¿åˆ¤æ–­**:

```javascript
// æºç ä½ç½®: sketch2brephelper.js:454-486
isSketchBackgroundCurve(edge3d, backgroundCurves2d) 