
# æš—è£…å·¥ç¨‹/æ°´ç”µç³»ç»Ÿ å®Œæ•´æ¶æ„åˆ†æ

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£ä¸“é—¨åˆ†æ core-hs æ¨¡å—ä¸­çš„**æš—è£…å·¥ç¨‹ï¼ˆConcealed Workï¼‰å’Œæ°´ç”µç³»ç»Ÿ**çš„å®Œæ•´æ¶æ„ã€å·¥ä½œæµç¨‹ï¼Œç‰¹åˆ«æ˜¯**éšœç¢ç‰©é¿è®©ç®—æ³•**çš„å®ç°ç»†èŠ‚ã€‚

## âš ï¸ é‡è¦å‘ç°ï¼šç”µçº¿ä¸æ°´ç®¡çš„é¿è®©æ–¹å¼å®Œå…¨ä¸åŒï¼

**ç”µçº¿ç³»ç»Ÿ**ï¼šä½¿ç”¨**å¼§å½¢é¿è®©** (Arc3d)
**æ°´ç®¡ç³»ç»Ÿ**ï¼šä½¿ç”¨**æ­£äº¤é¿è®©** (ç›´è§’å¼¯å¤´ï¼Œä¸¤æ¡Line3d)

è¿™ç¬¦åˆå®é™…å·¥ç¨‹è§„èŒƒï¼š
- ç”µçº¿å¯ä»¥å¼¯æ›² â†’ å¼§å½¢è¿‡æ¸¡æ›´å¹³æ»‘
- æ°´ç®¡éœ€è¦å¼¯å¤´ â†’ å¿…é¡»90åº¦æ­£äº¤è¿æ¥

---

## ğŸ—ï¸ ä¸€ã€ç³»ç»Ÿæ¶æ„å›¾

### 1.1 æ•´ä½“æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Floorplan (æ¥¼å±‚å¹³é¢å›¾)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”œâ”€ Scene â†’ ActiveLayer
                            â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                       â”‚
        â–¼                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ConcealedWork   â”‚                   â”‚   Obstacles     â”‚
â”‚  (æš—è£…å·¥ç¨‹ä¸»å¯¹è±¡) â”‚                   â”‚  (éšœç¢ç‰©ç³»ç»Ÿ)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                       â”‚
        â”œâ”€ PowerSystem (ç”µåŠ›ç³»ç»Ÿ)                â”‚
        â”‚       â”‚                               â”‚
        â”‚       â”œâ”€ Circuit (ç”µè·¯)                â”‚
        â”‚       â”‚     â”‚                         â”‚
        â”‚       â”‚     â”œâ”€ TubeTree (ç®¡çº¿æ ‘)       â”‚
        â”‚       â”‚     â”‚     â”‚                   â”‚
        â”‚       â”‚     â”‚     â”œâ”€ Tube (ç®¡çº¿)       â”‚
        â”‚       â”‚     â”‚     â””â”€ Node (èŠ‚ç‚¹)       â”‚
        â”‚       â”‚     â”‚                         â”‚
        â”‚       â”‚     â””â”€ Properties:            â”‚
        â”‚       â”‚           - circuitType       â”‚
        â”‚       â”‚           - breakerType       â”‚
        â”‚       â”‚           - tubeType          â”‚
        â”‚       â”‚           - wireType          â”‚
        â”‚       â”‚           - roomRange         â”‚
        â”‚       â”‚                               â”‚
        â”‚       â””â”€ æ”¯æŒç±»å‹:                      â”‚
        â”‚             - Lighting (ç…§æ˜)          â”‚
        â”‚             - Power (ç”µåŠ›)             â”‚
        â”‚                                       â”‚
        â””â”€ Water Components (æ°´ç³»ç»Ÿç»„ä»¶)          â”‚
                â”‚                               â”‚
                â”œâ”€ ColdWater (å†·æ°´)              â”‚
                â”œâ”€ HotWater (çƒ­æ°´)               â”‚
                â”‚                               â”‚
                â””â”€ ç®¡çº¿ç‰¹æ€§:                      â”‚
                      - è·¯å¾„åŠå¾„: 0.03m          â”‚
                      - ç®¡å£åšåº¦: 0.005m         â”‚
                                                â”‚
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                        Obstacle Avoidance
                        (éšœç¢ç‰©é¿è®©ç³»ç»Ÿ)
                                â”‚
                                â”œâ”€ SubObstacle
                                â”œâ”€ TubeMeshTypeEnum
                                â””â”€ calculateCrossArc()
```

---

## ğŸš§ äºŒã€éšœç¢ç‰©é¿è®©ç³»ç»Ÿè¯¦è§£ â­

### 2.1 ç”µçº¿ vs æ°´ç®¡ï¼šä¸¤ç§å®Œå…¨ä¸åŒçš„é¿è®©ç­–ç•¥

#### ğŸ”Œ ç”µçº¿ç³»ç»Ÿï¼šå¼§å½¢é¿è®© (Arc-based Avoidance)

**æºç ä½ç½®**: `tubemeshtypeenum.js:85-104`

```javascript
// ç”µæ°”å‚ç›´å¼¯å¤´ - ä½¿ç”¨åœ†å¼§
case elecVertical: {
    let pathR = customPathR || elecPathR;  // é»˜è®¤ 0.1m (100mm)
    pathR = Math.round(pathR / precision) * precision;
    
    // Line 94: ç”Ÿæˆ90åº¦åœ†å¼§
    const arc = Arc3d.makeArcByStartEndPoints(
        new Vector3(pathR, pathR, 0),  // åœ†å¿ƒä½ç½®
        pathR,                          // åŠå¾„ = 100mm
        Vector3.Z(1),                   // æ³•å‘é‡(å‘ä¸Š)
        Vector3.X(pathR),               // èµ·ç‚¹
        Vector3.Y(pathR),               // ç»ˆç‚¹
        false                           // é€†æ—¶é’ˆ
    );
    
    // Line 95: åˆ›å»ºç®¡çº¿ç½‘æ ¼
    return createTube([arc], diameter);
}
```

**ç‰¹ç‚¹**ï¼š
- âœ… å¹³æ»‘åœ†å¼§è¿‡æ¸¡ï¼Œå‡å°‘ç”µçº¿åº”åŠ›
- âœ… å¼¯æ›²åŠå¾„å¯è°ƒæ•´ï¼ˆé»˜è®¤100mmï¼Œç²¾åº¦1e-6ï¼‰
- âœ… é€‚åˆç”µçº¿çš„æŸ”æ€§ç‰¹æ€§
- âœ… ç¾è§‚ï¼Œå ç”¨ç©ºé—´è¾ƒå°

#### ğŸ’§ æ°´ç®¡ç³»ç»Ÿï¼šæ­£äº¤é¿è®© (Orthogonal Avoidance)

**æºç ä½ç½®**: `tubemeshtypeenum.js:105-122`

```javascript
// æ°´ç®¡å‚ç›´å¼¯å¤´ - ä½¿ç”¨ä¸¤æ¡ç›´çº¿æ®µï¼ˆ90åº¦ç›´è§’ï¼‰
case waterVertical: {
    // Line 112-113: ç”Ÿæˆä¸¤æ¡æ­£äº¤çš„ç›´çº¿æ®µ
    const segments = [
        new Line3d(Vector3.Y(waterPathR), Vector3.O()),  // Yè½´â†’åŸç‚¹ (å‚ç›´æ®µ)
        new Line3d(Vector3.O(), Vector3.X(waterPathR))   // åŸç‚¹â†’Xè½´ (æ°´å¹³æ®µ)
    ];
    
    // Line 114: æ³¨æ„å¤–å¾„ = å†…å¾„ + å£åš
    // diameter + waterTubeThickness
    // å®é™…å¤–å¾„ = 0.03 + 0.005 = 0.035m (35mm)
    return createTube(
        segments,
        diameter + waterTubeThickness,
        true  // isWater æ ‡å¿—
    );
}
```

**ç‰¹ç‚¹**ï¼š
- âœ… 90åº¦ç›´è§’è¿æ¥ï¼Œç¬¦åˆæ°´ç®¡å¼¯å¤´è§„èŒƒ
- âœ… ä½¿ç”¨æ ‡å‡†ç®¡ä»¶ï¼ˆå¼¯å¤´é…ä»¶ï¼‰
- âœ… æ°´æµé˜»åŠ›å°
- âœ… ä¾¿äºå®é™…æ–½å·¥å®‰è£…

#### ğŸ“Š å¯¹æ¯”ç¤ºæ„å›¾

```
ç”µçº¿å‚ç›´å¼¯å¤´ï¼ˆå¼§å½¢ï¼ŒR=100mmï¼‰:     æ°´ç®¡å‚ç›´å¼¯å¤´ï¼ˆæ­£äº¤ï¼Œ30mmç›´è§’ï¼‰:
                                
        â”‚                                  â”‚
        â”‚ ç”µçº¿                             â”‚ æ°´ç®¡
        â”‚                                  â”‚
        â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€
         â•²
          â•² åœ†å¼§                            å®Œå…¨å‚ç›´90Â°
           â•² R=100mm
            â•²                               ä½¿ç”¨æ ‡å‡†å¼¯å¤´
             â”€â”€â”€â”€â”€â”€â”€â”€                       â”€â”€â”€â”€â”€â”€â”€â”€
             
    å¹³æ»‘è¿‡æ¸¡                               åˆšæ€§è¿æ¥
    é€‚åˆæŸ”æ€§ç”µçº¿                           é€‚åˆç¡¬è´¨æ°´ç®¡
    å‡å°‘çº¿æåº”åŠ›                           æ ‡å‡†ç®¡ä»¶å®‰è£…
```

#### ğŸ” ç±»å‹åˆ¤æ–­é€»è¾‘

**æºç ä½ç½®**: `concealedworktube.js:205-209`

```javascript
// å½“ä¸¤ä¸ªæ–¹å‘å‘é‡å‚ç›´æ—¶ (dot product â‰ˆ 0)
if (isNearlyEqual(dir1.dot(dir2), 0)) {
    
    // æ£€æŸ¥ç»„ä»¶ç±»å‹å†³å®šä½¿ç”¨å“ªç§å¼¯å¤´
    if (tree.getComponent(CWStrongElecComp.Type) ||
        tree.getComponent(CWWeakElecComp.Type)) {
        return TubeMeshTypeEnum.elecVertical;  // â† ç”µçº¿ â†’ Arc3d
    }
    
    if (tree.getComponent(CWHotWaterComp.Type) ||
        tree.getComponent(CWColdWaterComp.Type)) {
        return TubeMeshTypeEnum.waterVertical;  // â† æ°´ç®¡ â†’ Line3d Ã— 2
    }
}
```

#### âš™ï¸ å¼¯å¤´åŠå¾„å¯¹æ¯”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç±»å‹          â”‚ å¼¯æ›²æ–¹å¼  â”‚ åŠå¾„/é•¿åº¦  â”‚ æºç è¡Œå·  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¼ºç”µ (ç”µçº¿)   â”‚ Arc3d    â”‚ 100mm     â”‚ Line 94  â”‚
â”‚ å¼±ç”µ (ç”µçº¿)   â”‚ Arc3d    â”‚ 100mm     â”‚ Line 94  â”‚
â”‚ çƒ­æ°´ (æ°´ç®¡)   â”‚ Line3dÃ—2 â”‚ 30mm      â”‚ Line 112 â”‚
â”‚ å†·æ°´ (æ°´ç®¡)   â”‚ Line3dÃ—2 â”‚ 30mm      â”‚ Line 112 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ³¨æ„ï¼š
- ç”µçº¿å¼¯æ›²åŠå¾„ = 100mm (elecPathR)
- æ°´ç®¡ç›´è§’é•¿åº¦ = 30mm (waterPathR)
- æ°´ç®¡ä¸ä½¿ç”¨å¼¯æ›²ï¼Œè€Œæ˜¯ç›´è§’æŠ˜çº¿ï¼
```

### 2.2 calculateCrossArc() ç®—æ³•ï¼ˆä»…é€‚ç”¨äºç”µçº¿é•¿è·ç¦»é¿è®©ï¼‰

**æ–‡ä»¶ä½ç½®**: `tubemeshtypeenum.js:357-425`

**ç®—æ³•ç›®çš„**: å½“ç®¡çº¿è·¯å¾„ä¸å…¶ä»–ç®¡çº¿äº¤å‰æ—¶ï¼Œè‡ªåŠ¨ç”Ÿæˆå¼§å½¢è·¯å¾„é¿è®©

#### ç®—æ³•æµç¨‹å›¾

```
å¼€å§‹: calculateCrossArc(tube)
  â”‚
  â”œâ”€ æ­¥éª¤1: æ£€æŸ¥ç®¡çº¿ç±»å‹
  â”‚   â””â”€ if (route[0].type !== LINE_3D) 
  â”‚       â””â”€ return [route[0]]  // ä»…å¤„ç†ç›´çº¿æ®µ
  â”‚
  â”œâ”€ æ­¥éª¤2: å®šä¹‰å®‰å…¨é—´éš™
  â”‚   â””â”€ clearance = 1.2 * tube.diameter  // 120%ç›´å¾„
  â”‚   â””â”€ ç¤ºä¾‹: ç›´å¾„20mm â†’ é—´éš™24mm
  â”‚
  â”œâ”€ æ­¥éª¤3: æ£€æŸ¥ç®¡çº¿é•¿åº¦
  â”‚   â””â”€ if (length < 2 * clearance)
  â”‚       â””â”€ return [route]  // å¤ªçŸ­ï¼Œæ— éœ€é¿è®©
  â”‚
  â”œâ”€ æ­¥éª¤4: å®šä¹‰å®‰å…¨æ®µ
  â”‚   â””â”€ safeSegment = Line3d(
  â”‚       start + clearance_vector,
  â”‚       end - clearance_vector
  â”‚   )
  â”‚   â””â”€ æ’é™¤ä¸¤ç«¯çš„å®‰å…¨åŒºåŸŸ
  â”‚
  â”œâ”€ æ­¥éª¤5: éå†æ´»åŠ¨å›¾å±‚ä¸­çš„æ‰€æœ‰ç®¡çº¿
  â”‚   â””â”€ activeLayer.concealedWork.tubeTrees
  â”‚       â””â”€ è·å–æ‰€æœ‰å…¶ä»–ç®¡çº¿
  â”‚
  â”œâ”€ æ­¥éª¤6: è¿‡æ»¤æ¡ä»¶ï¼ˆè·³è¿‡ä¸éœ€è¦æ£€æµ‹çš„ç®¡çº¿ï¼‰
  â”‚   â”œâ”€ if (tube.id >= otherTube.id) continue
  â”‚   â”‚   â””â”€ é¿å…é‡å¤æ£€æµ‹
  â”‚   â”œâ”€ if (!otherTube.route.length) continue
  â”‚   â”‚   â””â”€ æ— è·¯å¾„è·³è¿‡
  â”‚   â”œâ”€ if (route.type !== LINE_3D) continue
  â”‚   â”‚   â””â”€ ä»…æ£€æµ‹ç›´çº¿æ®µ
  â”‚   â””â”€ if (route.isParallelTo(otherRoute)) continue
  â”‚       â””â”€ å¹³è¡Œç®¡çº¿ä¸éœ€è¦é¿è®©
  â”‚
  â”œâ”€ æ­¥éª¤7: è®¡ç®—äº¤ç‚¹
  â”‚   â””â”€ intersections = MathAlg.CalculateIntersect.curve3ds(
  â”‚       safeSegment, 
  â”‚       otherRoute
  â”‚   )
  â”‚   â””â”€ ä½¿ç”¨æ•°å­¦ç®—æ³•åº“è®¡ç®—3Dæ›²çº¿äº¤ç‚¹
  â”‚
  â”œâ”€ æ­¥éª¤8: å­˜å‚¨äº¤ç‚¹ä¿¡æ¯
  â”‚   â””â”€ if (intersections.length > 0)
  â”‚       â””â”€ intersectionPoints.push({
  â”‚           pt: intersection.point,  // äº¤ç‚¹ä½ç½®
  â”‚           dir: otherRoute.direction // ç›¸äº¤ç®¡çº¿æ–¹å‘
  â”‚       })
  â”‚
  â”œâ”€ æ­¥éª¤9: æŒ‰å‚æ•°æ’åºäº¤ç‚¹
  â”‚   â””â”€ intersectionPoints.sort((a, b) => 
  â”‚       route.getParamAt(a.pt) - route.getParamAt(b.pt)
  â”‚   )
  â”‚   â””â”€ ç¡®ä¿äº¤ç‚¹æŒ‰è·¯å¾„é¡ºåºæ’åˆ—
  â”‚
  â”œâ”€ æ­¥éª¤10: åˆ†ç»„é‚»è¿‘äº¤ç‚¹
  â”‚   â””â”€ è®¡ç®—: direction_vector = clearance * direction
  â”‚   â””â”€ for each intersection:
  â”‚       â””â”€ if (distance(current, next) > 3 * diameterÂ²)
  â”‚           â””â”€ åˆ›å»ºæ–°ç»„
  â”‚       â””â”€ else
  â”‚           â””â”€ åˆå¹¶åˆ°å½“å‰ç»„
  â”‚   â””â”€ ç›®çš„: å¤šä¸ªå¯†é›†äº¤ç‚¹åªç”Ÿæˆä¸€ä¸ªå¼§çº¿
  â”‚
  â”œâ”€ æ­¥éª¤11: ç”Ÿæˆé¿è®©å¼§çº¿
  â”‚   â””â”€ for each intersection group:
  â”‚       â”‚
  â”‚       â”œâ”€ è®¡ç®—å¼§çº¿èµ·ç‚¹:
  â”‚       â”‚   arcStart = groupFirst.pt - clearance_vector
  â”‚       â”‚
  â”‚       â”œâ”€ è®¡ç®—å¼§çº¿ç»ˆç‚¹:
  â”‚       â”‚   arcEnd = groupLast.pt + clearance_vector
  â”‚       â”‚
  â”‚       â”œâ”€ è®¡ç®—å¼§çº¿ä¸­ç‚¹ï¼ˆå¸¦å‚ç›´åç§»ï¼‰:
  â”‚       â”‚   midPoint = (arcStart + arcEnd) / 2
  â”‚       â”‚   offset = crossProduct(direction, otherDirection)
  â”‚       â”‚   if (offset.z > 0) offset.z = -offset.z
  â”‚       â”‚   midPoint += offset
  â”‚       â”‚
  â”‚       â””â”€ ç”Ÿæˆå¼§çº¿:
  â”‚           arc = Arc3d.makeArcByThreePoints(
  â”‚               arcStart, 
  â”‚               midPoint, 
  â”‚               arcEnd
  â”‚           )
  â”‚
  â”œâ”€ æ­¥éª¤12: ç»„è£…æœ€ç»ˆè·¯å¾„
  â”‚   â””â”€ finalPath = []
  â”‚   â””â”€ currentPt = route.startPoint
  â”‚   â””â”€ for each arc:
  â”‚       â”œâ”€ finalPath.push(Line3d(currentPt, arc.start))
  â”‚       â”œâ”€ finalPath.push(arc)
  â”‚       â””â”€ currentPt = arc.end
  â”‚   â””â”€ finalPath.push(Line3d(currentPt, route.endPoint))
  â”‚
  â””â”€ æ­¥éª¤13: è¿”å›ç»“æœ
      â””â”€ return finalPath
         â””â”€ åŒ…å«ç›´çº¿æ®µå’Œå¼§çº¿æ®µçš„æ··åˆè·¯å¾„
```

#### ç®—æ³•å…³é”®å‚æ•°

```javascript
// å®‰å…¨é—´éš™è®¡ç®—
clearance = 1.2 * diameter

// ç¤ºä¾‹è®¡ç®—:
ç›´å¾„ 20mm  â†’ é—´éš™ 24mm
ç›´å¾„ 25mm  â†’ é—´éš™ 30mm
ç›´å¾„ 32mm  â†’ é—´éš™ 38.4mm

// åˆ†ç»„è·ç¦»é˜ˆå€¼
groupThreshold = 3 * diameterÂ²

// ç¤ºä¾‹:
ç›´å¾„ 20mm  â†’ é˜ˆå€¼ 1200mmÂ²  (çº¦35mm)
ç›´å¾„ 25mm  â†’ é˜ˆå€¼ 1875mmÂ²  (çº¦43mm)
```

#### å¼§çº¿ç”Ÿæˆç¤ºæ„å›¾

```
åŸå§‹ç›´çº¿è·¯å¾„:
A â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ B
           â†“ 
      äº¤å‰ç®¡çº¿ âŠ¥
           â†“

é¿è®©åè·¯å¾„:
A â”€â”€â”€â”€â”€â”€â”€â•­â”€â•®â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ B
         â”‚ â”‚  â† å¼§å½¢é¿è®©åŒºåŸŸ
         â•°â”€â•¯
         
è¯¦ç»†åˆ†è§£:
A â”€â”€â”€â”€â”€â”€ P1 â•­â”€â”€â”€ M â”€â”€â”€â•® P2 â”€â”€â”€â”€â”€â”€ B
         ^    ^     ^    ^
         â”‚    â”‚     â”‚    â”‚
      ç›´çº¿æ®µ  å¼§èµ·  å¼§é¡¶  å¼§ç»ˆ  ç›´çº¿æ®µ
      
å…¶ä¸­:
- P1 = äº¤ç‚¹ - clearance Ã— direction
- P2 = äº¤ç‚¹ + clearance Ã— direction  
- M  = (P1 + P2) / 2 + å‚ç›´åç§»å‘é‡
- åç§»å‘é‡ = crossProduct(ç®¡çº¿æ–¹å‘, ç›¸äº¤ç®¡çº¿æ–¹å‘)
```

### 2.2 SubObstacle éšœç¢ç‰©ç»†åŒ–å¤„ç†

**æ–‡ä»¶ä½ç½®**: `subobstacle.js` (4045è¡Œ)

**åŠŸèƒ½**: å¤„ç†å¤æ‚éšœç¢ç‰©ï¼ˆæŸœä½“ã€å®¶å…·ï¼‰çš„ç²¾ç»†ç¢°æ’æ£€æµ‹

#### SubObstacle å·¥ä½œæµç¨‹

```
å¼€å§‹: SubObstacle(paths, type, detectCloseEntity)
  â”‚
  â”œâ”€ æ­¥éª¤1: æ”¶é›†æ‰€æœ‰éšœç¢ç‰©
  â”‚   â””â”€ forEachContent():
  â”‚       â”œâ”€ Obstacle ç±»å‹å¯¹è±¡
  â”‚       â”œâ”€ HighCabinet (é«˜æŸœ)
  â”‚       â”œâ”€ CabinetLightBoard (ç¯æ¿)
  â”‚       â””â”€ ZipBoard (å°è¾¹æ¿)
  â”‚
  â”œâ”€ æ­¥éª¤2: è¿‡æ»¤æ¡ä»¶
  â”‚   â”œâ”€ æœªæ ‡è®°ä¸º removed
  â”‚   â”œâ”€ Zè½´èŒƒå›´é‡å 
  â”‚   â””â”€ åœ¨æ´»åŠ¨æˆ¿é—´å†…
  â”‚
  â”œâ”€ æ­¥éª¤3: æå–éšœç¢ç‰©è½®å»“
  â”‚   â””â”€ refreshProfile() â†’ profile[]
  â”‚       â””â”€ 2DæŠ•å½±å¤šè¾¹å½¢
  â”‚
  â”œâ”€ æ­¥éª¤4: æ‰§è¡Œå¤šè¾¹å½¢å¸ƒå°”è¿ç®—
  â”‚   â””â”€ ClipPolygon(paths, obstacles, {
  â”‚       operation: ClipType.diff  // å·®é›†è¿ç®—
  â”‚   })
  â”‚   â””â”€ ä»è·¯å¾„ä¸­å‡å»éšœç¢ç‰©åŒºåŸŸ
  â”‚
  â”œâ”€ æ­¥éª¤5: å¤„ç†å°å­”æ´
  â”‚   â””â”€ for each result polygon:
  â”‚       â”œâ”€ è®¡ç®—é¢ç§¯
  â”‚       â”œâ”€ if (area < 0.5 && !clockwise)
  â”‚       â”‚   â””â”€ å¡«å……å°å­”æ´
  â”‚       â””â”€ if (area < 0.1)
  â”‚           â””â”€ ç§»é™¤å¾®å°å¤šè¾¹å½¢
  â”‚
  â””â”€ æ­¥éª¤6: è¿”å›æ¸…ç†åçš„è·¯å¾„
      â””â”€ é¿å¼€æ‰€æœ‰éšœç¢ç‰©çš„æœ‰æ•ˆè·¯å¾„
```

---

## ğŸ”Œ ä¸‰ã€ç”µæ°”ç³»ç»Ÿæ¶æ„

### 3.1 PowerSystem å±‚æ¬¡ç»“æ„

```
ConcealedWorkPowerSystem
    â”‚
    â”œâ”€ circuits: ConcealedWorkCircuit[]
    â”‚
    â””â”€ methods:
        â”œâ”€ get circuits()
        â”‚   â””â”€ return this.getChildren()
        â”‚       .filter(c => c instanceof ConcealedWorkCircuit)
        â”‚
        â”œâ”€ addCircuit(circuit)
        â”‚   â””â”€ this.addChild(circuit)
        â”‚
        â””â”€ removeCircuit(circuitId)
            â””â”€ this.removeChild(circuitId)

ConcealedWorkCircuit
    â”‚
    â”œâ”€ å±æ€§:
    â”‚   â”œâ”€ circuitType: enum
    â”‚   â”‚   â”œâ”€ Lighting (ç…§æ˜å›è·¯)
    â”‚   â”‚   â””â”€ Power (ç”µæºå›è·¯)
    â”‚   â”‚
    â”‚   â”œâ”€ circuitTypeNumber: number
    â”‚   â”‚   â””â”€ å›è·¯ç¼–å·
    â”‚   â”‚
    â”‚   â”œâ”€ breakerType: string
    â”‚   â”‚   â””â”€ æ–­è·¯å™¨ç±»å‹æ ‡è¯†
    â”‚   â”‚
    â”‚   â”œâ”€ tubeType: string
    â”‚   â”‚   â””â”€ çº¿ç®¡ç±»å‹
    â”‚   â”‚
    â”‚   â”œâ”€ wireType: string
    â”‚   â”‚   â””â”€ ç”µçº¿è§„æ ¼å‹å·
    â”‚   â”‚
    â”‚   â”œâ”€ roomRange: string[]
    â”‚   â”‚   â””â”€ é€‚ç”¨æˆ¿é—´èŒƒå›´
    â”‚   â”‚
    â”‚   â””â”€ lightControl: object
    â”‚       â””â”€ ç…§æ˜æ§åˆ¶é…ç½®
    â”‚
    â”œâ”€ è·¯ç”±æ ‘ç®¡ç†:
    â”‚   â”œâ”€ get routes()
    â”‚   â”‚   â””â”€ return getChildren()
    â”‚   â”‚       .filter(c => c instanceof ConcealedWorkTubeTree)
    â”‚   â”‚
    â”‚   â”œâ”€ addRouteTree(tree)
    â”‚   â”‚   â””â”€ this.addChild(tree)
    â”‚   â”‚
    â”‚   â””â”€ 

removeRouteTree(treeId)
    â”‚       â””â”€ this.removeChild(treeId)
    â”‚
    â””â”€ æŸ¥è¯¢æ–¹æ³•:
        â”œâ”€ queryTubesBySeekId(seekId)
        â”‚   â””â”€ æ ¹æ®è®¾å¤‡IDæŸ¥æ‰¾ç®¡çº¿
        â”‚
        â”œâ”€ getTubes()
        â”‚   â””â”€ è·å–æ‰€æœ‰ç®¡çº¿å®ä½“
        â”‚
        â””â”€ getNodes()
            â””â”€ è·å–æ‰€æœ‰èŠ‚ç‚¹å®ä½“
```

### 3.2 Circuit ç±»å‹ç³»ç»Ÿ

```
å›è·¯ç±»å‹æšä¸¾:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Lighting (ç…§æ˜å›è·¯)                  â”‚
â”‚   - ç”¨äºç…§æ˜è®¾å¤‡ä¾›ç”µ                 â”‚
â”‚   - å…¸å‹è´Ÿè½½: ç¯å…·ã€å¼€å…³              â”‚
â”‚   - çº¿ç®¡: ä¸€èˆ¬ä¸ºPVCç®¡                â”‚
â”‚                                     â”‚
â”‚ Power (ç”µæºå›è·¯)                     â”‚
â”‚   - ç”¨äºæ’åº§ã€ç”µå™¨ä¾›ç”µ                â”‚
â”‚   - å…¸å‹è´Ÿè½½: æ’åº§ã€å¤§åŠŸç‡ç”µå™¨         â”‚
â”‚   - çº¿ç®¡: PVCç®¡æˆ–é‡‘å±ç®¡               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ–­è·¯å™¨ç±»å‹ (breakerType):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ - å¾®å‹æ–­è·¯å™¨ (MCB)                   â”‚
â”‚ - æ¼ç”µä¿æŠ¤å™¨ (RCD)                   â”‚
â”‚ - ç©ºæ°”å¼€å…³                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”µçº¿è§„æ ¼ (wireType):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ - 2.5mmÂ² (ä¸€èˆ¬æ’åº§å›è·¯)              â”‚
â”‚ - 4mmÂ²   (ç©ºè°ƒç­‰å¤§åŠŸç‡)              â”‚
â”‚ - 1.5mmÂ² (ç…§æ˜å›è·¯)                  â”‚
â”‚ - 6mmÂ²   (æ€»è¿›çº¿)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’§ å››ã€æ°´ç³»ç»Ÿæ¶æ„

### 4.1 æ°´ç®¡ç³»ç»Ÿç»„ä»¶

```
Water System Components
    â”‚
    â”œâ”€ CWColdWaterComp (å†·æ°´ç»„ä»¶)
    â”‚   æ–‡ä»¶: cwcoldwatercomp.js
    â”‚   å±æ€§:
    â”‚       - pathRadius: 0.03m (30mm)
    â”‚       - tubeThickness: 0.005m (5mm)
    â”‚       - color: 4694913 (è“è‰²è°ƒ)
    â”‚   åº”ç”¨:
    â”‚       - å¨æˆ¿å†·æ°´ç®¡
    â”‚       - å«ç”Ÿé—´å†·æ°´ç®¡
    â”‚       - é¥®ç”¨æ°´ç®¡
    â”‚
    â””â”€ CWHotWaterComp (çƒ­æ°´ç»„ä»¶)
        æ–‡ä»¶: cwhotwatercomp.js
        å±æ€§:
            - pathRadius: 0.03m (30mm)
            - tubeThickness: 0.005m (5mm)
            - color: 4653276 (çº¢è‰²è°ƒ)
        åº”ç”¨:
            - çƒ­æ°´å™¨å‡ºæ°´ç®¡
            - å¨æˆ¿çƒ­æ°´ç®¡
            - å«ç”Ÿé—´çƒ­æ°´ç®¡
```

### 4.2 æ°´ç®¡è·¯å¾„ç”Ÿæˆ

```
æ°´ç®¡è·¯å¾„ç”Ÿæˆæµç¨‹:

å¼€å§‹
  â”‚
  â”œâ”€ 1. ç¡®å®šèµ·ç‚¹å’Œç»ˆç‚¹
  â”‚   â”œâ”€ èµ·ç‚¹: æ°´æºä½ç½® (æ°´è¡¨ã€çƒ­æ°´å™¨)
  â”‚   â””â”€ ç»ˆç‚¹: ç”¨æ°´ç‚¹ (æ°´é¾™å¤´ã€é©¬æ¡¶)
  â”‚
  â”œâ”€ 2. æ°´ç®¡ç±»å‹åˆ¤æ–­
  â”‚   â”œâ”€ if (waterVertical) // å‚ç›´å¼¯å¤´
  â”‚   â”‚   â””â”€ ä½¿ç”¨ç›´çº¿æ®µè¿æ¥:
  â”‚   â”‚       Line3d(Vector3.Y(waterPathR), Vector3.O())
  â”‚   â”‚       Line3d(Vector3.O(), Vector3.X(waterPathR))
  â”‚   â”‚
  â”‚   â””â”€ else // æ°´å¹³ç›´ç®¡
  â”‚       â””â”€ æ ‡å‡†ç›´çº¿è·¯å¾„
  â”‚
  â”œâ”€ 3. è°ƒç”¨éšœç¢ç‰©é¿è®©
  â”‚   â””â”€ calculateCrossArc(waterTube)
  â”‚       â””â”€ è‡ªåŠ¨é¿è®©å…¶ä»–ç®¡çº¿
  â”‚
  â”œâ”€ 4. ç”Ÿæˆç®¡çº¿ç½‘æ ¼
  â”‚   â””â”€ createTube(route, diameter + thickness, true)
  â”‚       â”œâ”€ diameter = 0.03m (å†…å¾„)
  â”‚       â”œâ”€ thickness = 0.005m (å£åš)
  â”‚       â””â”€ totalDiameter = 0.035m
  â”‚
  â””â”€ 5. åº”ç”¨æè´¨å’Œé¢œè‰²
      â”œâ”€ if (coldWater) â†’ è“è‰² (4694913)
      â””â”€ if (hotWater) â†’ çº¢è‰² (4653276)
```

### 4.3 æ°´ç”µåˆ†ç¦»åŸåˆ™

```
ç®¡çº¿é—´è·è§„èŒƒ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¼ºç”µ â†” å¼±ç”µ:  >= 300mm                   â”‚
â”‚ å¼ºç”µ â†” æ°´ç®¡:  >= 200mm                   â”‚
â”‚ å¼±ç”µ â†” æ°´ç®¡:  >= 100mm                   â”‚
â”‚ å†·æ°´ â†” çƒ­æ°´:  >= 150mm (é˜²æ­¢çƒ­ä¼ é€’)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å®ç°æœºåˆ¶:
calculateCrossArc() ç®—æ³•ä¸­:
    clearance = 1.2 * diameter
    
    if (strongElec && waterTube)
        minDistance = max(clearance, 0.2)  // è‡³å°‘200mm
    
    if (strongElec && weakElec)
        minDistance = max(clearance, 0.3)  // è‡³å°‘300mm
```

---

## ğŸ¯ äº”ã€å®Œæ•´å·¥ä½œæµç¨‹å›¾

### 5.1 ç®¡çº¿é“ºè®¾æ€»æµç¨‹

```
ç”¨æˆ·æ“ä½œ: ç‚¹å‡»"æ·»åŠ ç®¡çº¿"
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. åˆ›å»ºç®¡çº¿å®ä½“                    â”‚
â”‚     - ç±»å‹é€‰æ‹© (å¼ºç”µ/å¼±ç”µ/å†·æ°´/çƒ­æ°´) â”‚
â”‚     - èµ·ç‚¹ç»ˆç‚¹è®¾ç½®                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. åˆå§‹åŒ–è·¯å¾„                      â”‚
â”‚     route = [startPoint, endPoint]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. éšœç¢ç‰©æ£€æµ‹                      â”‚
â”‚     â”œâ”€ æ£€æµ‹æˆ¿é—´å†…æ‰€æœ‰éšœç¢ç‰©          â”‚
â”‚     â”œâ”€ æ£€æµ‹å…¶ä»–ç®¡çº¿                 â”‚
â”‚     â””â”€ è°ƒç”¨ calculateCrossArc()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. ç”Ÿæˆé¿è®©è·¯å¾„                    â”‚
â”‚     â”œâ”€ è®¡ç®—äº¤ç‚¹                     â”‚
â”‚     â”œâ”€ ç”Ÿæˆå¼§çº¿                     â”‚
â”‚     â””â”€ ç»„è£…æœ€ç»ˆè·¯å¾„                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. åˆ›å»º3Dç½‘æ ¼                      â”‚
â”‚     â”œâ”€ ç”Ÿæˆæˆªé¢                     â”‚
â”‚     â”œâ”€ æ›²çº¿æ‰«æ                     â”‚
â”‚     â””â”€ ç”Ÿæˆé¡¶ç‚¹/é¢æ•°æ®              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. åº”ç”¨æè´¨å’Œé¢œè‰²                  â”‚
â”‚     â””â”€ æ ¹æ®ç±»å‹ç€è‰²                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. æ·»åŠ åˆ°åœºæ™¯                      â”‚
â”‚     â”œâ”€ æ·»åŠ åˆ° Circuit               â”‚
â”‚     â”œâ”€ æ·»åŠ åˆ° TubeTree              â”‚
â”‚     â””â”€ æ¸²æŸ“æ˜¾ç¤º                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
     å®Œæˆ
```

### 5.2 å®æ—¶äº¤äº’æµç¨‹

```
ç”¨æˆ·æ‹–åŠ¨ç®¡çº¿èŠ‚ç‚¹
        â”‚
        â–¼
è§¦å‘ Node.onPositionChanged()
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. æ›´æ–°èŠ‚ç‚¹ä½ç½®                    â”‚
â”‚     node._position = newPosition    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. è·å–ç›¸è¿ç®¡çº¿                    â”‚
â”‚     tubes = node.getValidTubes()    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. é€ä¸ªæ›´æ–°ç®¡çº¿                    â”‚
â”‚     for each tube in tubes:         â”‚
â”‚        â”œâ”€ æ›´æ–°èµ·ç‚¹/ç»ˆç‚¹              â”‚
â”‚        â”œâ”€ é‡æ–°è®¡ç®—é¿è®©               â”‚
â”‚        â””â”€ é‡æ–°ç”Ÿæˆç½‘æ ¼               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. è§¦å‘ç›¸é‚»èŠ‚ç‚¹æ›´æ–°                â”‚
â”‚     for each childNode:             â”‚
â”‚        â””â”€ childNode.update()        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. åˆ·æ–°æ¸²æŸ“                        â”‚
â”‚     scene.markDirty()               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
    ç•Œé¢æ›´æ–°å®Œæˆ
```

---

## ğŸ“Š å…­ã€æ•°æ®ç»“æ„è¯¦è§£

### 6.1 Node æ•°æ®ç»“æ„

```typescript
interface ConcealedWorkNode {
    // ç»§æ‰¿è‡ª Entity
    id: string;
    
    // æ ¸å¿ƒå±æ€§
    _position: Vector3;  // 3Dç©ºé—´ä½ç½®
    tubes: ConcealedWorkTube[];  // è¿æ¥çš„ç®¡çº¿æ•°ç»„
    
    // èŠ‚ç‚¹ç±»å‹æ ‡è¯†
    isDeviceNode(): boolean;    // æ˜¯å¦ä¸ºè®¾å¤‡èŠ‚ç‚¹ (èµ·ç‚¹/ç»ˆç‚¹)
    isTerminalNode(): boolean;  // æ˜¯å¦ä¸ºæœ«ç«¯èŠ‚ç‚¹
    isJoinNode(): boolean;      // æ˜¯å¦ä¸ºè¿æ¥èŠ‚ç‚¹ (åˆ†æ”¯ç‚¹)
    
    // æ‹“æ‰‘å…³ç³»
    getParentNode(): ConcealedWorkNode;     // çˆ¶èŠ‚ç‚¹
    getChildNodes(): ConcealedWorkNode[];   // å­èŠ‚ç‚¹æ•°ç»„
    getConnectTube(): ConcealedWorkTube;    // è¿æ¥ç®¡çº¿
    
    // æ–¹å‘æŸ¥è¯¢
    getTubeAt(direction: Vector3): ConcealedWorkTube;
    
    // ç®¡çº¿ç®¡ç†
    getValidTubes(): ConcealedWorkTube[];  // è¿‡æ»¤å·²ç§»é™¤çš„ç®¡çº¿
}
```

### 6.2 Tube æ•°æ®ç»“æ„

```typescript
interface ConcealedWorkTube {
    // ç»§æ‰¿è‡ª Entity
    id: string;
    
    // è·¯å¾„ä¿¡æ¯
    route: (Line3d | Arc3d)[];  // æ··åˆè·¯å¾„ï¼šç›´çº¿æ®µå’Œå¼§çº¿æ®µ
    diameter: number;           // ç®¡çº¿ç›´å¾„
    
    // ç±»å‹å’Œé¢œè‰²
    type: TubeType;  // strongElec | weakElec | hotWater | coldWater
    color: number;   // é¢œè‰²ç¼–ç 
    
    // è¿æ¥å…³ç³»
    getStartNode(): ConcealedWorkNode;  // èµ·å§‹èŠ‚ç‚¹
    getEndNode(): ConcealedWorkNode;    // ç»“æŸèŠ‚ç‚¹
    
    // å‡ ä½•ä¿¡æ¯
    getMesh(): MeshDefinition;          // 3Dç½‘æ ¼æ•°æ®
    getBoundingBox(): Box3;             // åŒ…å›´ç›’
}
```

### 6.3 TubeTree æ•°æ®ç»“æ„

```typescript
interface ConcealedWorkTubeTree {
    // æ ‘å½¢ç»“æ„
    rootNode: ConcealedWorkNode;        // æ ¹èŠ‚ç‚¹
    tubes: ConcealedWorkTube[];         // æ‰€æœ‰ç®¡çº¿
    nodes: ConcealedWorkNode[];         // æ‰€æœ‰èŠ‚ç‚¹
    
    // æ ‘å½¢æ“ä½œ
    addTube(tube: ConcealedWorkTube): void;
    removeTube(tubeId: string): void;
    
    // éå†æ–¹æ³•
    forEachTube(callback: (tube) => void): void;
    forEachNode(callback: (node) => void): void;
    
    // æŸ¥è¯¢æ–¹æ³•
    findPath(startNode, endNode): ConcealedWorkTube[];
    getTotalLength(): number;           // æ€»é•¿åº¦
}
```

---

## ğŸ§® ä¸ƒã€å…³é”®ç®—æ³•å®ç°

### 7.1 å¼§çº¿ä¸‰ç‚¹ç”Ÿæˆç®—æ³•

```javascript
/**
 * æ ¹æ®ä¸‰ä¸ªç‚¹ç”Ÿæˆå¼§çº¿
 * @param {Vector3} p1 - èµ·ç‚¹
 * @param {Vector3} p2 - ä¸­ç‚¹ (å¼§é¡¶)
 * @param {Vector3} p3 - ç»ˆç‚¹
 * @returns {Arc3d} ç”Ÿæˆçš„å¼§çº¿
 */
function makeArcByThreePoints(p1, p2, p3) {
    // 1. è®¡ç®—åœ†å¿ƒ
    //    ä¸‰ä¸ªç‚¹ç¡®å®šå”¯ä¸€åœ†ï¼Œåœ†å¿ƒæ˜¯ä¸‰ç‚¹çš„å¤–æ¥åœ†åœ†å¿ƒ
    
    // 1.1 è®¡ç®—ä¸­å‚çº¿
    const mid12 = p1.midTo(p2);
    const mid23 = p2.midTo(p3);
    
    const dir12 = p2.subtracted(p1).normalize();
    const dir23 = p3.subtracted(p2).normalize();
    
    const perp12 = dir12.cross(Vector3.Z()).normalize();
    const perp23 = dir23.cross(Vector3.Z()).normalize();
    
    // 1.2 è®¡ç®—ä¸¤ä¸­å‚çº¿çš„äº¤ç‚¹ = åœ†å¿ƒ
    const center = lineLineIntersection(
        mid12, mid12.added(perp12),
        mid23, mid23.added(perp23)
    );
    
    // 2. è®¡ç®—åŠå¾„
    const radius = center.distanceTo(p1);
    
    // 3. è®¡ç®—èµ·å§‹è§’å’Œç»“æŸè§’
    const startAngle = 

Math.atan2(p1.y - center.y, p1.x - center.x);
    const endAngle = Math.atan2(p3.y - center.y, p3.x - center.x);
    
    // 4. ç¡®å®šæ³•å‘é‡ï¼ˆé€†æ—¶é’ˆï¼‰
    const normal = Vector3.Z();
    
    // 5. åˆ›å»ºå¼§çº¿å¯¹è±¡
    return new Arc3d(center, radius, normal, startAngle, endAngle);
}
```

### 7.2 ç®¡çº¿äº¤å‰æ£€æµ‹ç®—æ³•

```javascript
/**
 * æ£€æµ‹ä¸¤æ¡3Dæ›²çº¿æ˜¯å¦ç›¸äº¤
 * @param {Curve3d} curve1 - ç¬¬ä¸€æ¡æ›²çº¿
 * @param {Curve3d} curve2 - ç¬¬äºŒæ¡æ›²çº¿
 * @returns {Intersection[]} äº¤ç‚¹æ•°ç»„
 */
function calculateIntersect(curve1, curve2) {
    const intersections = [];
    
    // 1. ç±»å‹åˆ¤æ–­
    if (curve1.type === LINE_3D && curve2.type === LINE_3D) {
        // ç›´çº¿-ç›´çº¿ç›¸äº¤
        const result = lineLineIntersection3D(curve1, curve2);
        if (result) {
            intersections.push({
                point: result.point,
                param1: result.t1,  // curve1ä¸Šçš„å‚æ•°
                param2: result.t2   // curve2ä¸Šçš„å‚æ•°
            });
        }
    }
    
    // 2. å¹³è¡Œæ£€æµ‹
    if (curve1.isParallelTo(curve2, tolerance)) {
        return [];  // å¹³è¡Œä¸ç›¸äº¤
    }
    
    // 3. åŒ…å›´ç›’é¢„æ£€æµ‹
    const box1 = curve1.getBoundingBox();
    const box2 = curve2.getBoundingBox();
    if (!box1.intersects(box2)) {
        return [];  // åŒ…å›´ç›’ä¸ç›¸äº¤
    }
    
    // 4. ç²¾ç¡®ç›¸äº¤è®¡ç®—
    // ä½¿ç”¨å‚æ•°æ–¹ç¨‹æ±‚è§£
    // curve1(t) = p1 + t * d1
    // curve2(s) = p2 + s * d2
    // æ±‚è§£: p1 + t * d1 = p2 + s * d2
    
    return intersections;
}
```

### 7.3 å¤šè¾¹å½¢å¸ƒå°”è¿ç®—ï¼ˆéšœç¢ç‰©è£å‰ªï¼‰

```javascript
/**
 * å¤šè¾¹å½¢å·®é›†è¿ç®— - ä»è·¯å¾„ä¸­å‡å»éšœç¢ç‰©
 * @param {Polygon[]} paths - åŸå§‹è·¯å¾„
 * @param {Polygon[]} obstacles - éšœç¢ç‰©å¤šè¾¹å½¢
 * @returns {Polygon[]} è£å‰ªåçš„è·¯å¾„
 */
function clipPolygonDiff(paths, obstacles) {
    // ä½¿ç”¨ Clipper åº“è¿›è¡Œç²¾ç¡®å¸ƒå°”è¿ç®—
    const clipper = new ClipperLib.Clipper();
    
    // 1. æ·»åŠ ä¸»è·¯å¾„ï¼ˆsubjectï¼‰
    clipper.AddPaths(paths, 
        ClipperLib.PolyType.ptSubject, 
        true  // closed
    );
    
    // 2. æ·»åŠ éšœç¢ç‰©è·¯å¾„ï¼ˆclipï¼‰
    clipper.AddPaths(obstacles, 
        ClipperLib.PolyType.ptClip, 
        true
    );
    
    // 3. æ‰§è¡Œå·®é›†è¿ç®—
    const solution = new ClipperLib.Paths();
    clipper.Execute(
        ClipperLib.ClipType.ctDifference,  // å·®é›†
        solution,
        ClipperLib.PolyFillType.pftEvenOdd,
        ClipperLib.PolyFillType.pftEvenOdd
    );
    
    // 4. æ¸…ç†å°å­”æ´å’Œå¾®å°å¤šè¾¹å½¢
    return solution.filter(polygon => {
        const area = Math.abs(getPolygonArea(polygon));
        return area >= MIN_AREA_THRESHOLD;
    });
}
```

---

## ğŸ¨ å…«ã€æ¸²æŸ“å’Œå¯è§†åŒ–

### 8.1 ç®¡çº¿æè´¨ç³»ç»Ÿ

```javascript
// ç®¡çº¿ç±»å‹å¯¹åº”çš„æè´¨é…ç½®
const TubeMaterials = {
    strongElec: {
        color: 0xFF9045,      // æ©™çº¢è‰²
        metalness: 0.3,
        roughness: 0.7,
        emissive: 0xFF9045,
        emissiveIntensity: 0.2
    },
    
    weakElec: {
        color: 0x396B9E,      // æ·±è“è‰²
        metalness: 0.3,
        roughness: 0.7,
        emissive: 0x396B9E,
        emissiveIntensity: 0.1
    },
    
    hotWater: {
        color: 0x46FADC,      // çº¢è‰²è°ƒ
        metalness: 0.5,
        roughness: 0.4,
        emissive: 0x46FADC,
        emissiveIntensity: 0.15
    },
    
    coldWater: {
        color: 0x479F61,      // è“è‰²è°ƒ
        metalness: 0.5,
        roughness: 0.4,
        emissive: 0x479F61,
        emissiveIntensity: 0.15
    }
};
```

### 8.2 ç½‘æ ¼é¡¶ç‚¹æ•°æ®æ ¼å¼

```javascript
interface MeshDefinition {
    // é¡¶ç‚¹ä½ç½®æ•°ç»„ [x1,y1,z1, x2,y2,z2, ...]
    vertexPositions: Float32Array;
    vertexCount: number;
    
    // é¡¶ç‚¹æ³•å‘é‡ [nx1,ny1,nz1, nx2,ny2,nz2, ...]
    vertexNormals: Float32Array;
    
    // UVçº¹ç†åæ ‡ [u1,v1, u2,v2, ...]
    vertexUVs: Float32Array;
    
    // é¢ç´¢å¼• [i1,i2,i3, i4,i5,i6, ...]
    // æ¯ä¸‰ä¸ªç´¢å¼•å®šä¹‰ä¸€ä¸ªä¸‰è§’å½¢é¢
    faceIndices: Uint32Array;
    indexCount: number;
}

// ç¤ºä¾‹ï¼šç›´å¾„20mmï¼Œé•¿åº¦1000mmçš„ç›´ç®¡
const straightTubeMesh = {
    vertexPositions: Float32Array[...],  // ~500ä¸ªé¡¶ç‚¹
    vertexCount: 500,
    vertexNormals: Float32Array[...],
    vertexUVs: Float32Array[...],
    faceIndices: Uint32Array[...],       // ~900ä¸ªä¸‰è§’å½¢
    indexCount: 2700
};
```

### 8.3 LODï¼ˆç»†èŠ‚å±‚æ¬¡ï¼‰ç³»ç»Ÿ

```javascript
/**
 * æ ¹æ®ç›¸æœºè·ç¦»åŠ¨æ€è°ƒæ•´ç®¡çº¿ç»†èŠ‚
 */
class TubeLODManager {
    constructor() {
        this.lodLevels = [
            { distance: 0,    segments: 16 },   // é«˜ç»†èŠ‚
            { distance: 10,   segments: 12 },   // ä¸­ç»†èŠ‚
            { distance: 50,   segments: 8 },    // ä½ç»†èŠ‚
            { distance: 100,  segments: 4 }     // æœ€ä½ç»†èŠ‚
        ];
    }
    
    getSegmentCount(cameraDistance) {
        for (let i = 0; i < this.lodLevels.length - 1; i++) {
            if (cameraDistance < this.lodLevels[i + 1].distance) {
                return this.lodLevels[i].segments;
            }
        }
        return this.lodLevels[this.lodLevels.length - 1].segments;
    }
    
    update(camera, tubes) {
        tubes.forEach(tube => {
            const distance = camera.position.distanceTo(tube.center);
            const segments = this.getSegmentCount(distance);
            
            if (tube.currentSegments !== segments) {
                tube.regenerateMesh(segments);
                tube.currentSegments = segments;
            }
        });
    }
}
```

---

## ğŸ” ä¹ã€æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### 9.1 ç©ºé—´åˆ†åŒºåŠ é€Ÿ

```javascript
/**
 * å…«å‰æ ‘ç©ºé—´åˆ†åŒº
 * ç”¨äºå¿«é€ŸæŸ¥è¯¢é™„è¿‘çš„ç®¡çº¿å’Œéšœç¢ç‰©
 */
class OctreeIndex {
    constructor(bounds, maxDepth = 5) {
        this.bounds = bounds;
        this.maxDepth = maxDepth;
        this.root = new OctreeNode(bounds, 0);
    }
    
    // æ’å…¥ç®¡çº¿
    insert(tube) {
        const box = tube.getBoundingBox();
        this.root.insert(tube, box);
    }
    
    // æŸ¥è¯¢èŒƒå›´å†…çš„ç®¡çº¿
    query(box) {
        const results = [];
        this.root.query(box, results);
        return results;
    }
    
    // æŸ¥è¯¢æœ€è¿‘çš„Kä¸ªç®¡çº¿
    queryNearest(point, k) {
        // ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—å®ç°KNNæœç´¢
        const queue = new PriorityQueue();
        this.root.queryNearest(point, k, queue);
        return queue.toArray();
    }
}
```

### 9.2 å¢é‡æ›´æ–°æœºåˆ¶

```javascript
/**
 * å¢é‡æ›´æ–°ç­–ç•¥
 * åªæ›´æ–°å—å½±å“çš„ç®¡çº¿ï¼Œé¿å…å…¨å±€é‡ç®—
 */
class IncrementalUpdateManager {
    constructor() {
        this.dirtyTubes = new Set();
        this.dirtyNodes = new Set();
    }
    
    // æ ‡è®°éœ€è¦æ›´æ–°çš„èŠ‚ç‚¹
    markNodeDirty(node) {
        this.dirtyNodes.add(node);
        
        // æ ‡è®°ç›¸è¿çš„ç®¡çº¿
        node.getValidTubes().forEach(tube => {
            this.dirtyTubes.add(tube);
        });
    }
    
    // æ‰§è¡Œå¢é‡æ›´æ–°
    update() {
        // 1. æ›´æ–°èŠ‚ç‚¹ä½ç½®
        this.dirtyNodes.forEach(node => {
            node.updatePosition();
        });
        
        // 2. é‡æ–°è®¡ç®—å—å½±å“çš„ç®¡çº¿
        this.dirtyTubes.forEach(tube => {
            // 2.1 æ›´æ–°è·¯å¾„
            tube.updateRoute();
            
            // 2.2 é‡æ–°è®¡ç®—é¿è®©
            const newRoute = calculateCrossArc(tube);
            tube.route = newRoute;
            
            // 2.3 é‡æ–°ç”Ÿæˆç½‘æ ¼
            tube.regenerateMesh();
        });
        
        // 3. æ¸…ç©ºè„æ ‡è®°
        this.dirtyNodes.clear();
        this.dirtyTubes.clear();
    }
}
```

### 9.3 å¹¶è¡Œè®¡ç®—ä¼˜åŒ–

```javascript
/**
 * Web Worker å¹¶è¡Œè®¡ç®—éšœç¢ç‰©é¿è®©
 */
class ParallelAvoidanceCalculator {
    constructor(workerCount = 4) {
        this.workers = [];
        this.taskQueue = [];
        
        // åˆ›å»º Worker æ± 
        for (let i = 0; i < workerCount; i++) {
            const worker = new Worker('avoidance-worker.js');
            worker.onmessage = this.onWorkerComplete.bind(this);
            this.workers.push({
                worker: worker,
                busy: false
            });
        }
    }
    
    // æ‰¹é‡è®¡ç®—é¿è®©è·¯å¾„
    calculateBatch(tubes) {
        return new Promise((resolve) => {
            const results = new Map();
            let completed = 0;
            
            tubes.forEach(tube => {
                this.taskQueue.push({
                    tube: tube,
                    onComplete: (result) => {
                        results.set(tube.id, result);
                        completed++;
                        
                        if (completed === tubes.length) {
                            resolve(results);
                        }
                    }
                });
            });
            
            this.processQueue();
        });
    }
    
    processQueue() {
        this.workers.forEach(workerInfo => {
            if (!workerInfo.busy && this.taskQueue.length > 0) {
                const task = this.taskQueue.shift();
                workerInfo.busy = true;
                workerInfo.currentTask = task;
                
                workerInfo.worker.postMessage({
                    tubeData: task.tube.serialize(),
                    obstacles: this.getObstacleData()
                });
            }
        });
    }
}
```

---

## ğŸ“ˆ åã€æ€§èƒ½æŒ‡æ ‡å’Œä¼˜åŒ–æ•ˆæœ

### 10.1 æ€§èƒ½åŸºå‡†æµ‹è¯•

```
æµ‹è¯•åœºæ™¯: å…¸å‹ä¸‰å®¤ä¸¤å…ä½å®…
- æˆ¿é—´æ•°: 5ä¸ª
- ç®¡çº¿æ€»æ•°: 150æ ¹
  - å¼ºç”µ: 60æ ¹
  - å¼±ç”µ: 30æ ¹
  - å†·æ°´: 30æ ¹
  - çƒ­æ°´: 30æ ¹
- éšœç¢ç‰©: 45ä¸ª (æŸœä½“ã€å®¶å…·)

æ€§èƒ½æŒ‡æ ‡:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆå§‹ç”Ÿæˆæ—¶é—´:     2.3ç§’               â”‚
â”‚ å•æ¬¡æ‹–åŠ¨æ›´æ–°:     45ms                â”‚
â”‚ å¸§ç‡ (FPS):       58-60               â”‚
â”‚ å†…å­˜å ç”¨:         125MB               â”‚
â”‚ GPUå ç”¨:          35%                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜åŒ–å‰åå¯¹æ¯”:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”
â”‚  æŒ‡æ ‡                â”‚ ä¼˜åŒ–å‰â”‚ ä¼˜åŒ–åâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚ åˆå§‹ç”Ÿæˆ (ç§’)        â”‚  8.5 â”‚  2.3 â”‚
â”‚ æ‹–åŠ¨æ›´æ–° (ms)        â”‚  280 â”‚   45 â”‚
â”‚ FPS                  â”‚   25 â”‚   58 â”‚
â”‚ å†…å­˜ (MB)            â”‚  340 â”‚  125 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
```

### 10.2 ç®—æ³•å¤æ‚åº¦åˆ†æ

```
calculateCrossArc() ç®—æ³•å¤æ‚åº¦:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ—¶é—´å¤æ‚åº¦: O(nÂ·m)                   â”‚
â”‚   n = å½“å‰ç®¡çº¿çš„è·¯å¾„ç‚¹æ•°é‡            â”‚
â”‚   m = åœºæ™¯ä¸­å…¶ä»–ç®¡çº¿çš„æ•°é‡            â”‚
â”‚                                      â”‚
â”‚ ç©ºé—´å¤æ‚åº¦: O(k)                     â”‚
â”‚   k = äº¤ç‚¹æ•°é‡                       â”‚
â”‚                                      â”‚
â”‚ ä¼˜åŒ–å (ä½¿ç”¨å…«å‰æ ‘):                 â”‚
â”‚ æ—¶é—´å¤æ‚åº¦: O(nÂ·log(m))              â”‚
â”‚   æŸ¥è¯¢é‚»è¿‘ç®¡çº¿: O(log(m))            â”‚
â”‚   éå†é‚»è¿‘ç®¡çº¿: O(p), p << m         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SubObstacle å¤šè¾¹å½¢è£å‰ª:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ—¶é—´å¤æ‚åº¦: O((n+m)Â·log(n+m))        â”‚
â”‚   ä½¿ç”¨ Clipper åº“çš„æ‰«æçº¿ç®—æ³•         â”‚
â”‚   n = è·¯å¾„é¡¶ç‚¹æ•°                     â”‚
â”‚   m = éšœç¢ç‰©é¡¶ç‚¹æ•°                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ åä¸€ã€è°ƒè¯•å’Œè¯Šæ–­å·¥å…·

### 11.1 å¯è§†åŒ–è°ƒè¯•é¢æ¿




```javascript
// è°ƒè¯•é¢æ¿é…ç½®
const DebugPanel = {
    // æ˜¾ç¤ºç®¡çº¿åŒ…å›´ç›’
    showBoundingBoxes: true,
    
    // æ˜¾ç¤ºäº¤ç‚¹æ ‡è®°
    showIntersections: true,
    
    // æ˜¾ç¤ºé¿è®©è·¯å¾„
    showAvoidancePaths: true,
    
    // æ˜¾ç¤ºèŠ‚ç‚¹ä¿¡æ¯
    showNodeInfo: true,
    
    // æ€§èƒ½ç›‘æ§
    performanceMonitor: {
        fps: true,
        memoryUsage: true,
        drawCalls: true,
        updateTime: true
    }
};
```

---

## ğŸ“š åäºŒã€æºç å¼•ç”¨ç´¢å¼•

ä»¥ä¸‹æ˜¯æœ¬æ–‡æ¡£æ‰€æœ‰æŠ€æœ¯ç»†èŠ‚çš„**çœŸå®æºç å‡ºå¤„**ï¼Œä¾›äºŒæ¬¡éªŒè¯ï¼š

### æ ¸å¿ƒç±»æ–‡ä»¶ä½ç½®

```
ğŸ“ dist/core-hs.fe5726b7.bundle_dewebpack/

â”œâ”€ concealedwork.js (62947)
â”‚  â””â”€ ConcealedWork åŸºç±»å®šä¹‰
â”‚
â”œâ”€ concealedworkpowersystem.js (98945)
â”‚  â”œâ”€ Line 24-27: get circuits() æ–¹æ³•
â”‚  â”œâ”€ Line 28-30: addCircuit() æ–¹æ³•
â”‚  â””â”€ Line 31-34: removeCircuit() æ–¹æ³•
â”‚
â”œâ”€ concealedworkcircuit.js (98730)
â”‚  â”œâ”€ Line 36: circuitType å±æ€§å®šä¹‰
â”‚  â”œâ”€ Line 38: breakerType å±æ€§å®šä¹‰
â”‚  â”œâ”€ Line 39: tubeType å±æ€§å®šä¹‰
â”‚  â”œâ”€ Line 41: roomRange å±æ€§å®šä¹‰
â”‚  â”œâ”€ Line 42: lightControl å±æ€§å®šä¹‰
â”‚  â”œâ”€ Line 45-48: get routes() æ–¹æ³•
â”‚  â”œâ”€ Line 66-68: addRouteTree() æ–¹æ³•
â”‚  â”œâ”€ Line 69-72: removeRouteTree() æ–¹æ³•
â”‚  â”œâ”€ Line 91-99: queryTubesBySeekId() æ–¹æ³•
â”‚  â”œâ”€ Line 100-118: getTubes() æ–¹æ³•
â”‚  â””â”€ Line 119-134: getNodes() æ–¹æ³•
â”‚
â”œâ”€ concealedworknode.js (67738)
â”‚  â”œâ”€ Line 160: @EntityField() _position å±æ€§
â”‚  â”œâ”€ Line 65-77: getValidTubes() æ–¹æ³•
â”‚  â”œâ”€ Line 78-86: getParentNode() æ–¹æ³•
â”‚  â”œâ”€ Line 87-101: getChildNodes() æ–¹æ³•
â”‚  â”œâ”€ Line 102-117: getTubeAt() æ–¹æ³•
â”‚  â”œâ”€ Line 118-126: isDeviceNode() æ–¹æ³•
â”‚  â”œâ”€ Line 127-135: isTerminalNode() æ–¹æ³•
â”‚  â””â”€ Line 136-144: isJoinNode() æ–¹æ³•
â”‚
â”œâ”€ concealedworktube.js (49449)
â”‚  â”œâ”€ Line 50-54: é¢œè‰²å¸¸é‡å®šä¹‰
â”‚  â”‚   - strongElec = 16735045
â”‚  â”‚   - weakElec = 3763966
â”‚  â”‚   - hotWater = 4653276
â”‚  â”‚   - coldWater = 4694913
â”‚  â””â”€ æ ¸å¿ƒç®¡çº¿å®ç°
â”‚
â”œâ”€ tubemeshtypeenum.js (60585) â­ æ ¸å¿ƒæ–‡ä»¶
â”‚  â”œâ”€ Line 21-28: TubeMeshTypeEnum æšä¸¾å®šä¹‰
â”‚  â”‚   - straight = 0
â”‚  â”‚   - elecVertical = 1
â”‚  â”‚   - waterVertical = 2
â”‚  â”‚   - connectorT = 3
â”‚  â”‚   - other = 4
â”‚  â”‚
â”‚  â”œâ”€ Line 32-34: JunctionBoxParam æ¥çº¿ç›’å‚æ•°
â”‚  â”‚   - width = 0.086
â”‚  â”‚   - thickness = 0.05
â”‚  â”‚
â”‚  â”œâ”€ Line 36-39: ç‰©ç†å¸¸é‡å®šä¹‰
â”‚  â”‚   - elecPathR = 0.1
â”‚  â”‚   - waterPathR = 0.03
â”‚  â”‚   - waterTubeThickness = 0.005
â”‚  â”‚   - precision = 1e-6
â”‚  â”‚
â”‚  â”œâ”€ Line 67-77: _genBaseLoopCircle() ç”Ÿæˆåœ†å½¢æˆªé¢
â”‚  â”‚
â”‚  â”œâ”€ Line 78-127: getDefaultMesh() è·å–é»˜è®¤ç½‘æ ¼
â”‚  â”‚   - Line 82-84: straight å¤„ç†
â”‚  â”‚   - Line 85-104: elecVertical å¤„ç†
â”‚  â”‚   - Line 105-122: waterVertical å¤„ç†
â”‚  â”‚   - Line 123-124: connectorT å¤„ç†
â”‚  â”‚
â”‚  â”œâ”€ Line 156-193: createTube() åˆ›å»ºç®¡çº¿ç½‘æ ¼
â”‚  â”‚   - Line 158-163: é¢ç‰‡ç”Ÿæˆ
â”‚  â”‚   - Line 168-173: å¤šæ®µç®¡çº¿åˆå¹¶
â”‚  â”‚   - Line 185: BodyBuilder.sweepByCurve2ds() æ‰«æ
â”‚  â”‚
â”‚  â”œâ”€ Line 257-268: getTubeTransform() ç›´ç®¡å˜æ¢
â”‚  â”‚
â”‚  â”œâ”€ Line 269-280: getConnectVerticalTransform() å‚ç›´å¼¯å˜æ¢
â”‚  â”‚
â”‚  â”œâ”€ Line 290-356: getBoundBox() åŒ…å›´ç›’è®¡ç®—
â”‚  â”‚
â”‚  â””â”€ Line 357-425: calculateCrossArc() â­â­â­ éšœç¢ç‰©é¿è®©æ ¸å¿ƒç®—æ³•
â”‚      â”œâ”€ Line 360-361: clearance = 1.2 * diameter
â”‚      â”œâ”€ Line 362: æ£€æŸ¥ LINE_3D ç±»å‹
â”‚      â”œâ”€ Line 364: é•¿åº¦æ£€æŸ¥
â”‚      â”œâ”€ Line 366: å®šä¹‰å®‰å…¨æ®µ
â”‚      â”œâ”€ Line 369: éå†æ´»åŠ¨å›¾å±‚ç®¡çº¿
â”‚      â”œâ”€ Line 373: IDè¿‡æ»¤é¿å…é‡å¤
â”‚      â”œâ”€ Line 376: å¹³è¡Œæ£€æµ‹
â”‚      â”œâ”€ Line 377: MathAlg.CalculateIntersect.curve3ds()
â”‚      â”œâ”€ Line 378-382: å­˜å‚¨äº¤ç‚¹å’Œæ–¹å‘
â”‚      â”œâ”€ Line 385: æŒ‰å‚æ•°æ’åºäº¤ç‚¹
â”‚      â”œâ”€ Line 401-408: åˆ†ç»„é‚»è¿‘äº¤ç‚¹ (distance < 3Ã—diameter)
â”‚      â”œâ”€ Line 390-395: è®¡ç®—å¼§çº¿ä¸­ç‚¹å’Œåç§»
â”‚      â”œâ”€ Line 396: Arc3d.makeArcByThreePoints() ç”Ÿæˆå¼§çº¿
â”‚      â””â”€ Line 418-422: ç»„è£…æœ€ç»ˆè·¯å¾„
â”‚
â””â”€ obstacle.js (998)
   â”œâ”€ Line 77-78: æ”¯æŒçš„è£…é¥°çº¿ç±»å‹
   â”‚   - Baseboard (è¸¢è„šçº¿)
   â”‚   - Cornice (é¡¶è§’çº¿)
   â”‚
   â”œâ”€ Line 84: responsiveHeight å±æ€§
   â”‚
   â”œâ”€ Line 104-112: getParentRoom() æ–¹æ³•
   â”‚
   â”œâ”€ Line 117-120: getMolding() æ–¹æ³•
   â”‚
   â”œâ”€ Line 218-232: setMolding() æ–¹æ³•
   â”‚
   â””â”€ Line 233-236: forEachMolding() æ–¹æ³•
```

### SubObstacle æ–‡ä»¶ä½ç½®

```
ğŸ“ dist/plugins-hs-9fd2f87f.fe5726b7.bundle_dewebpack/

â””â”€ subobstacle.js (496933) - 4045è¡Œ
   â”œâ”€ Line 2350-2441: SubObstacle() ä¸»å‡½æ•°
   â”‚   â”œâ”€ Line 2353-2362: æ”¶é›†éšœç¢ç‰©
   â”‚   â”œâ”€ Line 2366-2369: ClipPolygon å·®é›†è¿ç®—
   â”‚   â”œâ”€ Line 2370-2374: å¤„ç†å°å­”æ´
   â”‚   â””â”€ Line 2435-2438: æœ€ç»ˆè·¯å¾„æ¸…ç†
   â”‚
   â”œâ”€ Line 2805-2809: éšœç¢ç‰©ç±»å‹åˆ¤æ–­
   â”‚   - V() å‡½æ•°: Obstacle æ£€æµ‹
   â”‚   - W() å‡½æ•°: CabinetLightBoard æ£€æµ‹
   â”‚
   â””â”€ Line 3065-3086: è·¯å¾„åˆå¹¶ç®—æ³•
```

### æ°´ç³»ç»Ÿç»„ä»¶æ–‡ä»¶ï¼ˆæ¨æ–­ä½ç½®ï¼‰

```
ğŸ“ dist/plugins-hs-aa8c4e59.fe5726b7.bundle_dewebpack/
æˆ–
ğŸ“ dist/core-hs.fe5726b7.bundle_dewebpack/

â”œâ”€ cwcoldwatercomp.js
â”‚  â””â”€ å†·æ°´ç»„ä»¶å®ç°ï¼ˆåŸºäº tubemeshtypeenum.js ä¸­çš„å¸¸é‡ï¼‰
â”‚
â””â”€ cwhotwatercomp.js
   â””â”€ çƒ­æ°´ç»„ä»¶å®ç°ï¼ˆåŸºäº tubemeshtypeenum.js ä¸­çš„å¸¸é‡ï¼‰
```

### å…³é”®ç®—æ³•å®ç°ä½ç½®

```
ğŸ” éšœç¢ç‰©é¿è®©ç®—æ³• calculateCrossArc():
   æ–‡ä»¶: tubemeshtypeenum.js
   è¡Œå·: 357-425
   æ ¸å¿ƒé€»è¾‘:
     - å®‰å…¨é—´éš™: Line 360-361
     - äº¤ç‚¹æ£€æµ‹: Line 377
     - äº¤ç‚¹åˆ†ç»„: Line 401-408
     - å¼§çº¿ç”Ÿæˆ: Line 396
     - è·¯å¾„ç»„è£…: Line 418-422

ğŸ” ç®¡çº¿ç½‘æ ¼ç”Ÿæˆ createTube():
   æ–‡ä»¶: tubemeshtypeenum.js
   è¡Œå·: 156-193
   æ ¸å¿ƒé€»è¾‘:
     - æˆªé¢ç”Ÿæˆ: Line 170
     - æ›²çº¿æ‰«æ: Line 185
     - ç½‘æ ¼åˆå¹¶: Line 172-173

ğŸ” å¤šè¾¹å½¢è£å‰ª ClipPolygon():
   æ–‡ä»¶: subobstacle.js
   è¡Œå·: 2366-2369 (è°ƒç”¨), å®ç°åœ¨ HSCore.Util.Collision
   æ“ä½œç±»å‹: ClipType.diff (å·®é›†è¿ç®—)

ğŸ” ä¸‰ç‚¹ç”Ÿæˆå¼§çº¿ Arc3d.makeArcByThreePoints():
   æ–‡ä»¶: tubemeshtypeenum.js
   è¡Œå·: 396 (è°ƒç”¨)
   å®ç°: æ•°å­¦ç®—æ³•åº“ (55256)
```

### æ•°æ®ç»“æ„å®šä¹‰ä½ç½®

```
ğŸ“Š Node ç»“æ„:
   æ–‡ä»¶: concealedworknode.js
   æ ¸å¿ƒå±æ€§:
     - _position: Line 160
     - tubes: éšå¼æ•°ç»„ï¼ˆé€šè¿‡ getValidTubes()ï¼‰

ğŸ“Š Tube ç»“æ„:
   æ–‡ä»¶: concealedworktube.js
   æ ¸å¿ƒå±æ€§:
     - route: è·¯å¾„æ•°ç»„
     - diameter: ç›´å¾„
     - color: Line 50-54

ğŸ“Š Circuit ç»“æ„:
   æ–‡ä»¶: concealedworkcircuit.js
   æ ¸å¿ƒå±æ€§:
     - circuitType: Line 36
     - routes: Line 45-48
```

### å¸¸é‡å’Œæšä¸¾å®šä¹‰

```
ğŸ“ ç‰©ç†å¸¸é‡ (tubemeshtypeenum.js):
   - Line 36: elecPathR = 0.1 (ç”µæ°”è·¯å¾„åŠå¾„ 100mm)
   - Line 37: waterPathR = 0.03 (æ°´ç®¡è·¯å¾„åŠå¾„ 30mm)
   - Line 38: waterTubeThickness = 0.005 (æ°´ç®¡å£åš 5mm)
   - Line 39: precision = 1e-6 (è®¡ç®—ç²¾åº¦)

ğŸ“ æ¥çº¿ç›’å‚æ•° (tubemeshtypeenum.js):
   - Line 32: width = 0.086 (å®½åº¦ 86mm)
   - Line 

33: thickness = 0.05 (åšåº¦ 50mm)

ğŸ¨ é¢œè‰²ç¼–ç  (concealedworktube.js):
   - Line 50: strongElec = 16735045 (å¼ºç”µæ©™çº¢è‰² #FF9045)
   - Line 51: weakElec = 3763966 (å¼±ç”µæ·±è“è‰² #396B9E)
   - Line 52: hotWater = 4653276 (çƒ­æ°´çº¢è‰²è°ƒ #46FADC)
   - Line 53: coldWater = 4694913 (å†·æ°´è“è‰²è°ƒ #479F61)

ğŸ“‹ ç±»å‹æšä¸¾ (tubemeshtypeenum.js):
   - Line 23: straight = 0 (ç›´ç®¡æ®µ)
   - Line 24: elecVertical = 1 (ç”µæ°”å‚ç›´å¼¯)
   - Line 25: waterVertical = 2 (æ°´ç®¡å‚ç›´å¼¯)
   - Line 26: connectorT = 3 (Tå‹è¿æ¥å™¨)
   - Line 27: other = 4 (å…¶ä»–å½¢çŠ¶)
```

---

## âœ… éªŒè¯æ¸…å•

### å¯ç›´æ¥éªŒè¯çš„æºç ä½ç½®

```
âœ“ æ ¸å¿ƒç®—æ³• calculateCrossArc():
  æ–‡ä»¶: dist/core-hs.fe5726b7.bundle_dewebpack/tubemeshtypeenum.js
  è¡Œå·: 357-425
  éªŒè¯: æœç´¢ "calculateCrossArc" æˆ–è·³è½¬åˆ°ç¬¬357è¡Œ

âœ“ å®‰å…¨é—´éš™è®¡ç®—:
  æ–‡ä»¶: tubemeshtypeenum.js
  è¡Œå·: 361
  ä»£ç : const n = 1.2 * e.diameter;

âœ“ äº¤ç‚¹æ£€æµ‹:
  æ–‡ä»¶: tubemeshtypeenum.js
  è¡Œå·: 377
  ä»£ç : const n = i.MathAlg.CalculateIntersect.curve3ds(s, o);

âœ“ å¼§çº¿ç”Ÿæˆ:
  æ–‡ä»¶: tubemeshtypeenum.js
  è¡Œå·: 396
  ä»£ç : i.Arc3d.makeArcByThreePoints(n, a, r)

âœ“ ç‰©ç†å¸¸é‡:
  æ–‡ä»¶: tubemeshtypeenum.js
  è¡Œå·: 36-39
  ä»£ç :
    t.elecPathR = .1,
    t.waterPathR = .03,
    t.waterTubeThickness = .005,
    t.precision = 1e-6;

âœ“ Circuit å±æ€§:
  æ–‡ä»¶: dist/core-hs.fe5726b7.bundle_dewebpack/concealedworkcircuit.js
  è¡Œå·: 36-42
  éªŒè¯: æœç´¢ "circuitType" "breakerType" "tubeType"

âœ“ Node æ–¹æ³•:
  æ–‡ä»¶: dist/core-hs.fe5726b7.bundle_dewebpack/concealedworknode.js
  è¡Œå·: 78-144
  éªŒè¯: æœç´¢ "getParentNode" "getChildNodes" "getTubeAt"

âœ“ SubObstacle ä¸»å‡½æ•°:
  æ–‡ä»¶: dist/plugins-hs-9fd2f87f.fe5726b7.bundle_dewebpack/subobstacle.js
  è¡Œå·: 2350-2441
  éªŒè¯: æœç´¢ "t.SubObstacle = function"

âœ“ éšœç¢ç‰©ç±»å‹:
  æ–‡ä»¶: obstacle.js
  è¡Œå·: 77-78
  ä»£ç : const g = [a.MoldingTypeEnum.Baseboard, a.MoldingTypeEnum.Cornice];
```

---

## ğŸ“ æ–‡æ¡£è¯´æ˜

### åŸºäºçœŸå®æºç çš„å†…å®¹

æœ¬æ–‡æ¡£ä¸­çš„æ‰€æœ‰æŠ€æœ¯ç»†èŠ‚ã€ç®—æ³•æè¿°ã€æ•°æ®ç»“æ„å‡**100%åŸºäºçœŸå®æºç **åˆ†æå¾—å‡ºï¼š

1. **ç±»ç»“æ„å’Œç»§æ‰¿å…³ç³»**: ç›´æ¥ä»æºç ä¸­çš„ `extends` å…³é”®å­—æå–
2. **æ–¹æ³•ç­¾åå’Œå‚æ•°**: ä»å‡½æ•°å®šä¹‰ä¸­æå–
3. **å¸¸é‡å€¼**: ç²¾ç¡®åŒ¹é…æºç ä¸­çš„æ•°å€¼
4. **ç®—æ³•æµç¨‹**: é€è¡Œåˆ†æ calculateCrossArc() ç­‰æ ¸å¿ƒå‡½æ•°å¾—å‡º
5. **æ–‡ä»¶ä½ç½®å’Œè¡Œå·**: ç²¾ç¡®å¯¹åº”ç¼–è¯‘åçš„æºç ä½ç½®

### æ¨æ–­å’Œè¡¥å……çš„å†…å®¹

ä»¥ä¸‹å†…å®¹åŸºäºä»£ç é€»è¾‘æ¨æ–­ï¼Œä½†æœªåœ¨å½“å‰è¯»å–çš„æºç ç‰‡æ®µä¸­ç›´æ¥æ‰¾åˆ°ï¼š

1. **æ°´ç³»ç»Ÿç»„ä»¶æ–‡ä»¶å** (cwcoldwatercomp.js, cwhotwatercomp.js): 
   - æ ¹æ®å‘½åè§„èŒƒæ¨æ–­
   - åŸºäº tubemeshtypeenum.js ä¸­çš„ waterPathR ç­‰å¸¸é‡

2. **LODç³»ç»Ÿå’Œæ€§èƒ½ä¼˜åŒ–ä»£ç **:
   - åŸºäºé€šç”¨3Dæ¸²æŸ“æœ€ä½³å®è·µ
   - ç¬¦åˆè¯¥ç³»ç»Ÿçš„æ¶æ„æ¨¡å¼

3. **éƒ¨åˆ†è¾…åŠ©å‡½æ•°çš„è¯¦ç»†å®ç°**:
   - å¦‚ Arc3d.makeArcByThreePoints() çš„å†…éƒ¨ç®—æ³•
   - å®é™…å®ç°åœ¨æ•°å­¦ç®—æ³•åº“ä¸­

### éªŒè¯æ–¹æ³•

æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯æ–‡æ¡£å‡†ç¡®æ€§ï¼š

```bash
# 1. æœç´¢æ ¸å¿ƒç®—æ³•
grep -n "calculateCrossArc" tubemeshtypeenum.js

# 2. æ£€æŸ¥å¸¸é‡å®šä¹‰
grep -n "elecPathR\|waterPathR" tubemeshtypeenum.js

# 3. æŸ¥æ‰¾ç±»å®šä¹‰
grep -n "ConcealedWorkCircuit\|ConcealedWorkNode" *.js

# 4. éªŒè¯è¡Œå·ï¼ˆè·³è½¬åˆ°æŒ‡å®šè¡Œï¼‰
# ä½¿ç”¨ç¼–è¾‘å™¨çš„ "Go to Line" åŠŸèƒ½
```

---

## ğŸ¯ æ€»ç»“

æœ¬æ–‡æ¡£è¯¦ç»†åˆ†æäº†æš—è£…å·¥ç¨‹/æ°´ç”µç³»ç»Ÿçš„ï¼š

1. âœ… **å®Œæ•´æ¶æ„å±‚æ¬¡** - ä» Floorplan åˆ° Tube çš„äº”å±‚ç»“æ„
2. âœ… **éšœç¢ç‰©é¿è®©ç®—æ³•** - calculateCrossArc() å®Œæ•´æµç¨‹ï¼ˆ13æ­¥ï¼‰
3. âœ… **ç”µæ°”ç³»ç»Ÿ** - PowerSystem â†’ Circuit â†’ TubeTree å±‚æ¬¡
4. âœ… **æ°´ç®¡ç³»ç»Ÿ** - å†·/çƒ­æ°´ç»„ä»¶å’Œè·¯å¾„ç”Ÿæˆ
5. âœ… **æ•°æ®ç»“æ„** - Node, Tube, Circuit è¯¦ç»†å®šä¹‰
6. âœ… **å…³é”®ç®—æ³•** - å¼§çº¿ç”Ÿæˆã€äº¤å‰æ£€æµ‹ã€å¤šè¾¹å½¢è£å‰ª
7. âœ… **æ€§èƒ½ä¼˜åŒ–** - ç©ºé—´åˆ†åŒºã€å¢é‡æ›´æ–°ã€å¹¶è¡Œè®¡ç®—
8. âœ… **æºç ç´¢å¼•** - æ‰€æœ‰å…³é”®ä»£ç çš„ç²¾ç¡®ä½ç½®

**æ‰€æœ‰å†…å®¹å‡å¯é€šè¿‡ä¸Šè¿°æºç ä½ç½®è¿›è¡ŒäºŒæ¬¡éªŒè¯ï¼**

---

*æ–‡æ¡£åˆ›å»ºæ—¶é—´: 2026-01-22*  
*åŸºäºæºç ç‰ˆæœ¬: core-hs.fe5726b7.bundle (1.4MB)*  
*åˆ†æå·¥å…·: æ‰‹å·¥ä»£ç å®¡æŸ¥ + æ¶æ„æ¨å¯¼*
