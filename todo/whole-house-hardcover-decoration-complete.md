
# å…¨å±‹ç¡¬è£…ç³»ç»Ÿå®Œæ•´æ¶æ„æ–‡æ¡£ ğŸ 

> **æ–‡æ¡£è¯´æ˜**: æœ¬æ–‡æ¡£è¯¦ç»†è§£æå…¨å±‹ç¡¬è£…ç³»ç»Ÿçš„å®Œæ•´æ¶æ„ï¼ŒåŒ…æ‹¬æˆ¿é—´ç®¡ç†ã€åœ°é¢é“ºè£…ã€å¢™é¢è£…é¥°ã€åŠé¡¶è®¾è®¡ã€è£…é¥°çº¿ç­‰ç¡¬è£…æ ¸å¿ƒåŠŸèƒ½ã€‚åŸºäºçœŸå®æºç é€†å‘åˆ†æã€‚

---

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ä¸€ç³»ç»Ÿæ¦‚è¿°)
2. [æ•´ä½“æ¶æ„å›¾](#äºŒæ•´ä½“æ¶æ„å›¾)
3. [æˆ¿é—´ç®¡ç†ç³»ç»Ÿ](#ä¸‰æˆ¿é—´ç®¡ç†ç³»ç»Ÿ)
4. [é“ºè£…ç³»ç»Ÿ](#å››é“ºè£…ç³»ç»Ÿ)
5. [æè´¨ç®¡ç†ç³»ç»Ÿ](#äº”æè´¨ç®¡ç†ç³»ç»Ÿ)
6. [åŠé¡¶ç³»ç»Ÿ](#å…­åŠé¡¶ç³»ç»Ÿ)
7. [åœ°æ¿ç³»ç»Ÿ](#ä¸ƒåœ°æ¿ç³»ç»Ÿ)
8. [è£…é¥°çº¿ç³»ç»Ÿ](#å…«è£…é¥°çº¿ç³»ç»Ÿ)
9. [ç¡¬è£…å·¥ä½œæµç¨‹](#ä¹ç¡¬è£…å·¥ä½œæµç¨‹)
10. [æ•°æ®ç»“æ„è¯¦è§£](#åæ•°æ®ç»“æ„è¯¦è§£)
11. [æºç æ–‡ä»¶ç´¢å¼•](#åä¸€æºç æ–‡ä»¶ç´¢å¼•)

---

## ä¸€ã€ç³»ç»Ÿæ¦‚è¿°

### 1.1 ä»€ä¹ˆæ˜¯å…¨å±‹ç¡¬è£…ç³»ç»Ÿ

**å…¨å±‹ç¡¬è£…ç³»ç»Ÿ** (Whole House Hardcover Decoration System) æ˜¯ä¸€ä¸ªå®Œæ•´çš„å®¤å†…ç¡¬è£…è®¾è®¡å’ŒæŠ¥ä»·è§£å†³æ–¹æ¡ˆï¼Œæ¶µç›–:

- ğŸ  **æˆ¿é—´ç®¡ç†**: æˆ¿é—´ç±»å‹ã€é¢ç§¯ã€å‘¨é•¿ã€å‘½å
- ğŸ¨ **åœ°é¢é“ºè£…**: åœ°æ¿ã€ç“·ç –ã€æ‹¼èŠ±ã€å¼‚å½¢é“ºè´´
- ğŸ–¼ï¸ **å¢™é¢è£…é¥°**: å¢™çº¸ã€æ¶‚æ–™ã€å¢™ç –ã€èƒŒæ™¯å¢™
- ğŸ—ï¸ **åŠé¡¶è®¾è®¡**: å¹³é¢åŠé¡¶ã€é€ å‹åŠé¡¶ã€å‚æ•°åŒ–åŠé¡¶
- ğŸ€ **è£…é¥°çº¿**: è¸¢è„šçº¿ã€é¡¶è§’çº¿ã€è…°çº¿ã€é—¨å¥—çº¿
- ğŸ“Š **ææ–™ç»Ÿè®¡**: è‡ªåŠ¨è®¡ç®—é¢ç§¯ã€æ•°é‡ã€æŠ¥ä»·
- ğŸ’° **BOMç”Ÿæˆ**: ä¸€é”®å¯¼å‡ºææ–™æ¸…å•å’Œé¢„ç®—

### 1.2 æ ¸å¿ƒæŠ€æœ¯ç‰¹ç‚¹

| ç‰¹æ€§ | å®ç°æ–¹å¼ | ä¼˜åŠ¿ |
|------|---------|------|
| æˆ¿é—´è‡ªåŠ¨è¯†åˆ« | å¢™ä½“é—­åˆæ£€æµ‹ + åŒºåŸŸæå– | å¿«é€Ÿè¯†åˆ«æˆ¿é—´è¾¹ç•Œ |
| æ™ºèƒ½é“ºè£… | MixPaintæ··åˆæ¶‚è£… + æ‹¼èŠ±æ¨¡å¼ | æ”¯æŒå¤æ‚æ‹¼èŠ±è®¾è®¡ |
| å¼‚å½¢ç“·ç –è®¡ç®— | PaveRubbleAlgorithmæ™ºèƒ½ç®—æ³• | ç²¾ç¡®è®¡ç®—ç“·ç –ç”¨é‡ |
| é¢çº§æè´¨ | Faceçº§åˆ«æè´¨ç®¡ç† | ç²¾ç»†åŒ–æè´¨æ§åˆ¶ |
| è£…é¥°çº¿è‡ªåŠ¨å¸é™„ | å¢™ä½“/å¤©èŠ±æ¿è½®å»“æå– | è‡ªåŠ¨ç”Ÿæˆè£…é¥°çº¿è·¯å¾„ |
| å®æ—¶æŠ¥ä»· | BOM2/BOM3æ•°æ®å¼•æ“ | å³æ—¶è®¡ç®—ææ–™æˆæœ¬ |

### 1.3 åº”ç”¨åœºæ™¯

- âœ… **å®¶è£…è®¾è®¡å…¬å¸**: å¿«é€Ÿå‡ºå›¾ã€ç²¾å‡†æŠ¥ä»·
- âœ… **è£…ä¿®å…¬å¸**: ææ–™æ¸…å•ã€æ–½å·¥å›¾çº¸
- âœ… **ä¸šä¸»DIY**: è‡ªåŠ©è®¾è®¡ã€é¢„ç®—æ§åˆ¶
- âœ… **ææ–™ä¾›åº”å•†**: ææ–™æ¨èã€ç”¨é‡è®¡ç®—
- âœ… **å·¥ç¨‹ç®¡ç†**: è¿›åº¦è·Ÿè¸ªã€æˆæœ¬æ ¸ç®—

---

## äºŒã€æ•´ä½“æ¶æ„å›¾

### 2.1 ç³»ç»Ÿåˆ†å±‚æ¶æ„

```mermaid
graph TB
    subgraph "å…¨å±‹ç¡¬è£…ç³»ç»Ÿ Whole House Hardcover System"
        
        subgraph "ç”¨æˆ·äº¤äº’å±‚ UI Layer"
            UI1[æˆ¿é—´ç¼–è¾‘å™¨<br/>Room Editor]
            UI2[æè´¨é€‰æ‹©å™¨<br/>Material Selector]
            UI3[é“ºè£…è®¾è®¡å™¨<br/>Pave Designer]
            UI4[åŠé¡¶è®¾è®¡å™¨<br/>Ceiling Designer]
            UI5[è£…é¥°çº¿ç¼–è¾‘å™¨<br/>Molding Editor]
            UI6[BOMæŠ¥ä»·å¯¼å‡º<br/>BOM Export]
        end
        
        subgraph "ä¸šåŠ¡é€»è¾‘å±‚ Business Logic Layer"
            BL1[æˆ¿é—´ç®¡ç†å™¨<br/>RoomEntity]
            BL2[é“ºè£…ç®¡ç†å™¨<br/>PaveEntity]
            BL3[æè´¨ç®¡ç†å™¨<br/>B2Material/B3Material]
            BL4[åŠé¡¶ç­–ç•¥<br/>CeilingStrategy]
            BL5[åœ°æ¿ç®¡ç†<br/>Floor]
            BL6[è£…é¥°çº¿ç®¡ç†<br/>Molding]
            BL7[BOMå¤„ç†å™¨<br/>B2Room/B3Room]
        end
        
        subgraph "æ•°æ®å¤„ç†å±‚ Data Processing Layer"
            DP1[æˆ¿é—´æ•°æ®<br/>RoomData]
            DP2[é“ºè£…æ•°æ®<br/>PaveData]
            DP3[æè´¨æ•°æ®<br/>MaterialData]
            DP4[é¢æ•°æ®<br/>FaceData]
            DP5[åŒºåŸŸæ•°æ®<br/>RegionData]
            DP6[è£…é¥°çº¿æ•°æ®<br/>MoldingData]
        end
        
        subgraph "å‡ ä½•å¼•æ“å±‚ Geometry Engine Layer"
            GE1[æˆ¿é—´è½®å»“<br/>Room Polygon]
            GE2[é“ºè£…åŒºåŸŸ<br/>Pave Region]
            GE3[é¢å‡ ä½•<br/>Face Geometry]
            GE4[è£…é¥°çº¿è·¯å¾„<br/>Molding Path]
            GE5[å¸ƒå°”è¿ç®—<br/>ClipperLib]
            GE6[æ‹¼èŠ±ç®—æ³•<br/>PaveRubbleAlgorithm]
        end
        
        subgraph "æ ¸å¿ƒæ¨¡å‹å±‚ Core Model Layer"
            CM1[Wall å¢™ä½“]
            CM2[Face é¢]
            CM3[Slab æ¥¼æ¿]
            CM4[Layer å›¾å±‚]
            CM5[Scene åœºæ™¯]
            CM6[Material æè´¨]
        end
    end
    
    %% å±‚æ¬¡ä¾èµ–
    UI1 --> BL1
    UI2 --> BL3
    UI3 --> BL2
    UI4 --> BL4
    UI5 --> BL6
    UI6 --> BL7
    
    BL1 --> DP1
    BL2 --> DP2
    BL3 --> DP3
    BL4 --> DP3
    BL5 --> DP3
    BL6 --> DP6
    
    DP1 --> GE1
    DP2 --> GE2
    DP3 --> GE3
    DP4 --> GE3
    DP5 --> GE2
    DP6 --> GE4
    
    GE1 --> CM1
    GE2 --> CM2
    GE3 --> CM2
    GE4 --> CM2
    GE5 --> CM2
    GE6 --> CM2
    
    CM1 --> CM5
    CM2 --> CM5
    CM3 --> CM5
    CM4 --> CM5
    CM6 --> CM2
```

### 2.2 æ ¸å¿ƒæ¨¡å—å…³ç³»

```mermaid
classDiagram
    class Scene {
        +layers: Layer[]
        +activeLayer: Layer
        +getRoom(id): Room
        +getPave(id): Pave
        +getMaterial(id): Material
    }
    
    class Layer {
        +id: string
        +name: string
        +altitude: number
        +rooms: Room[]
        +walls: Wall[]
        +ceilings: Ceiling[]
        +floors: Floor[]
    }
    
    class Room {
        +id: string
        +roomType: string
        +displayName: string
        +area: number
        +spaceGirth: number
        +center: Point3D
        +faces: Face[]
        +paves: Pave[]
        +moldings: Molding[]
    }
    
    class Pave {
        +id: string
        +faceIds: string[]
        +mixPaint: MixPaint
        +regions: Region[]
        +independentRegions: Region[]
        +material: Material
        +patternInfo: PatternInfo
    }
    
    class Region {
        +uid: string
        +path: Polygon2D
        +area: number
        +unitId: string
        +materialSeekId: string
        +count: number
        +isRubble: boolean
    }
    
    class Material {
        +seekId: string
        +displayName: string
        +category: string
        +categoryType: string
        +brand: string
        +color: Color
        +tileSize_x: number
        +tileSize_y: number
        +textureUrl: string
        +count: number
        +unit: string
    }
    
    class Face {
        +id: string
        +type: string
        +area: number
        +paveId: string
        +material: Material
        +location: string
        +parent: Room
    }
    
    class Ceiling {
        +id: string
        +ceilingType: string
        +height: number
        +roomInfos: RoomInfo[]
        +divideInfo: Object
        +isSplitCeiling: boolean
    }
    
    class Floor {
        +id: string
        +roomType: string
        +roomTypeDisplayName: string
        +ceilingHeight3d: number
        +roomInfos: RoomInfo[]
    }
    
    class Molding {
        +id: string
        +seekId: string
        +type: MoldingType
        +XSize: number
        +YSize: number
        +material: Material
        +host: Wall | Face
        +getPaths(): Path[]
    }
    
    Scene "1" *-- "*" Layer
    Layer "1" *-- "*" Room
    Room "1" *-- "*" Face
    Room "1" *-- "*" Pave
    Room "1" *-- "*" Molding
    Pave "1" *-- "*" Region
    Region --> Material
    Face --> Material
    Face --> Pave
    Ceiling --> Room
    Floor --> Room
    Molding --> Material
```

---

## ä¸‰ã€æˆ¿é—´ç®¡ç†ç³»ç»Ÿ

### 3.1 Roomå®ä½“ç»“æ„

**æºç æ–‡ä»¶**: 
- `plugins-hs-aa8c4e59/roomentity.js` (è¡Œ46-107)
- `plugins-hs-aa8c4e59/b2room.js` (è¡Œ43-105)
- `plugins-hs-aa8c4e59/b3room.js` (è¡Œ135-260)

**æ ¸å¿ƒå±æ€§**:

```typescript
class RoomEntity {
    // æ ‡è¯†ä¿¡æ¯
    id: string;                      // æˆ¿é—´å”¯ä¸€ID
    roomType: string;                // æˆ¿é—´ç±»å‹ (å®¢å…/å§å®¤/å¨æˆ¿ç­‰)
    displayName: string;             // æ˜¾ç¤ºåç§°
    displayNameCustom: string;       // è‡ªå®šä¹‰åç§°
    
    // å‡ ä½•ä¿¡æ¯
    center: Point3D;                 // æˆ¿é—´ä¸­å¿ƒç‚¹
    size: Point3D;                   // æˆ¿é—´å°ºå¯¸ [å®½, é•¿, é«˜]
    area: number;                    // æˆ¿é—´é¢ç§¯ (ã¡)
    spaceGirth: number;              // æˆ¿é—´å‘¨é•¿ (m)
    rawPath2d: Polygon2D;            // æˆ¿é—´è½®å»“
    bound: BoundingBox;              // åŒ…å›´ç›’
    
    // å…³è”ä¿¡æ¯
    layerId: string;                 // æ‰€å±å›¾å±‚ID
    parentId: string;                // çˆ¶å¯¹è±¡ID
    relationRooms: Room[];           // å…³è”æˆ¿é—´ (å¦‚å¥—é—´)
    
    // è£…é¥°ä¿¡æ¯
    faces: Face[];                   // æˆ¿é—´é¢åˆ—è¡¨
    paves: Pave[];                   // é“ºè£…åˆ—è¡¨
    moldings: Molding[];             // è£…é¥°çº¿åˆ—è¡¨
    contents: Content[];             // å®¶å…·å†…å®¹
    customizations: Customization[]; // å®šåˆ¶æ¨¡å‹
}
```

### 3.2 æˆ¿é—´ç±»å‹æšä¸¾

**æˆ¿é—´ç±»å‹** (`RoomType`):
- `living_room` - å®¢å…
- `dining_room` - é¤å…
- `master_bedroom` - ä¸»å§
- `second_bedroom` - æ¬¡å§
- `kids_room` - å„¿ç«¥æˆ¿
- `study` - ä¹¦æˆ¿
- `kitchen` - å¨æˆ¿
- `bathroom` - å«ç”Ÿé—´
- `balcony` - é˜³å°
- `hallway` - è¿‡é“
- `cloakroom` - è¡£å¸½é—´
- `storage` - å‚¨è—å®¤
- `none` - 

æœªå‘½å

**æˆ¿é—´æ’åºè§„åˆ™** (`RoomTypeOrderEnum`):
- æŒ‰ä½¿ç”¨é¢‘ç‡å’Œé‡è¦æ€§æ’åº
- å®¢å… â†’ é¤å… â†’ ä¸»å§ â†’ æ¬¡å§ â†’ å¨æˆ¿ â†’ å«ç”Ÿé—´ â†’ é˜³å° â†’ å…¶ä»–

### 3.3 æˆ¿é—´é¢ç§¯è®¡ç®—

**æºç **: `roomentity.js` (è¡Œ77-104)

**è®¡ç®—æ–¹æ³•**:
1. è·å–æˆ¿é—´è½®å»“ `rawPath2d` (Polygon2D)
2. ä½¿ç”¨å·¥å…·å‡½æ•° `Utils.getArea(rawPath2d)` è®¡ç®—é¢ç§¯
3. é¢ç§¯å•ä½: å¹³æ–¹ç±³ (ã¡)
4. è€ƒè™‘å¢™ä½“åšåº¦: ä½¿ç”¨å‡€é¢ç§¯ (è½®å»“å†…éƒ¨é¢ç§¯)

**å‘¨é•¿è®¡ç®—** (`spaceGirth`):
```
å‘¨é•¿ = Î£(æˆ¿é—´è½®å»“å„è¾¹é•¿åº¦)
éå† rawPath2d.outer çš„æ‰€æœ‰è¾¹
ç´¯åŠ  edge.getLength()
```

### 3.4 æˆ¿é—´ä¸­å¿ƒç‚¹è®¡ç®—

**æºç **: `roomentity.js` (è¡Œ84)

**ç®—æ³•**:
```
è·å–åŒ…å›´ç›’ bound = room.bound
topLeft = bound.getTopLeft()
bottomRight = bound.getBottomRight()

ä¸­å¿ƒç‚¹ center = [
    (topLeft.x + bottomRight.x) / 2,
    (topLeft.y + bottomRight.y) / 2,
    å›¾å±‚æ ‡é«˜ altitude
]

å°ºå¯¸ size = [
    abs(topLeft.x - bottomRight.x),
    abs(topLeft.y - bottomRight.y),
    é»˜è®¤å±‚é«˜ 2.8m
]
```

### 3.5 å…³è”æˆ¿é—´ç³»ç»Ÿ

**æºç **: `b3room.js` (è¡Œ157-174)

**åŠŸèƒ½**: æ”¯æŒå¥—é—´ã€è¿é€šæˆ¿é—´å…³è”

**æ•°æ®ç»“æ„**:
```typescript
relationRooms: [
    {
        id: "room-123",
        type: "bathroom",
        displayName: "å«ç”Ÿé—´",
        displayNameCustom: "ä¸»å«"
    }
]
```

**åº”ç”¨åœºæ™¯**:
- ä¸»å§ â†” ä¸»å«
- å®¢å… â†” é¤å…
- å¨æˆ¿ â†” ç”Ÿæ´»é˜³å°

---

## å››ã€é“ºè£…ç³»ç»Ÿ

### 4.1 Paveé“ºè£…æ¶æ„

**æºç æ–‡ä»¶**: 
- `paveentity.js` (è¡Œ48-163)
- `b3pave.js` (è¡Œ44-63)

**é“ºè£…ç±»å‹**:

1. **å•ä¸€æè´¨é“ºè£…** (Single Material)
   - æ•´ä¸ªåŒºåŸŸä½¿ç”¨åŒä¸€ç§æè´¨
   - ä¾‹å¦‚: å…¨æˆ¿æœ¨åœ°æ¿ã€å…¨æˆ¿ç“·ç –

2. **æ‹¼èŠ±é“ºè£…** (Pattern Pave)
   - å¤šç§æè´¨ç»„åˆæˆå›¾æ¡ˆ
   - ä¾‹å¦‚: æ³¢æ‰“çº¿ã€æ‹¼èŠ±åœ°ç –ã€è±å½¢æ‹¼æ¥

3. **å¼‚å½¢é“ºè£…** (Rubble Pave)
   - ä¸è§„åˆ™åŒºåŸŸçš„æ™ºèƒ½é“ºè´´
   - è‡ªåŠ¨è®¡ç®—ç“·ç –åˆ‡å‰²å’Œç”¨é‡

### 4.2 é“ºè£…æ•°æ®ç»“æ„

**æ ¸å¿ƒå±æ€§**:
```typescript
class PaveEntity {
    // åŸºç¡€ä¿¡æ¯
    id: string;                      // é“ºè£…ID
    faceIds: string[];               // å…³è”çš„é¢IDåˆ—è¡¨
    faceGroupId: string;             // é¢ç»„ID
    parentId: string;                // çˆ¶é¢ID
    faceOwnerId: string;             // é¢æ‰€æœ‰è€…ID (å¯é€‰)
    
    // é“ºè£…å†…å®¹
    mixPaint: MixPaint;              // æ··åˆæ¶‚è£…å¯¹è±¡
    outline: Polygon2D;              // é“ºè£…è½®å»“
    regions: Region[];               // æ™®é€šåŒºåŸŸ
    independentRegions: Region[];    // ç‹¬ç«‹åŒºåŸŸ
    
    // æè´¨ä¿¡æ¯
    material: Material;              // å•ä¸€æè´¨ (å¯é€‰)
    patternInfo: PatternInfo;        // æ‹¼èŠ±æ¨¡å¼ä¿¡æ¯
    blocks: Block[];                 // é“ºè´´å—æ•°æ®
    modifyBricks: ModifyBrick[];     // ä¿®æ”¹çš„ç –å—
}
```

### 4.3 RegionåŒºåŸŸç»“æ„

**æºç **: `paveentity.js` (è¡Œ67-85)

```typescript
class RegionEntity {
    uid: string;                     // åŒºåŸŸå”¯ä¸€ID
    region: Region;                  // åŒºåŸŸå¯¹è±¡
    outline: Polygon2D;              // åŒºåŸŸè½®å»“
    mixPave: MixPave;                // æ··åˆé“ºè£…
    faceIds: string[];               // å…³è”é¢ID
    
    // åŒºåŸŸå±æ€§
    path: Polygon2D;                 // è·¯å¾„
    area: number;                    // é¢ç§¯
    
    // é“ºè´´ä¿¡æ¯
    unitId: string;                  // å•å…ƒID
    materialSeekId: string;          // æè´¨SeekID
    count: number;                   // æ•°é‡
    isRubble: boolean;               // æ˜¯å¦å¼‚å½¢
}
```

### 4.4 é“ºè£…è½®å»“è®¡ç®—ç®—æ³•

**æºç **: `paveentity.js` (è¡Œ113-159)

**ç®—æ³•æµç¨‹**:

```
æ­¥éª¤1: è·å–åŸºç¡€è½®å»“
  if (å¤šé¢ç»„é“ºè£…) {
      è·å–æ‰€æœ‰é¢ faces = getFaceIds()
      åˆå§‹åŒ–è½®å»“åˆ—è¡¨ outlines = []
      
      for each face in faces:
          è·å–é¢çš„å­”æ´è·¯å¾„ holesPath2d
          è·å–éšœç¢ç‰©è·¯å¾„ obstaclePath
          åº”ç”¨å˜æ¢çŸ©é˜µ transformMap[face.id]
          outlines.push(holesPath2d, obstaclePath)
      
      èƒŒæ™¯è·¯å¾„ = mixPaint.getBackgroundPath()
      æœ€ç»ˆè½®å»“ = ClipperLib.clip(èƒŒæ™¯è·¯å¾„, outlines, ClipMode.Diff)
  }
  else if (å•é¢é“ºè£…) {
      åŸå§‹è·¯å¾„ = srcEntity.rawPath2d
      å¼€æ´è·¯å¾„ = getOpeningPath(srcEntity)
      éšœç¢ç‰©è·¯å¾„ = getObstaclePath(srcEntity)
      
      æœ€ç»ˆè½®å»“ = ClipperLib.clip(
          [åŸå§‹è·¯å¾„],
          [å¼€æ´è·¯å¾„, éšœç¢ç‰©è·¯å¾„],
          ClipMode.Diff
      )
  }

æ­¥éª¤2: å¤„ç†ç‹¬ç«‹åŒºåŸŸ
  for each independentRegion in mixPave.independentRegions:
      åˆ›å»º RegionEntity
      è®¾ç½® region, outline, mixPave, faceIds
      
æ­¥éª¤3: å¤„ç†æ™®é€šåŒºåŸŸ
  å‰©ä½™è½®å»“ = outline - independentRegionsè·¯å¾„
  
  for each region in mixPave.regions:
      åˆ›å»º RegionEntity
      ä½¿ç”¨å‰©ä½™è½®å»“
```

### 4.5 æ‹¼èŠ±æ¨¡å¼ç³»ç»Ÿ

**PatternInfo** (æ‹¼èŠ±æ¨¡å¼ä¿¡æ¯):
```typescript
{
    seekId: string;               // æ‹¼èŠ±æ¨¡å¼SeekID
    unitsInfos: UnitInfo[];       // å•å…ƒä¿¡æ¯åˆ—è¡¨
}

UnitInfo {
    unitId: string;               // å•å…ƒID
    xLength: number;              // Xæ–¹å‘é•¿åº¦
    yLength: number;              // Yæ–¹å‘é•¿åº¦  
    area: number;                 // å•å…ƒé¢ç§¯
    materials: Material[];        // æè´¨åˆ—è¡¨
}
```

**å¸¸è§æ‹¼èŠ±æ¨¡å¼**:
- æ­£æ–¹å½¢æ‹¼æ¥
- è±å½¢æ‹¼æ¥
- äººå­—å½¢æ‹¼æ¥
- ç”°å­—å½¢æ‹¼æ¥
- å·¥å­—å½¢æ‹¼æ¥
- æ³¢æ‰“çº¿ (è¾¹æ¡†è£…é¥°)

---

## äº”ã€æè´¨ç®¡ç†ç³»ç»Ÿ

### 5.1 B2Materialæè´¨å¤„ç†å™¨

**æºç æ–‡ä»¶**: `b2material.js` (è¡Œ134-539)

**æ ¸å¿ƒèŒè´£**:
1. æå–åœºæ™¯ä¸­æ‰€æœ‰æè´¨ä¿¡æ¯
2. ç»Ÿè®¡æè´¨ç”¨é‡ (é¢ç§¯/æ•°é‡)
3. å¤„ç†ç“·ç –å¼‚å½¢é“ºè´´è®¡ç®—
4. ç”ŸæˆBOMæè´¨æ¸…å•

### 5.2 æè´¨æ•°æ®ç»“æ„

**Materialå¯¹è±¡**:
```typescript
{
    // åŸºç¡€ä¿¡æ¯
    seekId: string;               // æè´¨SeekID (å”¯ä¸€æ ‡è¯†)
    name: string;                 // æè´¨åç§°
    displayName: string;          // æ˜¾ç¤ºåç§°
    
    // åˆ†ç±»ä¿¡æ¯
    category: string;             // åˆ†ç±»ID
    categoryType: string;         // åˆ†ç±»ç±»å‹åç§°
    brand: string;                // å“ç‰Œåç§°
    brandId: string;              // å“ç‰ŒID
    
    // è§†è§‰å±æ€§
    color: Color;                 // é¢œè‰²
    image: string;                // çº¹ç†å›¾ç‰‡URL
    textureUrl: string;           // çº¹ç†URL
    
    // å°ºå¯¸å’Œå•ä½
    size: {x: number, y: number}; // ç“·ç –å°ºå¯¸ (m)
    tileSize_x: number;           // ç“·ç –å®½åº¦
    tileSize_y: number;           // ç“·ç –é•¿åº¦
    
    // ç”¨é‡ç»Ÿè®¡
    count: number;                // æ•°é‡
    unit: string;                 // å•ä½ (ã¡/ç‰‡/å—)
    unitTypeStr: string;          // å•ä½ç±»å‹ ("area"/"other")
    locationFaceArea: number;     // ä½ç½®é¢ç§¯
    
    // ä½ç½®ä¿¡æ¯
    locationName: string;         // ä½ç½®åç§°
    roomId: string;               // æ‰€å±æˆ¿é—´ID
    
    // å¼‚å½¢é“ºè´´
    isRubble: boolean;            // æ˜¯å¦å¼‚å½¢
    patternUnitId: string;        // æ‹¼èŠ±å•å…ƒID
    patternInfo: PatternInfo;     // æ‹¼èŠ±ä¿¡æ¯
    rubblePath: RubblePath[];     // å¼‚å½¢è·¯å¾„
    regionArea: number;           // åŒºåŸŸæ€»é¢ç§¯
    keepInteger: boolean;         // ä¿æŒæ•´æ•°
}
```

### 5.3 æè´¨æå–æµç¨‹

**æºç **: `b2material.js` (è¡Œ158-281)

**å®Œæ•´æµç¨‹**:

```
buildBom2Data(filterOptions)
  â”‚
  â”œâ”€â†’ æ­¥éª¤1: æå–é“ºè£…æè´¨
  â”‚     â”‚
  â”‚     â””â”€â†’ for each pave in context.paves:
  â”‚           traverse pave tree
  â”‚           â†’ getPaveMaterials(pave)
  â”‚           â†’ å­˜å‚¨åˆ° Map<paveId, materials[]>
  â”‚
  â”œâ”€â†’ æ­¥éª¤2: æå–æˆ¿é—´é¢æè´¨
  â”‚     â”‚
  â”‚     â””â”€â†’ for each room in context.roomFaces:
  â”‚           for each face in room.faces:
  â”‚             if (face.paveId exists) {
  â”‚                 è·å–é“ºè£…æè´¨
  â”‚                 withFaceLocation() è®¾ç½®ä½ç½®
  â”‚             }
  â”‚             else if (face.material exists) {
  â”‚                 getMaterial() æå–æè´¨
  â”‚                 withFaceLocation() è®¾ç½®ä½ç½®
  â”‚             }
  â”‚             è®¾ç½® material.roomId
  â”‚
  â”œâ”€â†’ æ­¥éª¤3: æå–è‡ªå®šä¹‰å®ä½“æè´¨
  â”‚     â”‚
  â”‚     â””â”€â†’ for each customizedEntity:
  â”‚           æŸ¥æ‰¾å­é¢ 

(dbApi.findAll)
  â”‚           æå–é¢æè´¨
  â”‚           è®¾ç½® material.roomId
  â”‚
  â”œâ”€â†’ æ­¥éª¤4: æå–å¼€æ´æè´¨
  â”‚     â”‚
  â”‚     â””â”€â†’ for each opening in context.openings:
  â”‚           if (type === "wallHole" || "slabHole") {
  â”‚               æŸ¥æ‰¾æ´å£å­é¢
  â”‚               æå–æè´¨
  â”‚               withFaceLocation() è®¾ç½®ä½ç½®
  â”‚               è®¾ç½® material.roomId
  â”‚           }
  â”‚
  â””â”€â†’ æ­¥éª¤5: ç“·ç –å¼‚å½¢é“ºè´´è®¡ç®— â­â­â­
        â”‚
        â””â”€â†’ _calculateBrickMaterials(allMaterials, filterOptions)
              è¯¦è§ 5.5 èŠ‚
```

### 5.4 é¢ä½ç½®æšä¸¾

**æºç **: `b2material.js` (è¡Œ287-334)

**ä½ç½®ç±»å‹** (`LocationTypes`):

| ä½ç½® | è‹±æ–‡æ ‡è¯† | æ£€æµ‹æ¡ä»¶ | å›½é™…åŒ–Key |
|------|---------|---------|----------|
| å¢™æ´ | wallHole | parent.type === "wallHole" | plugin_bom_location_wallHole |
| æ¥¼æ¿å¼€æ´ | slabOpening | parent.type === "slabOpening" | plugin_bom_location_slabOpening |
| æ¥¼æ¿æ´å£ | slabHole | parent.type === "slabHole" | plugin_bom_location_slabHole |
| åœ°é¢ | floor | classType === "NgFloor" | plugin_bom_location_floor |
| åŠé¡¶ | ceiling | classType === "NgCeiling" | plugin_bom_location_ceiling |
| å¢™é¢ | face | classType === "NgFace" | plugin_bom_location_face |

### 5.5 ç“·ç –å¼‚å½¢é“ºè´´æ™ºèƒ½è®¡ç®— â­â­â­

**æºç **: `b2material.js` (è¡Œ493-536)

**ç®—æ³•æ ¸å¿ƒ**: `PaveRubbleAlgorithm.calculateRubbleCount()`

**å®Œæ•´æµç¨‹**:

```
æ­¥éª¤1: å»ºç«‹æè´¨å¼•ç”¨æ˜ å°„
  refSeekIdsæ˜ å°„è¡¨ = new Map()
  
  for each material in allMaterials:
      if (material.refSeekIds exists) {
          for each refId in refSeekIds:
              refSeekIdsæ˜ å°„è¡¨.set(refId, material.seekId)
          delete material.refSeekIds

æ­¥éª¤2: æŒ‰æ‹¼èŠ±æ¨¡å¼åˆ†ç»„
  å¼‚å½¢é“ºè£…ç»„ = new Map()
  
  for each material in allMaterials:
      // åº”ç”¨å¼•ç”¨æ˜ å°„
      if (refSeekIdsæ˜ å°„è¡¨.has(material.seekId)) {
          material.seekId = refSeekIdsæ˜ å°„è¡¨.get(material.seekId)
      }
      
      // åˆ†ç»„å¼‚å½¢é“ºè£…
      if (material.isRubble) {
          ç»„é”® = "${patternInfo.seekId}, ${patternUnitId}, ${seekId}"
          
          if (å¼‚å½¢é“ºè£…ç»„.has(ç»„é”®)) {
              å¼‚å½¢é“ºè£…ç»„.get(ç»„é”®).push(material)
          } else {
              å¼‚å½¢é“ºè£…ç»„.set(ç»„é”®, [material])
          }
      }

æ­¥éª¤3: è®¡ç®—æ¯ç»„å¼‚å½¢é“ºè£…æ•°é‡
  for each group in å¼‚å½¢é“ºè£…ç»„:
      åˆå¹¶æ‰€æœ‰è·¯å¾„ rubblePaths = []
      
      for each material in group:
          rubblePaths.push(...material.rubblePath)
      
      // åˆ¤æ–­æ˜¯å¦å¯ç”¨ç›’å­è®¡ç®—æ³•
      canUseBox = PaveRubbleAlgorithm.canUseBoxCalculate(group)
      
      è®¡ç®—å‚æ•° = canUseBox 
          ? undefined 
          : { outlineType: RubbleSizeTypeEnum.outerPath }
      
      // è°ƒç”¨å¼‚å½¢é“ºè´´ç®—æ³•
      countResult = PaveRubbleAlgorithm.calculateRubbleCount(
          patternInfo,        // æ‹¼èŠ±æ¨¡å¼
          patternUnitId,      // å•å…ƒID
          rubblePaths,        // è·¯å¾„åˆ—è¡¨
          è®¡ç®—å‚æ•°
      )
      
      // æ›´æ–°æ¯ä¸ªæè´¨çš„æ•°é‡
      for each material in group:
          material.count = countResult.countInfo.get(material.uid)
          
          // æ¸…ç†ä¸´æ—¶æ•°æ®
          delete material.uid
          delete material.isRubble
          delete material.rubblePath
          delete material.patternInfo
          delete material.patternUnitId
```

**ç®—æ³•ä¼˜åŒ–**:
- **ç›’å­è®¡ç®—æ³•**: è§„åˆ™åŒºåŸŸä½¿ç”¨çŸ©å½¢åŒ…å›´ç›’å¿«é€Ÿè®¡ç®—
- **å¤–è½®å»“æ³•**: ä¸è§„åˆ™åŒºåŸŸä½¿ç”¨ç²¾ç¡®è½®å»“è®¡ç®—
- **æ™ºèƒ½åˆ†ç»„**: ç›¸åŒæ‹¼èŠ±æ¨¡å¼çš„æè´¨åˆå¹¶è®¡ç®—ï¼Œæé«˜æ•ˆç‡

### 5.6 é“ºè£…æè´¨æå–

**æºç **: `b2material.js` (è¡Œ377-476)

**getPaveMaterials() æ–¹æ³•**:

```
è¾“å…¥: paveEntity (é“ºè£…å®ä½“)

æå–é€»è¾‘:
  blocks = pave.blocks              // é“ºè´´å—æ•°æ®
  material = pave.material          // å•ä¸€æè´¨
  patternInfo = pave.patternInfo    // æ‹¼èŠ±ä¿¡æ¯
  modifyBricks = pave.modifyBricks  // ä¿®æ”¹ç –å—

  if (material exists) {
      // å•ä¸€æè´¨é“ºè£…
      area = pave.area
      return [getMaterial(material, area)]
  }
  else if (blocks && patternInfo) {
      // æ‹¼èŠ±é“ºè£…
      materials = []
      
      for each block in blocks:
          // æŸ¥æ‰¾å¯¹åº”å•å…ƒä¿¡æ¯
          unitInfo = patternInfo.unitsInfos.find(
              u => u.unitId === block.unitId
          )
          
          // æŸ¥æ‰¾æè´¨ä¿¡æ¯
          materialInfo = unitInfo.materials.find(
              m => m.seekId === block.materialSeekId
          )
          
          // å¦‚æœæ‰¾ä¸åˆ°ï¼Œä»ä¿®æ”¹ç –å—ä¸­æŸ¥æ‰¾
          if (!materialInfo) {
              modifyBrick = modifyBricks.find(
                  mb => mb.material.seekId === block.materialSeekId
              )
              if (modifyBrick) {
                  materialInfo = modifyBrick.material
              }
          }
          
          // æ„å»ºæè´¨å¯¹è±¡
          material = {
              category: materialInfo.categoryType,
              categoryType: getCategoryTypeName(categoryType),
              brand: materialInfo.v,
              brandId: materialInfo.vId,
              color: getColor(materialInfo),
              count: block.count,
              image: materialInfo.textureUrl,
              name: materialInfo.displayName,
              seekId: materialInfo.seekId,
              size: {x: unitInfo.xLength, y: unitInfo.yLength},
              unit: "ç‰‡",
              refSeekIds: block.major?.refSeekIds,
              locationFaceArea: getBrickArea(block, unitInfo.area),
              keepInteger: true,
              regionArea: pave.area
          }
          
          // å¼‚å½¢é“ºè´´é¢å¤–ä¿¡æ¯
          if (block.isRubble) {
              material.isRubble = true
              material.patternUnitId = block.unitId
              material.patternInfo = patternInfo
              material.uid = pave.getId()
              material.rubblePath = block.path.flat().map(p => ({
                  uid: material.uid,
                  path: p.path,
                  area: p.area
              }))
          }
          
          materials.push(material)
      
      // é¢ç§¯å½’ä¸€åŒ–
      totalArea = sum(materials.map(m => m.locationFaceArea))
      ratio = pave.area / totalArea
      
      for each material in materials:
          material.locationFaceArea *= ratio
      
      return materials
  }
```

### 5.7 ç“·ç –é¢ç§¯è®¡ç®—

**æºç **: `b2material.js` (è¡Œ479-490)

**_getBrickArea() æ–¹æ³•**:

```
è¾“å…¥: block (é“ºè´´å—), unitArea (å•å…ƒé¢ç§¯)

è®¡ç®—é€»è¾‘:
  if (block.isRubble) {
      // å¼‚å½¢é“ºè´´: ç´¯åŠ æ‰€æœ‰è·¯å¾„å®é™…é¢ç§¯
      area = 0
      
      for each pathGroup in block.path:
          for each pathItem in pathGroup:
              area += pathItem.area
      
      return area
  }
  else {
      // è§„åˆ™é“ºè´´: å•å…ƒé¢ç§¯ Ã— æ•°é‡
      return unitArea Ã— block.count
  }
```

### 5.8 æè´¨å•ä½åˆ¤æ–­

**æºç **: `b2material.js` (è¡Œ337-374)

**getMaterial() æ–¹æ³•**:

```
åˆ¤æ–­æ˜¯å¦éœ€è¦æŒ‰ç‰‡è®¡ç®—:
  needCalculateBrickCount(materialSeekId) 
  â†’ æŸ¥è¯¢æè´¨æ˜¯å¦ä¸ºç“·ç –ç±»

å•ä½é€‰æ‹©:
  if (ç“·ç –ç±»æè´¨) {
      unit = "ç‰‡" (priceUnit)
      unitTypeStr = "other"
      
      // æ•°é‡è®¡ç®—
      count = dollarTransfer(
          validArea / (tileSize_x Ã— tileSize_y)
      )
  }
  else {
      unit = "ã¡" (areaUnit)
      unitTypeStr = "area"
      count = validArea
  }
```

---

## å…­ã€åŠé¡¶ç³»ç»Ÿ

### 6.1 CeilingåŠé¡¶ç»“æ„

**æºç æ–‡ä»¶**: 
- `core-hs/ceiling.js` (è¡Œ71-127)
- `plugins-hs-aa8c4e59/ceilingstrategy.js` (è¡Œ43-74)

**åŠé¡¶ç±»å‹**:
1. **å¹³é¢åŠé¡¶** - ç®€å•å¹³é¡¶
2. **é€ å‹åŠé¡¶** - å¤šçº§åŠé¡¶
3. **å‚æ•°åŒ–åŠé¡¶** - è‡ªå®šä¹‰åŠé¡¶æ¨¡å‹
4. **åˆ†å‰²åŠé¡¶** - åŒºåŸŸåˆ†å‰²è®¾è®¡

### 6.2 Ceilingæ ¸å¿ƒå±æ€§

```typescript
class Ceiling extends Face {
    // åŠé¡¶ä¿¡æ¯
    divideInfo: Object;           // åˆ†å‰²ä¿¡æ¯
    isSplitCeiling: boolean;      // æ˜¯å¦åˆ†å‰²åŠé¡¶
    
    // å…³è”ä¿¡æ¯
    roomInfos: RoomInfo[];        // å…³è”æˆ¿é—´ä¿¡æ¯
    structureFaces: Face[];       // ç»“æ„é¢åˆ—è¡¨
    
    // æ ¸å¿ƒæ–¹æ³•
    forEachWall(callback): void;      // éå†å¢™ä½“
    forEachSurface(callback): void;   // éå†è¡¨é¢
    forEachStructureFace(callback): void;  // éå†ç»“æ„é¢
}
```

### 6.3 åŠé¡¶åˆ†ç±»è¯†åˆ«

**æºç **: `ceilingstrategy.js` (è¡Œ52-71)

**getFlatEntityIdsAndCategory() æ–¹æ³•**:

```
è¾“å…¥: { instanceId, room }

è¯†åˆ«æµç¨‹:
  ceilings = room.ceiling_info?.ceilings || []
  

model_ceiling_info = room.ceiling_info?.model_ceiling_info || []
  
  // æŸ¥æ‰¾æ™®é€šåŠé¡¶
  for each ceiling in ceilings:
      if (ceiling.id === instanceId) {
          return {
              flatEntityIds: [ceiling.id],
              category: ENUM_SINGLE_SELECT_CATEGORY.Ceiling
          }
      }
  
  // æŸ¥æ‰¾å‚æ•°åŒ–åŠé¡¶æ¨¡å‹
  for each modelCeiling in model_ceiling_info:
      if (modelCeiling.id === instanceId) {
          return {
              flatEntityIds: [modelCeiling.id],
              category: ENUM_SINGLE_SELECT_CATEGORY.Ceiling
          }
      }
  
  return { flatEntityIds: [], category: undefined }
```

### 6.4 åŠé¡¶æè´¨è¿ç§»

**æºç **: `ceiling.js` (è¡Œ52-67)

**ç‰ˆæœ¬å…¼å®¹å¤„ç†**:
```
if (version < "0.14" && material.mixpaint && isRCP(ceiling)) {
    // RCP (Rigid Core Plank) æè´¨å˜æ¢çŸ©é˜µè¿ç§»
    matrix = MaterialUtil.getMigrateCeilingRCPMatrix(mixpaint)
    mixpaint.transform(matrix)
}
```

**RCPæè´¨**: åˆšæ€§æ ¸å¿ƒæ¿æï¼Œéœ€è¦ç‰¹æ®Šçš„UVæ˜ å°„å˜æ¢

---

## ä¸ƒã€åœ°æ¿ç³»ç»Ÿ

### 7.1 Flooråœ°æ¿ç»“æ„

**æºç æ–‡ä»¶**: `core-hs/floor.js` (è¡Œ86-152)

**æ ¸å¿ƒå±æ€§**:
```typescript
class Floor extends Face {
    // æˆ¿é—´ä¿¡æ¯
    roomType: string;                // æˆ¿é—´ç±»å‹
    roomTypeDisplayName: string;     // æˆ¿é—´ç±»å‹æ˜¾ç¤ºå
    
    // å‡ ä½•ä¿¡æ¯
    ceilingHeight3d: number;         // åŠé¡¶é«˜åº¦ (3D)
    
    // å…³è”ä¿¡æ¯
    roomInfos: RoomInfo[];           // æˆ¿é—´ä¿¡æ¯åˆ—è¡¨
    structureFaces: Face[];          // ç»“æ„é¢åˆ—è¡¨
    
    // æ ¸å¿ƒæ–¹æ³•
    forEachWall(callback): void;           // éå†å¢™ä½“
    forEachSurface(callback): void;        // éå†è¡¨é¢ (è¿”å› "floor")
    forEachStructureFace(callback): void;  // éå†ç»“æ„é¢
}
```

### 7.2 åœ°æ¿æè´¨é»˜è®¤å€¼

**æºç **: `floor.js` (è¡Œ66-80)

**ç‰ˆæœ¬å…¼å®¹**:
```
if (version < "0.29") {
    // æ£€æŸ¥æè´¨æ˜¯å¦ä¸ºç”Ÿæˆçš„é»˜è®¤æè´¨
    if (material.seekId === MaterialIdEnum.generated) {
        // æ›¿æ¢ä¸ºé»˜è®¤åœ°æ¿æè´¨
        material.seekId = HSConstants.Constants.DEFAULT_FLOOR_MATERIAL_SEEKID
    }
}
```

**DEFAULT_FLOOR_MATERIAL** é»˜è®¤åœ°æ¿æè´¨:
- SeekID: ç³»ç»Ÿé¢„å®šä¹‰
- ç±»å‹: æœ¨åœ°æ¿/å¤åˆåœ°æ¿
- ç”¨äºæœªæŒ‡å®šæè´¨çš„åœ°é¢

### 7.3 åœ°æ¿é«˜åº¦ç³»ç»Ÿ

**æºç **: `floor.js` (è¡Œ124-128)

**åŠé¡¶é«˜åº¦è·å–**:
```
è·å–åœ°æ¿æ‰€åœ¨å›¾å±‚ layer = getEntityLayer(floor)

if (layer instanceof Layer) {
    ceilingHeight3d = layer.height
}
else {
    ceilingHeight3d = 0
}
```

**å±‚é«˜è¯´æ˜**:
- é»˜è®¤å±‚é«˜: 2.8m
- ä»å›¾å±‚å¯¹è±¡è·å–
- ç”¨äºè®¡ç®—å¢™é¢é¢ç§¯

---

## å…«ã€è£…é¥°çº¿ç³»ç»Ÿ

### 8.1 Moldingè£…é¥°çº¿ç±»å‹

**æºç **: `molding.js` (è¡Œ33-45)

**MoldingTypeEnum** (è£…é¥°çº¿ç±»å‹æšä¸¾):

| ç±»å‹ | è‹±æ–‡æ ‡è¯† | ä¸­æ–‡åç§° | åº”ç”¨ä½ç½® |
|------|---------|---------|---------|
| Mitre | mitre | æ–œæ¥çº¿ | å¢™è§’è¿æ¥ |
| Baseboard | baseboard | è¸¢è„šçº¿ | å¢™ä½“åº•éƒ¨ |
| Cornice | cornice | é¡¶è§’çº¿ | å¢™é¡¶äº¤ç•Œ |
| Pocket | pocket | é—¨å¥—çº¿ | é—¨çª—è¾¹æ¡† |
| WallBoardBaseboard | wallboardbaseboard | å¢™æ¿è¸¢è„šçº¿ | å¢™æ¿åº•éƒ¨ |
| WallBoardWaistLine | wallboardwaistline | å¢™æ¿è…°çº¿ | å¢™æ¿ä¸­éƒ¨ |
| CustomizedModelMolding | customizedmodelmolding | è‡ªå®šä¹‰æ¨¡å‹è£…é¥°çº¿ | è‡ªå®šä¹‰ä½ç½® |
| NCustomizedModelMolding | ncustomizedmodelmolding | æ–°è‡ªå®šä¹‰æ¨¡å‹è£…é¥°çº¿ | è‡ªå®šä¹‰ä½ç½® |

### 8.2 Moldingæ ¸å¿ƒå±æ€§

**æºç **: `molding.js` (è¡Œ93-232)

```typescript
class Molding extends Entity {
    // æè´¨ä¿¡æ¯
    _seekId: string;              // æè´¨SeekID
    metadata: Meta;               // äº§å“å…ƒæ•°æ®
    material: Material;           // æè´¨å¯¹è±¡
    
    // å°ºå¯¸ä¿¡æ¯
    __XSize: number;              // Xæ–¹å‘å°ºå¯¸ (é»˜è®¤0.1m)
    __YSize: number;              // Yæ–¹å‘å°ºå¯¸ (é»˜è®¤0.1m)
    XLength: number;              // Xæ–¹å‘é•¿åº¦ (ä»metadata)
    YLength: number;              // Yæ–¹å‘é•¿åº¦ (ä»metadata)
    
    // å®¿ä¸»å…³è”
    _host: Wall | Face;           // å®¿ä¸»å¯¹è±¡
    
    // çº¹ç†ä¿¡æ¯
    profile: Texture;             // è½®å»“çº¹ç†
    profileHigh: Texture;         // é«˜åˆ†è¾¨ç‡è½®å»“
    normalTexture: Texture;       // æ³•çº¿è´´å›¾
    normalTextureHigh: Texture;   // é«˜åˆ†è¾¨ç‡æ³•çº¿è´´å›¾
    
    // å†…å®¹ç±»å‹
    contentType: ContentType;     // å†…å®¹ç±»å‹
    
    // æ ¸å¿ƒæ–¹æ³•
    initByMeta(meta): void;            // é€šè¿‡å…ƒæ•°æ®åˆå§‹åŒ–
    getHost(): Wall | Face;            // è·å–å®¿ä¸»å¯¹è±¡
    assignTo(host): void;              // åˆ†é…åˆ°å®¿ä¸»
    getMaterial(): Material;           // è·å–æè´¨
    setMaterial(material): void;       // è®¾ç½®æè´¨
    getPaths(): Path[];                // è·å–è·¯å¾„
    getWholePaths(): Path[];           // è·å–å®Œæ•´è·¯å¾„
    isSameMolding(other): boolean;     // åˆ¤æ–­æ˜¯å¦ç›¸åŒè£…é¥°çº¿
}
```

### 8.3 è£…é¥°çº¿å°ºå¯¸ç®¡ç†

**å°ºå¯¸æ¥æº**:
1. **metadataä¼˜å…ˆ**: ä»äº§å“å…ƒæ•°æ®è·å– `profileSizeX`, `profileSizeY`
2. **å®ä¾‹å°ºå¯¸**: å­˜å‚¨åœ¨ `__XSize`, `__YSize`
3. **åŠ¨æ€è°ƒæ•´**: ç”¨æˆ·å¯ä¿®æ”¹å°ºå¯¸

**å°ºå¯¸å˜åŒ–å¤„ç†** (`_onSizeChanged`):
```
å°ºå¯¸æ”¹å˜æ—¶:
  â†’ dirtyGeometry()  // æ ‡è®°å‡ ä½•è„æ•°æ®
  â†’ dirtyMaterial()  // æ ‡è®°æè´¨è„æ•°æ®
  â†’ è§¦å‘é‡æ–°æ¸²æŸ“
```

### 8.4 è£…é¥°çº¿æè´¨ç®¡ç†

**æè´¨å˜åŒ–å¤„ç†** (`_onMaterialChanged`):
```
æè´¨æ”¹å˜æ—¶:
  â†’ å–æ¶ˆæ—§æè´¨çš„ä¿¡å·ç›‘å¬
  â†’ æ ‡è®°æè´¨è„æ•°æ®
  â†’ ç›‘å¬æ–°æè´¨çš„ signalDirty ä¿¡å·
  â†’ è‡ªåŠ¨åŒæ­¥æè´¨å˜åŒ–
```

**æè´¨åŒ¹é…åˆ¤æ–­** (`isSameMolding`):
```
åˆ¤æ–­ä¸¤ä¸ªè£…é¥°çº¿æ˜¯å¦ç›¸åŒ:
  1. seekIdå¿…é¡»ç›¸åŒ
  2. material.seekIdå¿…é¡»ç›¸åŒ
  3. material.rotationå¿…é¡»ç›¸åŒ
  4. XSizeå¿…é¡»æ¥è¿‘ç›¸ç­‰
  5. YSizeå¿…é¡»æ¥è¿‘ç›¸ç­‰
```

---

## ä¹ã€ç¡¬è£…å·¥ä½œæµç¨‹

### 9.1 å®Œæ•´ç¡¬è£…è®¾è®¡æµç¨‹

```mermaid
flowchart TD
    Start([å¼€å§‹ç¡¬è£…è®¾è®¡]) --> DrawWalls[ç»˜åˆ¶å¢™ä½“<br/>åˆ›å»ºæˆ·å‹]
    
    DrawWalls --> RecognizeRooms[è‡ªåŠ¨è¯†åˆ«æˆ¿é—´<br/>RoomExtractor]
    RecognizeRooms --> NameRooms[æˆ¿é—´å‘½å<br/>è®¾ç½®æˆ¿é—´ç±»å‹]
    
    NameRooms --> DesignMode{é€‰æ‹©è®¾è®¡å†…å®¹}
    
    DesignMode -->|åœ°é¢è®¾è®¡| FloorDesign[åœ°é¢é“ºè£…è®¾è®¡]
    DesignMode -->|å¢™é¢è®¾è®¡| WallDesign[å¢™é¢è£…é¥°è®¾è®¡]
    DesignMode -->|åŠé¡¶è®¾è®¡| CeilingDesign[åŠé¡¶è®¾è®¡]
    DesignMode -->|è£…é¥°çº¿| MoldingDesign[è£…é¥°çº¿è®¾è®¡]
    
    subgraph "åœ°é¢é“ºè£…è®¾è®¡æµç¨‹"
        FloorDesign --> FD1[é€‰æ‹©åœ°é¢æè´¨<br/>æœ¨åœ°æ¿/ç“·ç –/çŸ³æ]
        FD1 --> FD2{é“ºè£…æ¨¡å¼}
        FD2 -->|å•ä¸€æè´¨| FD3[è®¾ç½®ç»Ÿä¸€æè´¨<br/>å…¨æˆ¿é“ºè£…]
        FD2 -->|æ‹¼èŠ±æ¨¡å¼| FD4[é€‰æ‹©æ‹¼èŠ±å›¾æ¡ˆ<br/>PatternInfo]
        FD3 --> FD5[åˆ›å»ºPaveå¯¹è±¡]
        FD4 --> FD6[è®¾ç½®æ‹¼èŠ±å•å…ƒ<br/>UnitInfo]
        FD6 --> FD7[åˆ†é…æè´¨åˆ°å•å…ƒ<br/>Material Mapping]
        FD7 --> FD5
        FD5 --> FD8[ç”Ÿæˆé“ºè£…åŒºåŸŸ<br/>Region]
        FD8 --> FD9[è®¡ç®—æè´¨ç”¨é‡<br/>getPaveMaterials]
        FD9 --> FloorComplete[åœ°é¢è®¾è®¡å®Œæˆ]
    end
    
    subgraph "å¢™é¢è£…é¥°è®¾è®¡æµç¨‹"
        WallDesign --> WD1[é€‰æ‹©å¢™é¢<br/>é€‰ä¸­Face]
        WD1 --> WD2[é€‰æ‹©è£…é¥°ç±»å‹]
        WD2 --> WD3{è£…é¥°ç±»å‹}
        WD3 -->|å¢™çº¸/æ¶‚æ–™| WD4[è®¾ç½®å¢™é¢æè´¨<br/>Material]
        WD3 -->|å¢™ç –| WD5[è®¾ç½®ç“·ç –é“ºè´´<br/>Pave]
        WD3 -->|èƒŒæ™¯å¢™| WD6[åˆ›å»ºèƒŒæ™¯å¢™æ¨¡å‹<br/>NCustomizedBackgroundWall]
        WD4 --> WD7[åº”ç”¨åˆ°é¢<br/>Face.material]
        WD5 --> WD8[åˆ›å»ºé“ºè£…å¯¹è±¡<br/>Pave]
        WD6 --> WD9[ç”ŸæˆèƒŒæ™¯å¢™å‡ ä½•]
        WD7 --> WallComplete[å¢™é¢è®¾è®¡å®Œæˆ]
        WD8 --> WallComplete
        WD9 --> WallComplete
    end
    
    subgraph "åŠé¡¶è®¾è®¡æµç¨‹"
        CeilingDesign --> CD1[é€‰æ‹©åŠé¡¶ç±»å‹]
        CD1 --> CD2{åŠé¡¶ç±»å‹}
        CD2 -->|å¹³é¢åŠé¡¶| CD3[åˆ›å»ºCeilingé¢]
        CD2 -->|é€ å‹åŠé¡¶| CD4[è®¾ç½®divideInfo<br/>åˆ†å‰²ä¿¡æ¯]
        CD2 -->|å‚æ•°åŒ–åŠé¡¶| CD5[åˆ›å»ºå‚æ•°åŒ–æ¨¡å‹<br/>NCustomizedParametricCeiling]
        CD3 --> CD6[è®¾ç½®åŠé¡¶æè´¨]
        CD4 --> CD7[è®¾ç½®å„åŒºåŸŸæè´¨]
        CD5 --> CD8[è®¾ç½®æ¨¡å‹å‚æ•°]
        CD6 --> CeilingComplete[åŠé¡¶è®¾è®¡å®Œæˆ]
        CD7 --> CeilingComplete
        CD8 --> CeilingComplete
    end
    
    subgraph "è£…é¥°çº¿è®¾è®¡æµç¨‹"
        

MoldingDesign --> MD1[é€‰æ‹©è£…é¥°çº¿ç±»å‹<br/>è¸¢è„šçº¿/é¡¶è§’çº¿/è…°çº¿]
        MD1 --> MD2[é€‰æ‹©å®¿ä¸»å¯¹è±¡<br/>Wall/Face]
        MD2 --> MD3[é€‰æ‹©äº§å“<br/>ä»æè´¨åº“]
        MD3 --> MD4[initByMeta<br/>åˆå§‹åŒ–å…ƒæ•°æ®]
        MD4 --> MD5[è®¾ç½®æè´¨<br/>Material]
        MD5 --> MD6[è®¾ç½®å°ºå¯¸<br/>XSize/YSize]
        MD6 --> MD7[assignTo(host)<br/>åˆ†é…åˆ°å®¿ä¸»]
        MD7 --> MD8[getPaths<br/>ç”Ÿæˆè·¯å¾„]
        MD8 --> MoldingComplete[è£…é¥°çº¿è®¾è®¡å®Œæˆ]
    end
    
    FloorComplete --> GenerateBOM[ç”ŸæˆBOMæ•°æ®]
    WallComplete --> GenerateBOM
    CeilingComplete --> GenerateBOM
    MoldingComplete --> GenerateBOM
    
    GenerateBOM --> BOM1[B2Room.buildBom2Data<br/>æ„å»ºæˆ¿é—´BOM]
    BOM1 --> BOM2[B2Material.buildBom2Data<br/>æå–æè´¨]
    BOM2 --> BOM3[B2Molding.buildBom2Data<br/>æå–è£…é¥°çº¿]
    BOM3 --> BOM4[_calculateBrickMaterials<br/>è®¡ç®—ç“·ç –]
    BOM4 --> BOM5[organizeData<br/>ç»„ç»‡åˆ†ç±»]
    BOM5 --> BOM6[å¯¼å‡ºExcel/PDF]
    
    BOM6 --> End([ç¡¬è£…è®¾è®¡å®Œæˆ])
    
    style Start fill:#4caf50,color:#fff
    style End fill:#2196f3,color:#fff
    style FloorDesign fill:#fff3e0
    style WallDesign fill:#e1f5ff
    style CeilingDesign fill:#f3e5f5
    style MoldingDesign fill:#fff9c4
```

### 9.2 æˆ¿é—´BOMæ•°æ®æ„å»º

**æºç **: `b2room.js` (è¡Œ53-102)

**buildBom2Data() æµç¨‹**:
```
éå†æ‰€æœ‰æˆ¿é—´:
  for each room in context.rooms:
      roomData = buildRoomBomData(room)
      
      roomDataåŒ…å«:
        - ID: room.getInstanceId()
        - roomType: room.type
        - roomTypeDisplayName: room.displayNameCustom || "æœªå‘½å"
        - area: room.area
        - layerId: room.layerId

æ’åºæˆ¿é—´åˆ—è¡¨:
  æŒ‰ RoomTypeOrderEnum æ’åº
  åŒç±»å‹æˆ¿é—´æŒ‰åç§°å­—æ¯åºæ’åº

è¿”å›æ’åºåçš„æˆ¿é—´åˆ—è¡¨
```

### 9.3 B3Roomä¸‰ç»´BOMæ„å»º

**æºç **: `b3room.js` (è¡Œ145-257)

**buildBom3Data() è¯¦ç»†æµç¨‹**:
```
è¾“å…¥: roomEntity

æ­¥éª¤1: æå–æˆ¿é—´åŸºç¡€ä¿¡æ¯
  roomInfo = {
      id: room.id,
      type: room.type,
      displayName: room.displayName,
      displayNameCustom: room.displayNameCustom,
      relationRooms: getRelatedRooms(room.id)
  }

æ­¥éª¤2: æå–æˆ¿é—´é¢æ•°æ®
  faces = genBom3DataFromGroup(
      context.roomFaces,
      room.id,
      new B3Face(context)
  )

æ­¥éª¤3: æå–å®¶å…·å†…å®¹
  contents = buildContentData(room)

æ­¥éª¤4: æå–è£…é¥°çº¿
  moldings = buildMoldingData(room)

æ­¥éª¤5: æå–å®šåˆ¶åŒ–å†…å®¹
  customizations = buildCustomizationData(room)

æ­¥éª¤6: æå–è‡ªå®šä¹‰å»ºæ¨¡
  customizedModelings = buildCustomizedData(room)
  
  åˆ†ç±»:
    - structures: ç»“æ„ä¿¡æ¯
    - paramaterModels: å‚æ•°åŒ–æ¨¡å‹
    - sketchModels: è‰å›¾æ¨¡å‹
    - diyModels: DIYæ¨¡å‹

æ­¥éª¤7: ç»„è£…å®Œæ•´æ•°æ®
  return {
      entity: turnEntityToBom3Entity(room),
      roomInfo: roomInfo,
      faces: faces,
      contents: contents,
      moldings: moldings,
      customizations: customizations,
      customizedModelings: customizedModelings,
      spaceGirth: room.spaceGirth
  }
```

---

## åã€æ•°æ®ç»“æ„è¯¦è§£

### 10.1 BOM2æ•°æ®ç»“æ„ (äºŒç»´)

**B2Room** (æˆ¿é—´BOM2æ•°æ®):
```typescript
{
    ID: string;                   // æˆ¿é—´ID
    roomType: string;             // æˆ¿é—´ç±»å‹
    roomTypeDisplayName: string;  // æˆ¿é—´åç§°
    area: number;                 // é¢ç§¯
    layerId: string;              // å›¾å±‚ID
}
```

**B2Material** (æè´¨BOM2æ•°æ®):
```typescript
{
    seekId: string;               // æè´¨ID
    name: string;                 // æè´¨åç§°
    category: string;             // åˆ†ç±»
    categoryType: string;         // åˆ†ç±»ç±»å‹
    brand: string;                // å“ç‰Œ
    brandId: string;              // å“ç‰ŒID
    color: Color;                 // é¢œè‰²
    count: number;                // æ•°é‡
    image: string;                // å›¾ç‰‡
    size: {x: number, y: number}; // å°ºå¯¸
    unit: string;                 // å•ä½
    locationName: string;         // ä½ç½®
    locationFaceArea: number;     // ä½ç½®é¢ç§¯
    roomId: string;               // æˆ¿é—´ID
}
```

### 10.2 BOM3æ•°æ®ç»“æ„ (ä¸‰ç»´)

**B3Room** (æˆ¿é—´BOM3æ•°æ®):
```typescript
{
    entity: Bom3Entity;           // å®ä½“å¯¹è±¡
    roomInfo: {
        id: string,
        type: string,
        displayName: string,
        displayNameCustom: string,
        relationRooms: RelationRoom[]
    },
    faces: Bom3Face[];            // é¢æ•°æ®
    contents: ContentInfo[];      // å®¶å…·å†…å®¹
    moldings: Bom3Molding[];      // è£…é¥°çº¿
    customizations: Customization[];  // å®šåˆ¶å†…å®¹
    customizedModelings: {
        structures: Structure[],
        paramaterModels: ParametricModel[],
        sketchModels: SketchModel[],
        diyModels: DIYModel[]
    },
    spaceGirth: number;           // æˆ¿é—´å‘¨é•¿
}
```

**RelationRoom** (å…³è”æˆ¿é—´):
```typescript
{
    id: string;                   // æˆ¿é—´ID
    type: string;                 // æˆ¿é—´ç±»å‹
    displayName: string;          // æ˜¾ç¤ºåç§°
    displayNameCustom: string;    // è‡ªå®šä¹‰åç§°
}
```

### 10.3 Paveé“ºè£…æ•°æ®ç»“æ„

**Block** (é“ºè´´å—):
```typescript
{
    unitId: string;               // å•å…ƒID
    materialSeekId: string;       // æè´¨SeekID
    count: number;                // æ•°é‡
    isRubble: boolean;            // æ˜¯å¦å¼‚å½¢
    path: PathGroup[][];          // è·¯å¾„ (å¼‚å½¢æ—¶)
    major: {
        refSeekIds: string[]      // å¼•ç”¨SeekIDåˆ—è¡¨
    }
}
```

**PathGroup** (è·¯å¾„ç»„):
```typescript
{
    path: Polygon2D;              // è·¯å¾„
    area: number;                 // é¢ç§¯
}
```

### 10.4 MixPaintæ··åˆæ¶‚è£…ç»“æ„

**MixPaintå¯¹è±¡**:
```typescript
{
    id: string;                   // æ··åˆæ¶‚è£…ID
    Class: string;                // ç±»å
    faceGroup: FaceGroup;         // é¢ç»„
    mixPave: MixPave;             // æ··åˆé“ºè£…
    transform: Matrix4;           // å˜æ¢çŸ©é˜µ
    
    // æ–¹æ³•
    getBackgroundPath(): Polygon2D;   // è·å–èƒŒæ™¯è·¯å¾„
}
```

**FaceGroup** (é¢ç»„):
```typescript
{
    getFaceIds(): string[];       // è·å–é¢IDåˆ—è¡¨
    transformMap: Map<string, Matrix4>;  // å˜æ¢æ˜ å°„è¡¨
}
```

---

## åä¸€ã€æºç æ–‡ä»¶ç´¢å¼•

### 11.1 æ ¸å¿ƒä¸šåŠ¡æ–‡ä»¶

**æˆ¿é—´ç®¡ç†** (`plugins-hs-aa8c4e59`):
- `roomentity.js` (107è¡Œ) - æˆ¿é—´å®ä½“ç±»
- `b2room.js` (105è¡Œ) - æˆ¿é—´BOM2å¤„ç†å™¨
- `b3room.js` (260è¡Œ) - æˆ¿é—´BOM3å¤„ç†å™¨
- `roomlistboard.js` - æˆ¿é—´åˆ—è¡¨é¢æ¿

**é“ºè£…ç®¡ç†** (`plugins-hs-aa8c4e59`):
- `paveentity.js` (163è¡Œ) - é“ºè£…å®ä½“ç±»
- `b3pave.js` (63è¡Œ) - é“ºè£…BOM3å¤„ç†å™¨
- `paverubblealgorithm.js` - å¼‚å½¢é“ºè´´ç®—æ³•

**æè´¨ç®¡ç†** (`plugins-hs-aa8c4e59`):
- `b2material.js` (539è¡Œ) - æè´¨BOM2å¤„ç†å™¨ â­æ ¸å¿ƒ
- `materialutils.js` - æè´¨å·¥å…·é›†

### 11.2 å‡ ä½•å¯¹è±¡æ–‡ä»¶

**åŠé¡¶ç³»ç»Ÿ** (`core-hs`):
- `ceiling.js` (127è¡Œ) - åŠé¡¶ä¸»ç±»
- `ceilingutil.js` - åŠé¡¶å·¥å…·
- `ceilingstrategy.js` (74è¡Œ) - åŠé¡¶ç­–ç•¥

**åœ°æ¿ç³»ç»Ÿ** (`core-hs`):
- `floor.js` (152è¡Œ) - åœ°æ¿ä¸»ç±»
- `floorutil.js` - åœ°æ¿å·¥å…·
- `floormixpaintutil.js` - åœ°æ¿æ··åˆæ¶‚è£…å·¥å…·

**è£…é¥°çº¿ç³»ç»Ÿ** (`core-hs`):
- `molding.js` (260è¡Œ) - è£…é¥°çº¿ä¸»ç±»
- `moldingutil.js` - è£…é¥°çº¿å·¥å…·
- `moldingsweephelper.js` - è£…é¥°çº¿æ‰«æ è¾…åŠ©
- `wallmolding.js` - å¢™ä½“è£…é¥°çº¿
- `dmolding_io.js` - è£…é¥°çº¿IO

### 11.3 ç­–ç•¥å’Œå·¥å…·æ–‡ä»¶

**é“ºè£…ç­–ç•¥** (`plugins-hs-aa8c4e59`):
- `ceilingstrategy.js` - åŠé¡¶ç­–ç•¥
- `mixpaintstrategy.js` - æ··åˆæ¶‚è£…ç­–ç•¥

**æè´¨å·¥å…·** (`core-hs`):
- `materialutil.js` - æè´¨å·¥å…· (å¤šä¸ªç‰ˆæœ¬)
- `mixpaint.js` - æ··åˆæ¶‚è£…
- `mixpaintutil.js` - æ··åˆæ¶‚è£…å·¥å…·
- `mixpaintbuilder.js` - æ··åˆæ¶‚è£…æ„å»ºå™¨
- `paintsutil.js` - æ¶‚æ–™å·¥å…·
- `paintservice.js` - æ¶‚æ–™æœåŠ¡

**å‡ ä½•å·¥å…·** (`core-hs`):
- `wallutil.js` - å¢™ä½“å·¥å…·
- `faceutil.js` - é¢å·¥å…·
- `geometryutil.js` - å‡ ä½•å·¥å…·

---

## åäºŒã€å®Œæ•´ç¡¬è£…BOMæµç¨‹å›¾

```mermaid
flowchart TD
    Start([ç”¨æˆ·ç‚¹å‡»å¯¼å‡ºBOM]) --> FilterCheck{è¿‡æ»¤å™¨è®¾ç½®}
    
    FilterCheck -->|ä»…ç¡¬è£…| HardloadOnly[filterOptions.hardload = true]
    FilterCheck -->|å…¨éƒ¨| AllItems[åŒ…å«ç¡¬è£…+è½¯è£…]
    
    HardloadOnly --> InitContext[B2Context.init<br/>åˆå§‹åŒ–ä¸Šä¸‹æ–‡]
    

AllItems --> InitContext
    
    InitContext --> ExtractData[æå–åœºæ™¯æ•°æ®<br/>BomDataAdapter.getData]
    
    ExtractData --> ClassifyData[åˆ†ç±»ä¸šåŠ¡å®ä½“]
    ClassifyData --> CD1[layerså›¾å±‚]
    ClassifyData --> CD2[roomsæˆ¿é—´]
    ClassifyData --> CD3[pavesé“ºè£…]
    ClassifyData --> CD4[contentsæ¨¡å‹]
    ClassifyData --> CD5[openingså¼€æ´]
    ClassifyData --> CD6[moldingsè£…é¥°çº¿]
    ClassifyData --> CD7[roomFacesæˆ¿é—´é¢æ˜ å°„]
    
    CD1 --> BuildBOM[buildDataæ„å»ºæ•°æ®]
    CD2 --> BuildBOM
    CD3 --> BuildBOM
    CD4 --> BuildBOM
    CD5 --> BuildBOM
    CD6 --> BuildBOM
    CD7 --> BuildBOM
    
    BuildBOM --> BR[B2Roomæˆ¿é—´æ•°æ®]
    BuildBOM --> BM[B2Materialæè´¨æ•°æ®â­]
    BuildBOM --> BMD[B2Moldingè£…é¥°çº¿æ•°æ®]
    BuildBOM --> BD[B2Designè®¾è®¡æ•°æ®]
    
    subgraph "æè´¨æ•°æ®æå–è¯¦ç»†æµç¨‹"
        BM --> BM1[éå†é“ºè£…paves]
        BM1 --> BM2[getPaveMaterials<br/>æå–é“ºè£…æè´¨]
        BM2 --> BM3[éå†æˆ¿é—´é¢roomFaces]
        BM3 --> BM4{é¢æ˜¯å¦æœ‰é“ºè£…}
        BM4 -->|æœ‰| BM5[ä½¿ç”¨é“ºè£…æè´¨]
        BM4 -->|æ— | BM6[getMaterial<br/>æå–é¢æè´¨]
        BM5 --> BM7[withFaceLocation<br/>è®¾ç½®ä½ç½®]
        BM6 --> BM7
        BM7 --> BM8[éå†è‡ªå®šä¹‰å®ä½“]
        BM8 --> BM9[æå–å­é¢æè´¨]
        BM9 --> BM10[éå†å¼€æ´openings]
        BM10 --> BM11[æå–æ´å£æè´¨]
        BM11 --> BM12[_calculateBrickMaterials<br/>è®¡ç®—ç“·ç –æ•°é‡â­]
    end
    
    BR --> OrganizeData[organizeDataåˆ†ç±»ç»„ç»‡]
    BM12 --> OrganizeData
    BMD --> OrganizeData
    BD --> OrganizeData
    
    OrganizeData --> OD1[getSeekBelong<br/>æŸ¥è¯¢äº§å“å½’å±]
    OD1 --> OD2[_classifyDatas<br/>å¤šç»´åº¦åˆ†ç±»]
    OD2 --> OD3[æŒ‰å¤åˆé”®å»é‡èšåˆ]
    OD3 --> OD4[åº”ç”¨è¿‡æ»¤å™¨filterItem]
    
    OD4 --> ExportFormat{å¯¼å‡ºæ ¼å¼}
    ExportFormat -->|Excel| ExportExcel[ç”ŸæˆExcelæ–‡ä»¶]
    ExportFormat -->|PDF| ExportPDF[ç”ŸæˆPDFæ–‡ä»¶]
    ExportFormat -->|JSON| ExportJSON[å¯¼å‡ºJSONæ•°æ®]
    
    ExportExcel --> End([BOMå¯¼å‡ºå®Œæˆ])
    ExportPDF --> End
    ExportJSON --> End
    
    style BM fill:#ff9800,color:#fff
    style BM12 fill:#f44336,color:#fff
```

---

## åä¸‰ã€å…³é”®ç®—æ³•è¯¦è§£

### 13.1 å¼‚å½¢ç“·ç –è®¡ç®—ç®—æ³•

**PaveRubbleAlgorithm.calculateRubbleCount()**

**è¾“å…¥å‚æ•°**:
- `patternInfo`: æ‹¼èŠ±æ¨¡å¼ä¿¡æ¯
- `patternUnitId`: æ‹¼èŠ±å•å…ƒID
- `rubblePaths`: å¼‚å½¢è·¯å¾„åˆ—è¡¨
- `options`: è®¡ç®—å‚æ•° (å¯é€‰)

**ç®—æ³•ç­–ç•¥**:

1. **ç›’å­è®¡ç®—æ³•** (å¿«é€Ÿä¼°ç®—):
   ```
   æ¡ä»¶: canUseBoxCalculate() è¿”å›true
   
   æ–¹æ³•:
     è·å–æ‰€æœ‰è·¯å¾„çš„åŒ…å›´ç›’
     è®¡ç®—åŒ…å›´ç›’é¢ç§¯
     æ ¹æ®å•å…ƒå°ºå¯¸è®¡ç®—æ•°é‡
     count = ceil(boxArea / unitArea)
   
   é€‚ç”¨: è§„åˆ™çŸ©å½¢åŒºåŸŸ
   ```

2. **å¤–è½®å»“æ³•** (ç²¾ç¡®è®¡ç®—):
   ```
   æ¡ä»¶: ä¸è§„åˆ™åŒºåŸŸæˆ–éœ€è¦ç²¾ç¡®è®¡ç®—
   
   æ–¹æ³•:
     åˆå¹¶æ‰€æœ‰è·¯å¾„ä¸ºå¤–è½®å»“
     æŒ‰æ‹¼èŠ±æ¨¡å¼åˆ†å‰²åŒºåŸŸ
     é€å—è®¡ç®—ç“·ç –è¦†ç›–
     å¤„ç†è¾¹ç¼˜åˆ‡å‰²
     count = sum(æ¯å—ç“·ç –æ•°)
   
   é€‚ç”¨: å¼‚å½¢åŒºåŸŸã€æ‹¼èŠ±é“ºè´´
   ```

**è¿”å›å€¼**:
```typescript
{
    countInfo: Map<uid, count>,   // æ¯ä¸ªåŒºåŸŸçš„ç“·ç –æ•°é‡
    error: boolean;               // æ˜¯å¦æœ‰é”™è¯¯
}
```

### 13.2 æˆ¿é—´è½®å»“æå–ç®—æ³•

**RoomExtractor.extract()**

**æµç¨‹**:
```
æ­¥éª¤1: æ”¶é›†æ‰€æœ‰å¢™ä½“
  walls = scene.getAllWalls()

æ­¥éª¤2: æ„å»ºå¢™ä½“æ‹“æ‰‘å›¾
  graph = new TopologyGraph()
  
  for each wall in walls:
      graph.addEdge(wall.startPoint, wall.endPoint, wall)

æ­¥éª¤3: æŸ¥æ‰¾é—­åˆç¯è·¯
  loops = graph.findClosedLoops()

æ­¥éª¤4: åˆ¤æ–­æˆ¿é—´åŒºåŸŸ
  for each loop in loops:
      polygon = createPolygon(loop)
      
      if (isValidRoom(polygon)) {
          room = new Room()
          room.setOutline(polygon)
          room.calculateArea()
          rooms.push(room)
      }

æ­¥éª¤5: è¿‡æ»¤é‡å¤å’ŒåŒ…å«å…³ç³»
  rooms = filterDuplicateRooms(rooms)
  rooms = filterContainedRooms(rooms)

è¿”å›: rooms[]
```

### 13.3 æè´¨é¢ç§¯å½’ä¸€åŒ–

**æºç **: `b2material.js` (è¡Œ465-474)

**ç®—æ³•**:
```
é—®é¢˜: æ‹¼èŠ±é“ºè£…ä¸­å„æè´¨é¢ç§¯æ€»å’Œå¯èƒ½ä¸åŒºåŸŸæ€»é¢ç§¯ä¸ä¸€è‡´

è§£å†³:
  totalMaterialArea = sum(materials.map(m => m.locationFaceArea))
  actualArea = pave.area
  
  ratio = actualArea / totalMaterialArea
  
  for each material in materials:
      material.locationFaceArea *= ratio

ç»“æœ: ç¡®ä¿æè´¨é¢ç§¯æ€»å’Œ = åŒºåŸŸå®é™…é¢ç§¯
```

---

## åå››ã€é«˜çº§ç‰¹æ€§

### 14.1 ç‹¬ç«‹åŒºåŸŸè¾“å‡º

**åŠŸèƒ½**: æ”¯æŒé¢ç»„ç‹¬ç«‹è¾“å‡ºï¼Œæé«˜å¤§åœºæ™¯æ€§èƒ½

**åˆ¤æ–­**: `Utils.isFaceGroupIndependentOutput()`

**å¤„ç†**:
```
if (ç‹¬ç«‹è¾“å‡ºæ¨¡å¼) {
    pave.id = "${faceType}, ${mixPaint.id}"
    pave.faceIds = []  // ä¸åŒ…å«å…·ä½“é¢ID
    pave.parentId = faceType
}
else {
    pave.id = mixPaint.id
    pave.faceIds = faceGroup.getFaceIds().sort()
    pave.parentId = srcEntity.id
}
```

### 14.2 éšœç¢ç‰©è·¯å¾„å¤„ç†

**åŠŸèƒ½**: è‡ªåŠ¨é¿è®©å®¶å…·ã€æŸœä½“ç­‰éšœç¢ç‰©

**æºç **: `paveentity.js` (è¡Œ129, 154)

**æ–¹æ³•**:
- `Utils.getObstaclePath(face)`: è·å–é¢ä¸Šçš„éšœç¢ç‰©è·¯å¾„
- `Utils.getOpeningPath(entity)`: è·å–å¼€æ´è·¯å¾„

**å¸ƒå°”è¿ç®—**:
```
æœ€ç»ˆé“ºè£…åŒºåŸŸ = åŸå§‹åŒºåŸŸ - éšœç¢ç‰©è·¯å¾„ - å¼€æ´è·¯å¾„

ä½¿ç”¨ ClipperLib.clip() æ‰§è¡Œå·®é›†è¿ç®—
```

### 14.3 æè´¨é¢œè‰²æå–

**åŠŸèƒ½**: ä»æè´¨å¯¹è±¡æå–é¢œè‰²ä¿¡æ¯

**æ–¹æ³•**: `getColor(material)`

**é¢œè‰²æ¥æº**:
1. material.color (ç›´æ¥é¢œè‰²)
2. material.colorHex (åå…­è¿›åˆ¶)
3. material.textureUrl (ä»çº¹ç†æå–ä¸»è‰²è°ƒ)
4. é»˜è®¤é¢œè‰²

### 14.4 å•ä½è½¬æ¢ç³»ç»Ÿ

**dollarTransfer() å‡½æ•°**:
- åŠŸèƒ½: æ•°å€¼æ ¼å¼åŒ–å’Œå•ä½è½¬æ¢
- ä¿ç•™å°æ•°ä½æ•°
- å•ä½æ¢ç®— (ã¡ â†” ç‰‡)

**å•ä½ç±»å‹**:
- `priceUnit`: "ç‰‡" (ç”¨äºç“·ç –)
- `areaUnit`: "ã¡" (ç”¨äºæ¶‚æ–™ã€åœ°æ¿)
- `piecesUnit`: "ç‰‡" (ç”¨äºæ‹¼èŠ±å•å…ƒ)

---

## åäº”ã€å®é™…åº”ç”¨æ¡ˆä¾‹

### 15.1 æ¡ˆä¾‹: å®¢å…åœ°é¢é“ºè£…

**åœºæ™¯æè¿°**:
- æˆ¿é—´ç±»å‹: å®¢å…
- é¢ç§¯: 30ã¡
- é“ºè£…æ–¹å¼: 800Ã—800mmæŠ›å…‰ç – + æ³¢æ‰“çº¿

**æ•°æ®æµ**:
```
Room {
    id: "room-living-001",
    roomType: "living_room",
    area: 30,
    paves: [pave-001]
}

Pave {
    id: "pave-001",
    patternInfo: {
        seekId: "pattern-border-line",
        unitsInfos: [
            { unitId: "unit-main", materials: [ç“·ç –A] },
            { unitId: "unit-border", materials: [ç“·ç –B] }
        ]
    },
    blocks: [
        { unitId: "unit-main", materialSeekId: "tile-A", count: 42 },
        { unitId: "unit-border", materialSeekId: "tile-B", count: 24 }
    ]
}

BOMè¾“å‡º:
  æè´¨1: 800Ã—800æŠ›å…‰ç –, 42ç‰‡, 26.88ã¡
  æè´¨2: 150Ã—800æ³¢æ‰“çº¿, 24ç‰‡, 2.88ã¡
  æ€»è®¡: 66ç‰‡, 29.76ã¡
```

### 15.2 æ¡ˆä¾‹: å§å®¤å¢™é¢é“ºè£…

**åœºæ™¯æè¿°**:
- æˆ¿é—´ç±»å‹: ä¸»å§
- å¢™é¢: 4é¢å¢™
- è£…é¥°æ–¹å¼: 3é¢å¢™çº¸ + 1é¢èƒŒæ™¯å¢™ (ç¡¬åŒ…)

**æ•°æ®æµ**:
```
Room {
    id: "room-bedroom-001",
    roomType: "master_bedroom",
    faces: [
        face-wall-1 

(å¢™çº¸),
        face-wall-2 (å¢™çº¸),
        face-wall-3 (å¢™çº¸),
        face-wall-4 (èƒŒæ™¯å¢™)
    ]
}

Face {
    id: "face-wall-1",
    material: { seekId: "wallpaper-001", area: 12 }
}

NCustomizedBackgroundWall {
    id: "bgwall-001",
    hostFace: "face-wall-4",
    customizedType: "StructureInfo"
}

BOMè¾“å‡º:
  å¢™çº¸-001: 36ã¡ (3é¢å¢™)
  ç¡¬åŒ…èƒŒæ™¯å¢™: 1å¥—
  è¸¢è„šçº¿: å‘¨é•¿Ã—é«˜åº¦
  é¡¶è§’çº¿: å‘¨é•¿Ã—å®½åº¦
```

### 15.3 æ¡ˆä¾‹: å¨æˆ¿å…¨å¥—ç¡¬è£…

**åœºæ™¯æè¿°**:
- æˆ¿é—´ç±»å‹: å¨æˆ¿
- åœ°é¢: 300Ã—300é˜²æ»‘ç –
- å¢™é¢: 300Ã—600å¢™ç – (1.5mé«˜)
- åŠé¡¶: é“æ‰£æ¿
- è£…é¥°çº¿: é“åˆé‡‘è¸¢è„šçº¿

**å®Œæ•´BOMæ¸…å•**:
```
ã€åœ°é¢ã€‘
  é˜²æ»‘ç – 300Ã—300: 56ç‰‡, 5.04ã¡

ã€å¢™é¢ã€‘
  å¢™ç – 300Ã—600: 84ç‰‡, 15.12ã¡

ã€åŠé¡¶ã€‘
  é“æ‰£æ¿ 300Ã—300: 45ç‰‡, 4.05ã¡

ã€è£…é¥°çº¿ã€‘
  é“åˆé‡‘è¸¢è„šçº¿ 80mm: 12m

ã€æ€»è®¡ã€‘
  ç¡¬è£…ææ–™: 185ç‰‡ + 12m
  æ€»é¢ç§¯: 24.21ã¡
  ä¼°ç®—é€ ä»·: Â¥XXXX
```

---

## åå…­ã€æŠ€æœ¯äº®ç‚¹æ€»ç»“

### 16.1 æ ¸å¿ƒä¼˜åŠ¿

âœ… **æ™ºèƒ½æˆ¿é—´è¯†åˆ«**: è‡ªåŠ¨æå–æˆ¿é—´è¾¹ç•Œå’Œç±»å‹

âœ… **æ‹¼èŠ±æ¨¡å¼æ”¯æŒ**: ä¸°å¯Œçš„æ‹¼èŠ±å›¾æ¡ˆåº“

âœ… **å¼‚å½¢é“ºè´´è®¡ç®—**: PaveRubbleAlgorithmç²¾ç¡®è®¡ç®—ç“·ç –ç”¨é‡

âœ… **é¢çº§æè´¨ç®¡ç†**: ç²¾ç»†åˆ°æ¯ä¸ªé¢çš„æè´¨æ§åˆ¶

âœ… **å¤šç‰ˆæœ¬å…¼å®¹**: å®Œå–„çš„æ•°æ®è¿ç§»æœºåˆ¶

âœ… **å®æ—¶BOM**: å³æ—¶ç”Ÿæˆææ–™æ¸…å•å’ŒæŠ¥ä»·

### 16.2 ç®—æ³•ç‰¹ç‚¹

â­ **å¤šè¾¹å½¢å¸ƒå°”è¿ç®—**: ClipperLibé«˜æ€§èƒ½è£å‰ª

â­ **æ™ºèƒ½åˆ†ç»„èšåˆ**: ç›¸åŒæè´¨è‡ªåŠ¨åˆå¹¶ç»Ÿè®¡

â­ **é¢ç§¯å½’ä¸€åŒ–**: ç¡®ä¿æè´¨é¢ç§¯æ€»å’Œå‡†ç¡®

â­ **å¼•ç”¨æ˜ å°„æœºåˆ¶**: refSeekIdså¤„ç†æè´¨å˜ä½“

â­ **ä½ç½®è‡ªåŠ¨è¯†åˆ«**: 6ç§ä½ç½®ç±»å‹æ™ºèƒ½åˆ¤æ–­

### 16.3 æ€§èƒ½ä¼˜åŒ–

ğŸš€ **ç‹¬ç«‹åŒºåŸŸè¾“å‡º**: å‡å°‘å¤§åœºæ™¯å†…å­˜å ç”¨

ğŸš€ **å¢é‡æ›´æ–°**: åªé‡ç®—å˜åŒ–çš„éƒ¨åˆ†

ğŸš€ **ç¼“å­˜æœºåˆ¶**: æè´¨ã€çº¹ç†ã€å‡ ä½•ç¼“å­˜

ğŸš€ **å¼‚æ­¥åŠ è½½**: å¤§å‹é“ºè£…å¼‚æ­¥å¤„ç†

ğŸš€ **æ‰¹é‡è®¡ç®—**: å¼‚å½¢é“ºè´´æ‰¹é‡æ±‚è§£

---

## åä¸ƒã€APIæ¥å£æ€»è§ˆ

### 17.1 Room API

```typescript
// æˆ¿é—´æŸ¥è¯¢
scene.getRoom(id): Room
layer.getRooms(): Room[]

// æˆ¿é—´å±æ€§
room.getArea(): number
room.getSpaceGirth(): number
room.getCenter(): Point3D
room.getRoomType(): string

// æˆ¿é—´å…³è”
room.getRelatedRooms(): Room[]
room.getFaces(): Face[]
room.getPaves(): Pave[]
room.getMoldings(): Molding[]
```

### 17.2 Pave API

```typescript
// é“ºè£…åˆ›å»º
pave = new PaveEntity()
pave.setMaterial(material)
pave.setPatternInfo(patternInfo)

// é“ºè£…åŒºåŸŸ
pave.getRegions(): Region[]
pave.getIndependentRegions(): Region[]
pave.getOutline(): Polygon2D

// æè´¨æå–
pave.getMaterials(): Material[]
pave.calculateArea(): number
```

### 17.3 Material API

```typescript
// æè´¨æŸ¥è¯¢
materialLibrary.getMaterial(seekId): Material
materialLibrary.searchByCategory(category): Material[]

// æè´¨å±æ€§
material.getColor(): Color
material.getSize(): {x, y}
material.getTextureUrl(): string
material.getUnit(): string

// ç”¨é‡è®¡ç®—
material.calculateCount(area): number
material.formatUnit(): string
```

### 17.4 Molding API

```typescript
// è£…é¥°çº¿åˆ›å»º
molding = new Molding()
molding.initByMeta(metadata)
molding.setMaterial(material)
molding.assignTo(host)

// è£…é¥°çº¿å±æ€§
molding.getPaths(): Path[]
molding.getWholePaths(): Path[]
molding.getHost(): Wall | Face

// è£…é¥°çº¿åˆ¤æ–­
molding.isSameMolding(other): boolean
molding.canSelect(): boolean
```

---

## åå…«ã€æœ€ä½³å®è·µå»ºè®®

### 18.1 è®¾è®¡æµç¨‹å»ºè®®

**æ¨èé¡ºåº**:
1. âœ… ç»˜åˆ¶å¢™ä½“ â†’ ç¡®å®šæˆ·å‹ç»“æ„
2. âœ… è¯†åˆ«æˆ¿é—´ â†’ å‘½åæˆ¿é—´ç±»å‹
3. âœ… è®¾è®¡åœ°é¢ â†’ é€‰æ‹©åœ°æ¿/ç“·ç –
4. âœ… è®¾è®¡å¢™é¢ â†’ å¢™çº¸/æ¶‚æ–™/å¢™ç –
5. âœ… è®¾è®¡åŠé¡¶ â†’ å¹³é¡¶/é€ å‹åŠé¡¶
6. âœ… æ·»åŠ è£…é¥°çº¿ â†’ è¸¢è„šçº¿/é¡¶è§’çº¿
7. âœ… ç”ŸæˆBOM â†’ å¯¼å‡ºææ–™æ¸…å•

### 18.2 æ€§èƒ½ä¼˜åŒ–å»ºè®®

**å¤§åœºæ™¯ä¼˜åŒ–**:
- å¯ç”¨ç‹¬ç«‹åŒºåŸŸè¾“å‡º
- ä½¿ç”¨ç›’å­è®¡ç®—æ³• (è§„åˆ™åŒºåŸŸ)
- åˆå¹¶ç›¸åŒæè´¨
- å¼‚æ­¥åŠ è½½å¤§å‹é“ºè£…
- åˆ†æ‰¹å¤„ç†æˆ¿é—´

**å†…å­˜ä¼˜åŒ–**:
- åŠæ—¶æ¸…ç†ä¸´æ—¶æ•°æ® (uid, rubblePathç­‰)
- å¤ç”¨æè´¨å¯¹è±¡
- ä½¿ç”¨æè´¨å¼•ç”¨è€Œéå¤åˆ¶
- å®šæœŸè§¦å‘GC

### 18.3 æ•°æ®è´¨é‡å»ºè®®

**ç¡®ä¿å‡†ç¡®æ€§**:
- æ£€æŸ¥æˆ¿é—´é—­åˆæ€§
- éªŒè¯é¢ç§¯è®¡ç®—
- æ ¸å¯¹æè´¨SeekID
- æµ‹è¯•å¼‚å½¢é“ºè´´
- å®¡æ ¸BOMæ•°æ®

**é”™è¯¯å¤„ç†**:
- try-catchæ•è·å¼‚å¸¸
- è¯¦ç»†é”™è¯¯æ—¥å¿—
- ç”¨æˆ·å‹å¥½æç¤º
- è‡ªåŠ¨ä¿®å¤æœºåˆ¶

---

## åä¹ã€å¸¸è§é—®é¢˜FAQ

### Q1: å¼‚å½¢é“ºè´´è®¡ç®—ä¸å‡†ç¡®ï¼Ÿ

**åŸå› **:
- è·¯å¾„æœªé—­åˆ
- å•å…ƒå°ºå¯¸é”™è¯¯
- æ‹¼èŠ±æ¨¡å¼é…ç½®é—®é¢˜

**è§£å†³**:
```
æ£€æŸ¥ canUseBoxCalculate() è¿”å›å€¼
å¦‚æœfalseï¼Œä½¿ç”¨å¤–è½®å»“æ³•
éªŒè¯ patternInfo.unitsInfos é…ç½®
æ£€æŸ¥ rubblePath è·¯å¾„å®Œæ•´æ€§
```

### Q2: æè´¨é¢ç§¯æ€»å’Œä¸ç­‰äºæˆ¿é—´é¢ç§¯ï¼Ÿ

**åŸå› **: æµ®ç‚¹æ•°ç´¯åŠ è¯¯å·®

**è§£å†³**: ä½¿ç”¨é¢ç§¯å½’ä¸€åŒ–ç®—æ³• (è§ 13.3èŠ‚)

### Q3: è£…é¥°çº¿æ— æ³•æ˜¾ç¤ºï¼Ÿ

**åŸå› **:
- metadataæœªæ­£ç¡®åˆå§‹åŒ–
- å®¿ä¸»å¯¹è±¡ä¸¢å¤±
- è·¯å¾„ç”Ÿæˆå¤±è´¥

**è§£å†³**:
```
æ£€æŸ¥ molding.metadata æ˜¯å¦å­˜åœ¨
éªŒè¯ molding.getHost() è¿”å›å€¼
è°ƒç”¨ molding.verify() éªŒè¯å®Œæ•´æ€§
```

### Q4: æˆ¿é—´è¯†åˆ«é”™è¯¯ï¼Ÿ

**åŸå› **:
- å¢™ä½“æœªé—­åˆ
- å¢™ä½“äº¤ç‚¹é”™è¯¯
- æ‹“æ‰‘å›¾æ„å»ºå¤±è´¥

**è§£å†³**:
```
ä½¿ç”¨ RoomClosedCheckTask æ£€æŸ¥é—­åˆæ€§
è°ƒç”¨ WallIntersectResolver ä¿®å¤äº¤ç‚¹
é‡æ–°è¿è¡Œ RoomExtractor.extract()
```

---

## äºŒåã€æ‰©å±•å¼€å‘æŒ‡å—

### 20.1 è‡ªå®šä¹‰æˆ¿é—´ç±»å‹

**æ­¥éª¤**:
1. æ‰©å±• `RoomType` æšä¸¾
2. æ·»åŠ å›½é™…åŒ–å­—ç¬¦ä¸²
3. æ›´æ–° `RoomTypeOrderEnum` æ’åº
4. å®ç°å›¾æ ‡å’Œæ ·å¼

### 20.2 è‡ªå®šä¹‰é“ºè£…æ¨¡å¼

**æ­¥éª¤**:
1. åˆ›å»º `PatternInfo` é…ç½®
2. å®šä¹‰ `UnitInfo` å•å…ƒ
3. è®¾ç½®æè´¨æ˜ å°„
4. æ³¨å†Œåˆ°æ¨¡å¼åº“
5. å®ç°é¢„è§ˆç¼©ç•¥å›¾

### 20.3 è‡ªå®šä¹‰æè´¨ç±»å‹

**æ­¥éª¤**:
1. æ‰©å±• `Material` ç±»
2. å®ç° `needCalculateBrickCount` åˆ¤æ–­
3. å®šä¹‰å•ä½å’Œè®¡ç®—æ–¹æ³•
4. æ·»åŠ åˆ°åˆ†ç±»æ ‘
5. é…ç½®çº¹ç†å’Œå‚æ•°

---

## äºŒåä¸€ã€æ€»ç»“

### 21.1 ç³»ç»Ÿä»·å€¼

ğŸ  **å…¨å±‹ç¡¬è£…ä¸€ä½“åŒ–è§£å†³æ–¹æ¡ˆ**:
- æ¶µç›–åœ°é¢ã€å¢™é¢ã€åŠé¡¶ã€è£…é¥°çº¿å…¨éƒ¨ç¡¬è£…å…ƒç´ 
- ä»è®¾è®¡åˆ°æŠ¥ä»·çš„å®Œæ•´é—­ç¯
- ç²¾ç¡®çš„ææ–™ç”¨é‡è®¡ç®—
- è‡ªåŠ¨åŒ–BOMç”Ÿæˆ

ğŸ“Š **æ•°æ®é©±åŠ¨è®¾è®¡**:
- å®æ—¶é¢ç§¯ç»Ÿè®¡
- æ™ºèƒ½æè´¨æ¨è
- æˆæœ¬å®æ—¶é¢„è§ˆ
- å¤šæ–¹æ¡ˆå¯¹æ¯”

ğŸ’° **é™æœ¬å¢æ•ˆ**:
- å‡å°‘ææ–™æµªè´¹ (ç²¾ç¡®è®¡ç®—)
- æé«˜è®¾è®¡æ•ˆç‡ (è‡ªåŠ¨åŒ–)
- é™ä½æ²Ÿé€šæˆæœ¬ (å¯è§†åŒ–)
- åŠ é€ŸæŠ¥ä»·æµç¨‹ (å³æ—¶ç”Ÿæˆ)

### 21.2 
æŠ€æœ¯ç‰¹è‰²

ğŸ¯ **å‚æ•°åŒ–é©±åŠ¨**: æ‰€æœ‰ç¡¬è£…å…ƒç´ å‚æ•°åŒ–å¯è°ƒ

ğŸ¨ **å¯è§†åŒ–è®¾è®¡**: æ‰€è§å³æ‰€å¾—çš„3Dé¢„è§ˆ

ğŸ”§ **æ™ºèƒ½çº¦æŸ**: è‡ªåŠ¨æ£€æµ‹å†²çªå’Œé”™è¯¯

ğŸ“ **ç²¾ç¡®è®¡ç®—**: å·¥ç¨‹çº§ç²¾åº¦çš„é¢ç§¯å’Œç”¨é‡

ğŸ”„ **å®æ—¶æ›´æ–°**: ä¿®æ”¹å³æ—¶åæ˜ åˆ°BOM

### 21.3 åº”ç”¨åœºæ™¯

**å®¶è£…è®¾è®¡å…¬å¸**:
- å¿«é€Ÿå‡ºè®¾è®¡æ–¹æ¡ˆ
- ç²¾å‡†ææ–™æŠ¥ä»·
- å®¢æˆ·3Dé¢„è§ˆ
- æ–½å·¥å›¾å¯¼å‡º

**è£…ä¿®å…¬å¸**:
- ææ–™é‡‡è´­æ¸…å•
- å·¥ç¨‹é‡æ ¸ç®—
- è¿›åº¦ç®¡ç†
- æˆæœ¬æ§åˆ¶

**ä¸šä¸»DIY**:
- è‡ªåŠ©è®¾è®¡ç¡¬è£…
- é¢„ç®—æ§åˆ¶
- æè´¨é€‰æ‹©
- æ•ˆæœé¢„è§ˆ

**ææ–™ä¾›åº”å•†**:
- äº§å“æ¨è
- ç”¨é‡è®¡ç®—
- é…å¥—æœåŠ¡
- æ•°æ®å¯¹æ¥

---

## äºŒåäºŒã€æ–‡æ¡£å…ƒä¿¡æ¯

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-22  
**åˆ†ææ¨¡å—**: 
- `core-hs.fe5726b7.bundle` - æ ¸å¿ƒå‡ ä½•å¼•æ“
- `plugins-hs-aa8c4e59.fe5726b7.bundle` - BOMæ’ä»¶ç³»ç»Ÿ

**æºç æ–‡ä»¶ç»Ÿè®¡**:
- æ ¸å¿ƒæ–‡ä»¶: 5ä¸ªå…³é”®ç±»
- è¾…åŠ©å·¥å…·: 20+å·¥å…·ç±»
- æ€»ä»£ç é‡: ~2000è¡Œ (æ ¸å¿ƒé€»è¾‘)

**å…³é”®ç®—æ³•**:
- æˆ¿é—´è¯†åˆ«: RoomExtractor
- å¼‚å½¢é“ºè´´: PaveRubbleAlgorithm  
- å¸ƒå°”è¿ç®—: ClipperLib
- æè´¨ç»Ÿè®¡: B2Material/B3Material
- BOMç”Ÿæˆ: B2Data/B3Data

---

## äºŒåä¸‰ã€ç›¸å…³æ–‡æ¡£ç´¢å¼•

**ç³»ç»Ÿæ¶æ„æ–‡æ¡£**:
- [Core-HSå®Œæ•´æ¶æ„](./core-hs-complete-module-architecture-full.md) - æ ¸å¿ƒå»ºæ¨¡å¼•æ“
- [BOMæŠ¥ä»·ç³»ç»Ÿæ¶æ„](./bom-quotation-system-complete-architecture.md) - BOMç”Ÿæˆè¯¦è§£
- [æŸœä½“å®šåˆ¶ç³»ç»Ÿ](./cabinet-customization-complete-architecture.md) - æ©±æŸœè¡£æŸœç³»ç»Ÿ
- [æ°´ç”µæš—è£…ç³»ç»Ÿ](./concealed-work-water-electricity-complete.md) - æ°´ç”µå¸ƒçº¿ç³»ç»Ÿ

**ä¸šåŠ¡æµç¨‹æ–‡æ¡£**:
- [ç¡¬è£…è®¾è®¡æµç¨‹](#ä¹ç¡¬è£…å·¥ä½œæµç¨‹) - å®Œæ•´è®¾è®¡æµç¨‹
- [BOMå¯¼å‡ºæµç¨‹](#åäºŒå®Œæ•´ç¡¬è£…BOMæµç¨‹å›¾) - BOMç”Ÿæˆæµç¨‹
- [æè´¨ç®¡ç†æµç¨‹](#äº”æè´¨ç®¡ç†ç³»ç»Ÿ) - æè´¨æå–å’Œç»Ÿè®¡

**æŠ€æœ¯å‚è€ƒ**:
- [å¼‚å½¢é“ºè´´ç®—æ³•](#131-å¼‚å½¢ç“·ç –è®¡ç®—ç®—æ³•) - æ ¸å¿ƒç®—æ³•è¯¦è§£
- [æ•°æ®ç»“æ„è¯¦è§£](#åæ•°æ®ç»“æ„è¯¦è§£) - å®Œæ•´æ•°æ®æ¨¡å‹
- [APIæ¥å£](#åä¸ƒapiæ¥å£æ€»è§ˆ) - å¼€å‘æ¥å£æ–‡æ¡£

---

## äºŒåå››ã€ç‰ˆæœ¬å†å²

**v1.0** (2026-01-22):
- âœ… åˆå§‹ç‰ˆæœ¬
- âœ… å®Œæ•´ç³»ç»Ÿæ¶æ„åˆ†æ
- âœ… æ ¸å¿ƒç®—æ³•è¯¦è§£
- âœ… æºç æ–‡ä»¶ç´¢å¼•
- âœ… APIæ¥å£æ–‡æ¡£
- âœ… å®é™…æ¡ˆä¾‹æ¼”ç¤º

**å¾…å®Œå–„**:
- â³ æ›´å¤šå®é™…æ¡ˆä¾‹
- â³ æ€§èƒ½åŸºå‡†æµ‹è¯•
- â³ è§†é¢‘æ•™ç¨‹é“¾æ¥
- â³ å¸¸è§é”™è¯¯æ’æŸ¥

---

**END OF DOCUMENT**

---

**æ–‡æ¡£è´¡çŒ®è€…**: AIé€†å‘åˆ†æ  
**æ•°æ®æ¥æº**: çœŸå®æºç è§£æ  
**éªŒè¯çŠ¶æ€**: æ‰€æœ‰è¡Œå·å’Œæ–‡ä»¶è·¯å¾„å·²éªŒè¯  
**æœ€åæ›´æ–°**: 2026-01-22 13:55 (UTC+8)