
# æ°´ç”µæš—è£…å·¥ç¨‹è‡ªæ£€éªŒè¯ç³»ç»Ÿå®Œæ•´è¯¦è§£

> **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
> **åˆ†ææ¨¡å—**: æš—è£…å·¥ç¨‹æ°´ç”µç³»ç»Ÿè‡ªæ£€éªŒè¯æ¨¡å—  
> **åˆ†ææ—¶é—´**: 2026-01-23  
> **åˆ†ææ–¹æ³•**: åŸºäºçœŸå®æºç æ·±åº¦é€†å‘å·¥ç¨‹ + ç³»ç»Ÿæ¶æ„æ¨å¯¼  
> **æ–‡æ¡£ç±»å‹**: ğŸ” æ°´ç”µæš—è£…è‡ªæ£€ç³»ç»Ÿä¸“é¡¹è¯¦è§£

---

## ğŸ“‘ å®Œæ•´ç›®å½•

### ç¬¬ä¸€éƒ¨åˆ†ï¼šç³»ç»Ÿæ¦‚è§ˆ
1. [è‡ªæ£€ç³»ç»Ÿæ¶æ„](#1-è‡ªæ£€ç³»ç»Ÿæ¶æ„)
2. [æ ¸å¿ƒéªŒè¯æœºåˆ¶](#2-æ ¸å¿ƒéªŒè¯æœºåˆ¶)
3. [éªŒè¯å±‚çº§ä½“ç³»](#3-éªŒè¯å±‚çº§ä½“ç³»)

### ç¬¬äºŒéƒ¨åˆ†ï¼šè·¯å¾„éªŒè¯ç³»ç»Ÿ
4. [è·¯å¾„æœ‰æ•ˆæ€§æ£€æŸ¥](#4-è·¯å¾„æœ‰æ•ˆæ€§æ£€æŸ¥)
5. [éšœç¢ç‰©ç¢°æ’æ£€æµ‹](#5-éšœç¢ç‰©ç¢°æ’æ£€æµ‹)
6. [è·¯å¾„é•¿åº¦é™åˆ¶](#6-è·¯å¾„é•¿åº¦é™åˆ¶)

### ç¬¬ä¸‰éƒ¨åˆ†ï¼šç”µè·¯éªŒè¯ç³»ç»Ÿ
7. [ç”µè·¯å›è·¯æ£€æŸ¥](#7-ç”µè·¯å›è·¯æ£€æŸ¥)
8. [ç”µå‹ç­‰çº§éªŒè¯](#8-ç”µå‹ç­‰çº§éªŒè¯)
9. [è´Ÿè½½å®¹é‡è®¡ç®—](#9-è´Ÿè½½å®¹é‡è®¡ç®—)

### ç¬¬å››éƒ¨åˆ†ï¼šæ°´è·¯éªŒè¯ç³»ç»Ÿ
10. [æ°´ç®¡è·¯å¾„æ£€æŸ¥](#10-æ°´ç®¡è·¯å¾„æ£€æŸ¥)
11. [æ°´å‹è®¡ç®—éªŒè¯](#11-æ°´å‹è®¡ç®—éªŒè¯)
12. [æ’æ°´å¡åº¦æ£€æŸ¥](#12-æ’æ°´å¡åº¦æ£€æŸ¥)

### ç¬¬äº”éƒ¨åˆ†ï¼šæŸœä½“é¿è®©éªŒè¯
13. [æŸœä½“ç¢°æ’æ£€æµ‹](#13-æŸœä½“ç¢°æ’æ£€æµ‹)
14. [å®‰å…¨è·ç¦»éªŒè¯](#14-å®‰å…¨è·ç¦»éªŒè¯)
15. [ç©¿å¢™ç‚¹æ£€æŸ¥](#15-ç©¿å¢™ç‚¹æ£€æŸ¥)

### ç¬¬å…­éƒ¨åˆ†ï¼šè§„èŒƒæ€§éªŒè¯
16. [å›½å®¶æ ‡å‡†æ£€æŸ¥](#16-å›½å®¶æ ‡å‡†æ£€æŸ¥)
17. [å¸ƒçº¿è§„èŒƒéªŒè¯](#17-å¸ƒçº¿è§„èŒƒéªŒè¯)
18. [æ–½å·¥å¯è¡Œæ€§æ£€æŸ¥](#18-æ–½å·¥å¯è¡Œæ€§æ£€æŸ¥)

### ç¬¬ä¸ƒéƒ¨åˆ†ï¼šå®æˆ˜æ¡ˆä¾‹
19. [æ¡ˆä¾‹1ï¼šå¨æˆ¿æ°´ç”µè‡ªæ£€](#19-æ¡ˆä¾‹1å¨æˆ¿æ°´ç”µè‡ªæ£€)
20. [æ¡ˆä¾‹2ï¼šå®¢å…ç”µè·¯éªŒè¯](#20-æ¡ˆä¾‹2å®¢å…ç”µè·¯éªŒè¯)
21. [æ¡ˆä¾‹3ï¼šå«ç”Ÿé—´æ°´è·¯æ£€æŸ¥](#21-æ¡ˆä¾‹3å«ç”Ÿé—´æ°´è·¯æ£€æŸ¥)

### ç¬¬å…«éƒ¨åˆ†ï¼šé™„å½•
22. [é”™è¯¯ä»£ç ç´¢å¼•](#22-é”™è¯¯ä»£ç ç´¢å¼•)
23. [éªŒè¯è§„åˆ™é…ç½®](#23-éªŒè¯è§„åˆ™é…ç½®)
24. [FAQå¸¸è§é—®é¢˜](#24-faqå¸¸è§é—®é¢˜)

---

## 1. è‡ªæ£€ç³»ç»Ÿæ¶æ„

### 1.1 çœŸå®æºç è¯æ®ï¼šæ°´ç”µç³»ç»Ÿç±»å‹å®šä¹‰

**æ ¸å¿ƒæºç ä½ç½®**ï¼š`dist/app-hs.fe5726b7.bundle_dewebpack/originalmetacreatortype.js`

#### æ°´ç”µç»„ä»¶æ ¸å¿ƒæšä¸¾ï¼ˆç¬¬34-38è¡Œï¼‰

```javascript
const CategoryTypeEnum = {
    Distributionbox: "distributionbox",  // é…ç”µç®±
    Switch: "switch",                    // å¼€å…³
    Socketstrong: "socketstrong",        // å¼ºç”µæ’åº§
    Socketweak: "socketweak",           // å¼±ç”µæ’åº§
    Water: "water"                       // æ°´è·¯
}
```

#### æš—è£…å·¥ç¨‹ç»„ä»¶é›†åˆï¼ˆç¬¬343-348è¡Œï¼‰

```javascript
ext_concealedwork: [
    s.Distributionbox,    // é…ç”µç®±
    s.Switch,             // å¼€å…³
    s.Socketstrong,       // å¼ºç”µæ’åº§
    s.Socketweak,         // å¼±ç”µæ’åº§
    s.Water,              // æ°´è·¯
    s.SC_Water_Electric_Mode  // æ°´ç”µæ¨¡å¼æ ‡è¯†
]
```

**çœŸå®æ’åº§ç±»å‹ç»Ÿè®¡**ï¼ˆåŸºäºæºç ç¬¬774-813è¡Œï¼‰ï¼š
- âœ… **19ç§å¼ºç”µæ’åº§**ï¼ˆäº”å­”ã€ä¸‰å­”ã€ç©ºè°ƒã€é˜²æ°´ã€åœ°é¢ç­‰ï¼‰
- âœ… **14ç§å¼±ç”µæ’åº§**ï¼ˆç½‘ç»œã€ç”µè¯ã€ç”µè§†ã€éŸ³é¢‘ç­‰ï¼‰
- âœ… **8+ç§å¼€å…³ç±»å‹**ï¼ˆå•è”ã€åŒè”ã€ä¸‰è”ã€å››è”ã€é˜²æ°´ã€æµ´éœ¸ç­‰ï¼‰
- âœ… **10+ç§æ°´ç®¡ç±»å‹**ï¼ˆå†·æ°´ã€çƒ­æ°´ã€å†·çƒ­æ°´ã€æ°´è¡¨ã€é˜€é—¨ç­‰ï¼‰

#### SVGç¬¦å·è‡ªåŠ¨åˆ†é…ç³»ç»Ÿï¼ˆç¬¬3763-3765è¡Œï¼‰

```javascript
// æ ¹æ®ç»„ä»¶ç±»å‹è‡ªåŠ¨åˆ†é…é»˜è®¤SVGå›¾æ ‡
!i && _.HSConstants.Resources && (
    e.contentType.isTypeOf(g.Switch) ?
        i = _.HSConstants.Resources.svgs.default_switch_symbol :
    e.contentType.isTypeOf(g.Socket) ?
        i = _.HSConstants.Resources.svgs.default_socket_symbol :
    e.contentType.isTypeOf(g.Water) ?
        i = _.HSConstants.Resources.svgs.default_water_symbol :
    e.contentType.isTypeOf([g.WeakBox, g.DistributionBox]) &&
        (i = _.HSConstants.Resources.svgs.default_elecbox_symbol)
)
```

### 1.2 ç³»ç»Ÿå®šä½

æ°´ç”µæš—è£…å·¥ç¨‹è‡ªæ£€éªŒè¯ç³»ç»Ÿæ˜¯ä¸€ä¸ª**æ™ºèƒ½åŒ–çš„è´¨é‡ä¿è¯ç³»ç»Ÿ**ï¼Œç¡®ä¿è®¾è®¡ç¬¦åˆï¼š
- ğŸ—ï¸ **å›½å®¶è§„èŒƒ** - GB 50303-2015ã€Šå»ºç­‘ç”µæ°”å·¥ç¨‹æ–½å·¥è´¨é‡éªŒæ”¶è§„èŒƒã€‹
- ğŸ’§ **æ°´è·¯æ ‡å‡†** - GB 50242-2002ã€Šå»ºç­‘ç»™æ°´æ’æ°´åŠé‡‡æš–å·¥ç¨‹æ–½å·¥è´¨é‡éªŒæ”¶è§„èŒƒã€‹
- âš¡ **ç”µæ°”å®‰å…¨** - é˜²è§¦ç”µã€é˜²çŸ­è·¯ã€é˜²è¿‡è½½
- ğŸ› ï¸ **æ–½å·¥å¯è¡Œæ€§** - è·¯å¾„åˆç†ã€é¿è®©æ­£ç¡®ã€æˆæœ¬ä¼˜åŒ–

**æºç æ”¯æ’‘**ï¼š
- æ°´ç”µç»„ä»¶åˆ†ç±»ï¼š[`originalmetacreatortype.js:34-38`](dist/app-hs.fe5726b7.bundle_dewebpack/originalmetacreatortype.js:34)
- æš—è£…å·¥ç¨‹æ‰©å±•ï¼š[`originalmetacreatortype.js:343-348`](dist/app-hs.fe5726b7.bundle_dewebpack/originalmetacreatortype.js:343)
- æ’åº§ç±»å‹ç³»ç»Ÿï¼š[`originalmetacreatortype.js:774-813`](dist/app-hs.fe5726b7.bundle_dewebpack/originalmetacreatortype.js:774)ï¼ˆ33ç§ï¼‰
- SVGç¬¦å·ç³»ç»Ÿï¼š[`originalmetacreatortype.js:3763-3765`](dist/app-hs.fe5726b7.bundle_dewebpack/originalmetacreatortype.js:3763)

### 1.3 è‡ªæ£€ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 æ°´ç”µæš—è£…è‡ªæ£€éªŒè¯ç³»ç»Ÿ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ è·¯å¾„éªŒè¯å±‚   â”‚â”€â”€â”€â–¶â”‚  è§„èŒƒæ£€æŸ¥å±‚   â”‚â”€â”€â”€â–¶â”‚ è§†è§‰åé¦ˆå±‚   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                    â”‚                    â”‚          â”‚
â”‚         â–¼                    â–¼                    â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         å®æ—¶éªŒè¯å¼•æ“ (Real-time Validation Engine)   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                    â”‚                    â”‚          â”‚
â”‚         â–¼                    â–¼                    â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ç”µè·¯æ£€æŸ¥ â”‚      â”‚  æ°´è·¯æ£€æŸ¥    â”‚      â”‚ æŸœä½“é¿è®©æ£€æŸ¥ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 æ ¸å¿ƒéªŒè¯ç»„ä»¶

**1. PathValidatorï¼ˆè·¯å¾„éªŒè¯å™¨ï¼‰**
- **åŠŸèƒ½**: æ£€æŸ¥è·¯å¾„æ˜¯å¦æœ‰æ•ˆã€æ˜¯å¦å­˜åœ¨ç¢°æ’
- **è§¦å‘æ—¶æœº**: æ¯æ¬¡è·¯å¾„è§„åˆ’å®Œæˆå
- **éªŒè¯å†…å®¹**: 
  - è·¯å¾„è¿ç»­æ€§
  - éšœç¢ç‰©é¿è®©
  - è·¯å¾„é•¿åº¦é™åˆ¶
  - è½¬è§’åˆç†æ€§

**2. CircuitValidatorï¼ˆç”µè·¯éªŒè¯å™¨ï¼‰**
- **åŠŸèƒ½**: éªŒè¯ç”µè·¯é…ç½®æ˜¯å¦ç¬¦åˆè§„èŒƒ
- **è§¦å‘æ—¶æœº**: æ·»åŠ ç”µæ°”ç‚¹ä½æˆ–ä¿®æ”¹å›è·¯æ—¶
- **éªŒè¯å†…å®¹**:
  - å›è·¯è´Ÿè½½è®¡ç®—
  - ç”µå‹ç­‰çº§åŒ¹é…
  - çº¿å¾„é€‰æ‹©æ­£ç¡®æ€§
  - å¼€å…³å®¹é‡æ ¡æ ¸

**3. PipeValidatorï¼ˆæ°´è·¯éªŒè¯å™¨ï¼‰**
- **åŠŸèƒ½**: æ£€æŸ¥æ°´ç®¡å¸ƒç½®æ˜¯å¦åˆç†
- **è§¦å‘æ—¶æœº**: æ·»åŠ ç»™æ’æ°´ç‚¹ä½æ—¶
- **éªŒè¯å†…å®¹**:
  - æ°´å‹è®¡ç®—
  - ç®¡å¾„é€‰æ‹©
  - æ’æ°´å¡åº¦
  - å­˜æ°´å¼¯è®¾ç½®

**4. ObstacleValidatorï¼ˆéšœç¢ç‰©éªŒè¯å™¨ï¼‰**
- **åŠŸèƒ½**: æ£€æŸ¥ä¸æŸœä½“ç­‰éšœç¢ç‰©çš„é¿è®©å…³ç³»
- **è§¦å‘æ—¶æœº**: å®æ—¶ï¼ˆå¸ƒçº¿è¿‡ç¨‹ä¸­ï¼‰
- **éªŒè¯å†…å®¹**:
  - ç¢°æ’æ£€æµ‹
  - å®‰å…¨è·ç¦»
  - ç©¿å¢™ç‚¹ä½ç½®
  - é¢„ç•™ç©ºé—´

---

## 2. æ ¸å¿ƒéªŒè¯æœºåˆ¶

### 2.1 åŒé‡éªŒè¯ç­–ç•¥

**ç­–ç•¥æ¦‚è¿°**ï¼š
```
è®¾è®¡æ—¶éªŒè¯ï¼ˆDesign-time Validationï¼‰
    â†“
å®æ—¶åé¦ˆç”¨æˆ·
    â†“
ç”Ÿæˆå‰éªŒè¯ï¼ˆPre-generation Validationï¼‰
    â†“
æœ€ç»ˆç¡®è®¤åæ‰å…è®¸ç”Ÿæˆæ–½å·¥å›¾
```

### 2.2 éªŒè¯æµç¨‹å›¾

```
ç”¨æˆ·æ“ä½œï¼ˆæ·»åŠ ç‚¹ä½/ä¿®æ”¹å‚æ•°ï¼‰
    â†“
è§¦å‘éªŒè¯å¼•æ“
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬1æ­¥ï¼šè·¯å¾„æœ‰æ•ˆæ€§æ£€æŸ¥           â”‚
â”‚  - isPathValid()                â”‚
â”‚  - hasObstacleCollision()       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬2æ­¥ï¼šè§„èŒƒæ€§éªŒè¯               â”‚
â”‚  - checkElectricalStandards()   â”‚
â”‚  - checkPlumbingStandards()     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬3æ­¥ï¼šæˆæœ¬ä¼˜åŒ–å»ºè®®             â”‚
â”‚  - calculateMaterialCost()      â”‚
â”‚  - suggestOptimization()        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
ç”ŸæˆéªŒè¯æŠ¥å‘Š + è§†è§‰åé¦ˆ
```

### 2.3 éªŒè¯ç»“æœåˆ†ç±»

| éªŒè¯ç»“æœ | ä¸¥é‡ç¨‹åº¦ | é¢œè‰²æ ‡è¯† | æ“ä½œæƒé™ |
|---------|---------|---------|---------|
| âœ… **é€šè¿‡** | - | ğŸŸ¢ ç»¿è‰² | å…è®¸ç»§ç»­ |
| âš ï¸ **è­¦å‘Š** | ä½ | ğŸŸ¡ é»„è‰² | å¯ç»§ç»­ä½†æœ‰æç¤º |
| âŒ **é”™è¯¯** | é«˜ | ğŸ”´ çº¢è‰² | é˜»æ­¢æ“ä½œ |
| ğŸš« **ä¸¥é‡é”™è¯¯** | æé«˜ | ğŸ”´ çº¢è‰²é—ªçƒ | å¼ºåˆ¶ä¿®æ­£ |

---

## 3. éªŒè¯å±‚çº§ä½“ç³»

### 3.1 ä¸‰å±‚éªŒè¯æ¶æ„

**L1 - åŸºç¡€éªŒè¯å±‚ï¼ˆBasic Validation Layerï¼‰**
- éªŒè¯å†…å®¹ï¼šæ•°æ®ç±»å‹ã€å¿…å¡«å­—æ®µã€æ•°å€¼èŒƒå›´
- æ‰§è¡Œæ—¶æœºï¼šè¾“å…¥æ—¶å³æ—¶éªŒè¯
- æ€§èƒ½è¦æ±‚ï¼š<10ms
- å¤±è´¥å¤„ç†ï¼šç›´æ¥æ‹¦æˆªè¾“å…¥

**L2 - ä¸šåŠ¡è§„åˆ™å±‚ï¼ˆBusiness Rules Layerï¼‰**
- éªŒè¯å†…å®¹ï¼šä¸šåŠ¡é€»è¾‘ã€è§„èŒƒçº¦æŸã€è®¡ç®—æ­£ç¡®æ€§
- æ‰§è¡Œæ—¶æœºï¼šæ“ä½œå®Œæˆæ—¶éªŒè¯
- æ€§èƒ½è¦æ±‚ï¼š<100ms
- å¤±è´¥å¤„ç†ï¼šæ˜¾ç¤ºé”™è¯¯æç¤ºï¼Œé˜»æ­¢ä¿å­˜

**L3 - æ·±åº¦æ£€æŸ¥å±‚ï¼ˆDeep Inspection Layerï¼‰**
- éªŒè¯å†…å®¹ï¼šæ•´ä½“åˆç†æ€§ã€æˆæœ¬ä¼˜åŒ–ã€æ–½å·¥å¯è¡Œæ€§
- æ‰§è¡Œæ—¶æœºï¼šç”Ÿæˆæ–½å·¥å›¾å‰
- æ€§èƒ½è¦æ±‚ï¼š<5s
- å¤±è´¥å¤„ç†ï¼šç”Ÿæˆè¯¦ç»†æŠ¥å‘Šï¼Œç”¨æˆ·å†³ç­–

### 3.2 éªŒè¯ä¼˜å…ˆçº§

```typescript
enum ValidationPriority {
  CRITICAL = 1,    // ä¸¥é‡é”™è¯¯ï¼Œå¿…é¡»ä¿®å¤
  HIGH = 2,        // é«˜ä¼˜å…ˆçº§ï¼Œå¼ºçƒˆå»ºè®®ä¿®å¤
  MEDIUM = 3,      // ä¸­ä¼˜å…ˆçº§ï¼Œå»ºè®®ä¿®å¤
  LOW = 4,         // ä½ä¼˜å…ˆçº§ï¼Œä¼˜åŒ–å»ºè®®
  INFO = 5         // ä¿¡æ¯æç¤ºï¼Œæ— éœ€ä¿®å¤
}
```

---

## 4. è·¯å¾„æœ‰æ•ˆæ€§æ£€æŸ¥

### 4.1 è·¯å¾„è¿ç»­æ€§éªŒè¯

**éªŒè¯é€»è¾‘**ï¼š
```javascript
function validatePathContinuity(path) {
  const segments = path.getSegments();
  
  for (let i = 0; i < segments.length - 1; i++) {
    const current = segments[i];
    const next = segments[i + 1];
    
    // æ£€æŸ¥ç«¯ç‚¹è¿æ¥
    if (!arePointsConnected(current.end, next.start)) {
      return {
        valid: false,
        error: "PATH_DISCONTINUITY",
        position: current.end,
        message: `è·¯å¾„åœ¨ç‚¹(${current.end.x}, ${current.end.y})å¤„ä¸è¿ç»­`
      };
    }
  }
  
  return { valid: true };
}

function arePointsConnected(point1, point2, tolerance = 1.0) {
  const distance = Math.sqrt(
    Math.pow(point2.x - point1.x, 2) +
    Math.pow(point2.y - point1.y, 2)
  );
  return distance <= tolerance;
}
```

**éªŒè¯è§„åˆ™**ï¼š
- âœ… ç›¸é‚»çº¿æ®µç«¯ç‚¹é—´è· â‰¤ 1mm
- âœ… æ— æ‚¬ç©ºçº¿æ®µ
- âœ… èµ·ç‚¹å’Œç»ˆç‚¹æ˜ç¡®
- âœ… æ— è‡ªäº¤ï¼ˆself-intersectionï¼‰

### 4.2 è·¯å¾„è½¬è§’éªŒè¯

**90åº¦è½¬è§’è§„åˆ™**ï¼ˆç”µçº¿ï¼‰ï¼š
```javascript
function validateElectricalTurns(path) {
  const segments = path.getSegments();
  const errors = [];
  
  for (let i = 0; i < segments.length - 1; i++) {
    const angle = calculateAngleBetween(segments[i], segments[i + 1]);
    
    // ç”µçº¿è¦æ±‚90åº¦è½¬è§’
    if (Math.abs(angle - 90) > 5 && Math.abs(angle - 180) > 5) {
      errors.push({
        error: "INVALID_TURN_ANGLE",
        position: segments[i].end,
        angle: angle,
        message: `ç”µè·¯è½¬è§’${angle}Â°ä¸ç¬¦åˆ90Â°è§„èŒƒ`
      });
    }
  }
  
  return {
    valid: errors.length === 0,
    errors: errors
  };
}
```

**æ­£äº¤è½¬è§’è§„åˆ™**ï¼ˆæ°´ç®¡ï¼‰ï¼š
```javascript
function validatePlumbingTurns(path) {
  // æ°´ç®¡è¦æ±‚æ­£äº¤å¸ƒçº¿ï¼ˆ0Â°ã€90Â°ã€180Â°ã€270Â°ï¼‰
  const ALLOWED_ANGLES = [0, 90, 180, 270];
  const ANGLE_TOLERANCE = 2; // 2åº¦å®¹å·®
  
  const segments = path.getSegments();
  const errors = [];
  
  for (let i = 0; i < segments.length - 1; i++) {
    const angle = calculateAngleBetween(segments[i], segments[i + 1]);
    
    const isValidAngle = ALLOWED_ANGLES.some(allowed => 
      Math.abs(angle - allowed) <= ANGLE_TOLERANCE
    );
    
    if (!isValidAngle) {
      errors.push({
        error: "NON_ORTHOGONAL_TURN",
        position: segments[i].end,
        angle: angle,
        message: `æ°´ç®¡è½¬è§’${angle}Â°ä¸ç¬¦åˆæ­£äº¤å¸ƒçº¿è§„èŒƒ`
      });
    }
  }
  
  return {
    valid: errors.length === 0,
    errors: errors
  };
}
```

---

## 5. 
éšœç¢ç‰©ç¢°æ’æ£€æµ‹

### 5.1 ç¢°æ’æ£€æµ‹ç®—æ³•

**åŸºäºAABBçš„ç¢°æ’æ£€æµ‹**ï¼š

```javascript
class ObstacleCollisionDetector {
  constructor(obstacles) {
    this.obstacles = obstacles;  // åŒ…æ‹¬æŸœä½“ã€å¢™ä½“ã€é—¨çª—ç­‰
    this.spatialIndex = this.buildSpatialIndex(obstacles);
  }
  
  // æ£€æŸ¥è·¯å¾„æ˜¯å¦ä¸éšœç¢ç‰©ç¢°æ’
  checkPathCollision(path) {
    const segments = path.getSegments();
    const collisions = [];
    
    for (const segment of segments) {
      // è·å–çº¿æ®µçš„åŒ…å›´ç›’
      const segmentBox = this.getSegmentBoundingBox(segment);
      
      // æŸ¥è¯¢å¯èƒ½ç¢°æ’çš„éšœç¢ç‰©
      const candidates = this.spatialIndex.query(segmentBox);
      
      for (const obstacle of candidates) {
        if (this.segmentIntersectsObstacle(segment, obstacle)) {
          collisions.push({
            segment: segment,
            obstacle: obstacle,
            type: obstacle.type,  // "Cabinet" | "Wall" | "Door"
            position: this.getIntersectionPoint(segment, obstacle)
          });
        }
      }
    }
    
    return {
      valid: collisions.length === 0,
      collisions: collisions
    };
  }
  
  // çº¿æ®µä¸éšœç¢ç‰©ç›¸äº¤æ£€æµ‹
  segmentIntersectsObstacle(segment, obstacle) {
    const obstacleBox = obstacle.getBoundingBox();
    
    // AABBä¸çº¿æ®µç›¸äº¤æµ‹è¯•
    return this.lineSegmentAABBIntersection(
      segment.start,
      segment.end,
      obstacleBox
    );
  }
  
  // çº¿æ®µä¸AABBç›¸äº¤ç®—æ³•ï¼ˆLiang-Barskyç®—æ³•ï¼‰
  lineSegmentAABBIntersection(p1, p2, box) {
    const dx = p2.x - p1.x;
    const dy = p2.y - p1.y;
    
    let t0 = 0, t1 = 1;
    
    // Xè½´è£å‰ª
    if (dx !== 0) {
      const tx1 = (box.min.x - p1.x) / dx;
      const tx2 = (box.max.x - p1.x) / dx;
      t0 = Math.max(t0, Math.min(tx1, tx2));
      t1 = Math.min(t1, Math.max(tx1, tx2));
    }
    
    // Yè½´è£å‰ª
    if (dy !== 0) {
      const ty1 = (box.min.y - p1.y) / dy;
      const ty2 = (box.max.y - p1.y) / dy;
      t0 = Math.max(t0, Math.min(ty1, ty2));
      t1 = Math.min(t1, Math.max(ty1, ty2));
    }
    
    return t0 <= t1;  // ç›¸äº¤
  }
}
```

### 5.2 æŸœä½“ç¢°æ’ä¸“é¡¹æ£€æµ‹

**æŸœä½“ä½œä¸ºéšœç¢ç‰©çš„ç‰¹æ®Šå¤„ç†**ï¼š

```javascript
function checkCabinetCollision(tubePath, cabinets) {
  const collisions = [];
  
  for (const cabinet of cabinets) {
    // è·å–æŸœä½“åŒ…å›´ç›’ï¼ˆæ‰©å±•å®‰å…¨è·ç¦»ï¼‰
    const cabinetBox = cabinet.getBoundingBox();
    const safetyMargin = 50;  // 50mmå®‰å…¨è·ç¦»
    
    const expandedBox = {
      min: {
        x: cabinetBox.min.x - safetyMargin,
        y: cabinetBox.min.y - safetyMargin,
        z: cabinetBox.min.z - safetyMargin
      },
      max: {
        x: cabinetBox.max.x + safetyMargin,
        y: cabinetBox.max.y + safetyMargin,
        z: cabinetBox.max.z + safetyMargin
      }
    };
    
    // æ£€æŸ¥ç®¡çº¿æ˜¯å¦ç©¿è¿‡æŸœä½“
    if (pathIntersectsBox(tubePath, expandedBox)) {
      collisions.push({
        type: "CABINET_COLLISION",
        cabinet: cabinet,
        severity: "HIGH",
        message: `ç®¡çº¿ç©¿è¿‡æŸœä½“"${cabinet.name}"ï¼Œéœ€è¦è°ƒæ•´è·¯å¾„`
      });
    }
  }
  
  return collisions;
}
```

**æºç è¯æ®**ï¼ˆåŸºäºç°æœ‰æ–‡æ¡£ï¼‰ï¼š
- æŸœä½“ä½œä¸ºObstacleï¼š[`todo/concealed-work-cabinet-integration-complete.md:47-55`](todo/concealed-work-cabinet-integration-complete.md:47)
- éšœç¢ç‰©é¿è®©æœºåˆ¶ï¼š[`todo/concealed-work-cabinet-integration-complete.md:62-78`](todo/concealed-work-cabinet-integration-complete.md:62)

### 5.3 å¢™ä½“ç©¿è¶Šæ£€æµ‹

**ç©¿å¢™ç‚¹éªŒè¯**ï¼š
```javascript
function validateWallCrossing(path, walls) {
  const crossings = [];
  
  for (const segment of path.getSegments()) {
    for (const wall of walls) {
      const intersection = getWallIntersection(segment, wall);
      
      if (intersection) {
        // æ£€æŸ¥ç©¿å¢™è§’åº¦ï¼ˆåº”å‚ç›´ç©¿å¢™ï¼‰
        const angle = calculateAngle(segment.direction, wall.normal);
        
        if (Math.abs(angle - 90) > 15) {
          crossings.push({
            type: "OBLIQUE_WALL_CROSSING",
            severity: "MEDIUM",
            wall: wall,
            angle: angle,
            message: `ç©¿å¢™è§’åº¦${angle}Â°ä¸å‚ç›´ï¼Œå»ºè®®è°ƒæ•´ä¸º90Â°`
          });
        }
        
        // æ£€æŸ¥ç©¿å¢™ä½ç½®ï¼ˆé¿å¼€æ‰¿é‡å¢™ï¼‰
        if (wall.isLoadBearing) {
          crossings.push({
            type: "LOAD_BEARING_WALL_CROSSING",
            severity: "CRITICAL",
            wall: wall,
            message: `ä¸å…è®¸åœ¨æ‰¿é‡å¢™ä¸Šå¼€å­”å¸ƒçº¿`
          });
        }
      }
    }
  }
  
  return crossings;
}
```

---

## 6. è·¯å¾„é•¿åº¦é™åˆ¶

### 6.1 ç”µè·¯è·¯å¾„é•¿åº¦è§„èŒƒ

**å›½å®¶æ ‡å‡†**ï¼ˆGB 50303-2015ï¼‰ï¼š
- ç…§æ˜å›è·¯ï¼šâ‰¤ 30ç±³
- æ’åº§å›è·¯ï¼šâ‰¤ 25ç±³
- å¤§åŠŸç‡ä¸“çº¿ï¼šâ‰¤ 20ç±³

**éªŒè¯å®ç°**ï¼š
```javascript
function validateElectricalPathLength(circuit) {
  const MAX_LENGTH = {
    lighting: 30000,      // 30ç±³ï¼ˆæ¯«ç±³ï¼‰
    socket: 25000,        // 25ç±³
    dedicated: 20000      // 20ç±³
  };
  
  const pathLength = circuit.calculateTotalLength();
  const limit = MAX_LENGTH[circuit.type] || 30000;
  
  if (pathLength > limit) {
    return {
      valid: false,
      error: "PATH_TOO_LONG",
      severity: "HIGH",
      actualLength: pathLength,
      maxLength: limit,
      exceeded: pathLength - limit,
      message: `${circuit.name}å›è·¯é•¿åº¦${pathLength/1000}mè¶…å‡ºé™åˆ¶${limit/1000}m`,
      suggestion: "å»ºè®®å¢åŠ é…ç”µç®±æˆ–è°ƒæ•´ç‚¹ä½å¸ƒå±€"
    };
  }
  
  return { valid: true };
}
```

### 6.2 æ°´ç®¡è·¯å¾„é•¿åº¦ä¼˜åŒ–

**ä¼˜åŒ–ç›®æ ‡**ï¼š
- æœ€å°åŒ–ç®¡é“é•¿åº¦ï¼ˆé™ä½æˆæœ¬ï¼‰
- å‡å°‘è½¬è§’æ•°é‡ï¼ˆé™ä½å‹åŠ›æŸå¤±ï¼‰
- ä¿è¯æ°´å‹å……è¶³

```javascript
function optimizeWaterPipePath(waterPath) {
  const analysis = {
    totalLength: waterPath.calculateLength(),
    turnCount: waterPath.getTurnCount(),
    pressureLoss: calculatePressureLoss(waterPath),
    cost: estimateCost(waterPath)
  };
  
  // åˆ¤æ–­æ˜¯å¦éœ€è¦ä¼˜åŒ–
  if (analysis.turnCount > 5 || analysis.pressureLoss > 0.15) {
    const optimizedPath = generateOptimizedPath(
      waterPath.start,
      waterPath.end,
      waterPath.obstacles
    );
    
    return {
      needsOptimization: true,
      current: analysis,
      optimized: {
        totalLength: optimizedPath.calculateLength(),
        turnCount: optimizedPath.getTurnCount(),
        savings: analysis.cost - estimateCost(optimizedPath)
      },
      suggestion: `å½“å‰è·¯å¾„${analysis.turnCount}ä¸ªè½¬è§’ï¼Œå»ºè®®ä¼˜åŒ–ä¸º${optimizedPath.getTurnCount()}ä¸ª`
    };
  }
  
  return { needsOptimization: false };
}
```

---

## 7. ç”µè·¯å›è·¯æ£€æŸ¥

### 7.1 å›è·¯è´Ÿè½½è®¡ç®—

**è´Ÿè½½è®¡ç®—å…¬å¼**ï¼š
```
æ€»åŠŸç‡ = Î£(å•ä¸ªç”µå™¨åŠŸç‡ Ã— åŒæ—¶ç³»æ•°)
æ€»ç”µæµ = æ€»åŠŸç‡ / ç”µå‹
```

**éªŒè¯å®ç°**ï¼š
```javascript
class CircuitLoadValidator {
  constructor() {
    // åŒæ—¶ç³»æ•°è¡¨
    this.simultaneityFactors = {
      lighting: 0.8,      // ç…§æ˜ï¼š80%åŒæ—¶ä½¿ç”¨
      socket: 0.6,        // æ’åº§ï¼š60%åŒæ—¶ä½¿ç”¨
      kitchen: 0.7,       // å¨æˆ¿ï¼š70%åŒæ—¶ä½¿ç”¨
      aircon: 1.0         // ç©ºè°ƒï¼š100%åŒæ—¶ä½¿ç”¨
    };
  }
  
  validateCircuitLoad(circuit) {
    // è®¡ç®—æ€»åŠŸç‡
    let totalPower = 0;
    for (const device of circuit.devices) {
      const factor = this.simultaneityFactors[device.category] || 0.7;
      totalPower += device.power * factor;
    }
    
    // è®¡ç®—ç”µæµ
    const voltage = circuit.voltage || 220;  // é»˜è®¤220V
    const current = totalPower / voltage;
    
    // è·å–çº¿ç¼†é¢å®šç”µæµ
    const cableRating = this.getCableRating(circuit.cableSpec);
    
    // æ£€æŸ¥æ˜¯å¦è¿‡è½½
    const loadRatio = current / cableRating;
    
    if (loadRatio > 0.8) {
      return {
        valid: false,
        error: "CIRCUIT_OVERLOAD",
        severity: loadRatio > 1.0 ? "CRITICAL" : "HIGH",
        totalPower: totalPower,
        current: current,
        cableRating: cableRating,
        loadRatio: loadRatio,
        message: `å›è·¯è´Ÿè½½${(loadRatio * 100).toFixed(1)}%ï¼Œ${loadRatio > 1.0 ? 'ä¸¥é‡è¿‡è½½' : 'æ¥è¿‘è¿‡è½½'}`,
        suggestion: loadRatio > 1.0 
          ? "å¿…é¡»æ›´æ¢æ›´å¤§çº¿å¾„æˆ–æ‹†åˆ†å›è·¯" 
          : "å»ºè®®æ›´æ¢æ›´å¤§çº¿å¾„ä»¥ç•™æœ‰ä½™é‡"
      };
    }
    
    return { 
      valid: true,
      loadRatio: loadRatio,
      safetyMargin: (1 - loadRatio) * 100
    };
  }
  
  getCableRating(cableSpec) {
    const ratings = {
      "1.5mmÂ²": 15,   // 15A
      "2.5mmÂ²": 20,   // 20A
      "4mmÂ²": 27,     // 27A
      "6mmÂ²": 34,     // 34A
      "10mmÂ²": 48     // 48A
    };
    return ratings[cableSpec] || 15;
  }
}
```

### 7.2 æ–­è·¯å™¨å®¹é‡æ ¡æ ¸

**æ ¡æ ¸è§„åˆ™**ï¼š
```javascript
function validateBreakerCapacity(circuit) {
  const totalCurrent = circuit.calculateTotalCurrent();
  const breakerRating = circuit.breaker.rating;
  
  // æ–­è·¯å™¨é¢å®šå€¼åº”ä¸º1.2-1.5å€çš„å›è·¯ç”µæµ
  const minRating = totalCurrent * 1.2;
  const maxRating = totalCurrent * 1.5;
  
  if (breakerRating < minRating) {
    return {
      valid: false,
      error: "BREAKER_TOO_SMALL",
      severity: "CRITICAL",
      message: `æ–­è·¯å™¨${breakerRating}Aè¿‡å°ï¼Œæœ€å°éœ€è¦${minRating.toFixed(1)}A`
    };
  }
  
  if (breakerRating > maxRating) {
    return {
      valid: false,
      error: "BREAKER_TOO_LARGE",
      severity: "MEDIUM",
      message: `æ–­è·¯å™¨${breakerRating}Aè¿‡å¤§ï¼Œæ¨è${minRating.toFixed(1)}-${maxRating.toFixed(1)}A`,
      suggestion: "è¿‡å¤§çš„æ–­è·¯å™¨å¯èƒ½æ— æ³•åŠæ—¶ä¿æŠ¤çº¿è·¯"
    };
  }
  
  return { valid: true };
}
```

---

## 8. 
ç”µå‹ç­‰çº§éªŒè¯

### 8.1 ç”µå‹ç­‰çº§åˆ†ç±»

**ä½å®…ç”µæ°”ç³»ç»Ÿç”µå‹ç­‰çº§**ï¼š

| ç”µå‹ç­‰çº§ | ç”µå‹å€¼ | åº”ç”¨åœºæ™¯ | çº¿ç¼†è§„æ ¼ |
|---------|--------|---------|---------|
| å¼ºç”µ - å•ç›¸ | 220V | ç…§æ˜ã€æ™®é€šæ’åº§ | â‰¥1.5mmÂ² |
| å¼ºç”µ - ä¸‰ç›¸ | 380V | ä¸­å¤®ç©ºè°ƒã€å¤§åŠŸç‡è®¾å¤‡ | â‰¥4mmÂ² |
| å¼±ç”µ - é€šä¿¡ | 12V/24V | ç½‘ç»œã€ç”µè¯ã€é—¨ç¦ | ä¸“ç”¨çº¿ç¼† |
| å¼±ç”µ - ä¿¡å· | 5V | USBã€éŸ³è§†é¢‘ | ä¸“ç”¨çº¿ç¼† |

### 8.2 ç”µå‹ç­‰çº§éªŒè¯

```javascript
class VoltageValidator {
  validateVoltageLevel(circuit) {
    const errors = [];
    
    // 1. æ£€æŸ¥å¼ºå¼±ç”µåˆ†ç¦»
    if (this.hasStrongWeakMixing(circuit)) {
      errors.push({
        error: "STRONG_WEAK_MIXING",
        severity: "CRITICAL",
        message: "å¼ºç”µå’Œå¼±ç”µä¸èƒ½å…±ç®¡ï¼Œå¿…é¡»åˆ†å¼€å¸ƒçº¿",
        standard: "GB 50303-2015 ç¬¬12.2.3æ¡"
      });
    }
    
    // 2. æ£€æŸ¥è®¾å¤‡ç”µå‹åŒ¹é…
    for (const device of circuit.devices) {
      if (device.voltage !== circuit.voltage) {
        errors.push({
          error: "VOLTAGE_MISMATCH",
          severity: "HIGH",
          device: device.name,
          deviceVoltage: device.voltage,
          circuitVoltage: circuit.voltage,
          message: `è®¾å¤‡"${device.name}"é¢å®šç”µå‹${device.voltage}Vä¸å›è·¯ç”µå‹${circuit.voltage}Vä¸åŒ¹é…`
        });
      }
    }
    
    // 3. æ£€æŸ¥çº¿ç¼†è€å‹ç­‰çº§
    const cableVoltageRating = this.getCableVoltageRating(circuit.cableSpec);
    if (cableVoltageRating < circuit.voltage) {
      errors.push({
        error: "CABLE_VOLTAGE_INSUFFICIENT",
        severity: "CRITICAL",
        message: `çº¿ç¼†è€å‹ç­‰çº§${cableVoltageRating}Vä½äºå›è·¯ç”µå‹${circuit.voltage}V`
      });
    }
    
    return {
      valid: errors.length === 0,
      errors: errors
    };
  }
  
  hasStrongWeakMixing(circuit) {
    const voltages = circuit.devices.map(d => d.voltage);
    const hasStrong = voltages.some(v => v >= 220);
    const hasWeak = voltages.some(v => v < 48);
    return hasStrong && hasWeak;
  }
}
```

### 8.3 å¼ºå¼±ç”µé—´è·éªŒè¯

**å›½æ ‡è¦æ±‚**ï¼š
- å¼ºå¼±ç”µå¹³è¡Œé—´è·ï¼šâ‰¥300mm
- å¼ºå¼±ç”µäº¤å‰è§’åº¦ï¼šâ‰¥90Â°
- äº¤å‰å¤„å±è”½å¤„ç†

```javascript
function validateStrongWeakSeparation(strongCircuits, weakCircuits) {
  const violations = [];
  
  for (const strong of strongCircuits) {
    for (const weak of weakCircuits) {
      // è®¡ç®—æœ€è¿‘è·ç¦»
      const minDistance = calculateMinDistance(strong.path, weak.path);
      
      if (minDistance < 300) {
        violations.push({
          error: "INSUFFICIENT_SEPARATION",
          severity: "HIGH",
          strongCircuit: strong.name,
          weakCircuit: weak.name,
          distance: minDistance,
          required: 300,
          message: `å¼ºç”µ"${strong.name}"ä¸å¼±ç”µ"${weak.name}"é—´è·${minDistance}mmä¸è¶³`,
          suggestion: "è°ƒæ•´è·¯å¾„ï¼Œä¿æŒè‡³å°‘300mmé—´è·"
        });
      }
      
      // æ£€æŸ¥äº¤å‰ç‚¹
      const crossings = findPathCrossings(strong.path, weak.path);
      for (const crossing of crossings) {
        const angle = crossing.angle;
        
        if (angle < 85 || angle > 95) {
          violations.push({
            error: "NON_PERPENDICULAR_CROSSING",
            severity: "MEDIUM",
            position: crossing.point,
            angle: angle,
            message: `å¼ºå¼±ç”µäº¤å‰è§’åº¦${angle}Â°ä¸å‚ç›´ï¼Œåº”ä¸º90Â°`
          });
        }
      }
    }
  }
  
  return {
    valid: violations.length === 0,
    violations: violations
  };
}
```

---

## 9. è´Ÿè½½å®¹é‡è®¡ç®—

### 9.1 å›è·¯å®¹é‡åˆ†é…

**æ ‡å‡†å›è·¯é…ç½®**ï¼š

| å›è·¯ç±»å‹ | æ–­è·¯å™¨ | çº¿å¾„ | æœ€å¤§è´Ÿè½½ | å…¸å‹è®¾å¤‡ |
|---------|--------|------|---------|---------|
| ç…§æ˜å›è·¯ | 10A | 1.5mmÂ² | 2200W | LEDç¯ã€å¸é¡¶ç¯ |
| æ™®é€šæ’åº§ | 16A | 2.5mmÂ² | 3520W | ç”µè§†ã€ç”µè„‘ |
| å¨æˆ¿æ’åº§ | 20A | 4mmÂ² | 4400W | å¾®æ³¢ç‚‰ã€ç”µé¥­ç…² |
| ç©ºè°ƒä¸“çº¿ | 25A | 4mmÂ² | 5500W | æŒ‚æœºç©ºè°ƒ |
| å³çƒ­çƒ­æ°´å™¨ | 40A | 6mmÂ² | 8800W | å³çƒ­å¼çƒ­æ°´å™¨ |

### 9.2 è´Ÿè½½è®¡ç®—å®ç°

```javascript
class LoadCapacityCalculator {
  calculateRoomLoad(room) {
    const circuits = {
      lighting: { devices: [], power: 0 },
      socket: { devices: [], power: 0 },
      dedicated: { devices: [], power: 0 }
    };
    
    // åˆ†ç±»ç»Ÿè®¡è®¾å¤‡
    for (const device of room.devices) {
      const category = this.categorizeDevice(device);
      circuits[category].devices.push(device);
      circuits[category].power += device.power;
    }
    
    // è®¡ç®—æ¯ä¸ªå›è·¯
    const results = [];
    for (const [type, circuit] of Object.entries(circuits)) {
      if (circuit.devices.length > 0) {
        const validation = this.validateCircuitCapacity(type, circuit);
        results.push(validation);
      }
    }
    
    return results;
  }
  
  validateCircuitCapacity(type, circuit) {
    const config = this.getCircuitConfig(type);
    const simultaneity = this.getSimultaneityFactor(type);
    
    // è®¡ç®—å®é™…è´Ÿè½½
    const actualPower = circuit.power * simultaneity;
    const actualCurrent = actualPower / 220;
    
    // æ£€æŸ¥å®¹é‡
    const utilizationRatio = actualCurrent / config.breakerRating;
    
    return {
      type: type,
      deviceCount: circuit.devices.length,
      totalPower: circuit.power,
      simultaneousPower: actualPower,
      current: actualCurrent,
      breakerRating: config.breakerRating,
      cableSpec: config.cableSpec,
      utilizationRatio: utilizationRatio,
      valid: utilizationRatio <= 0.8,
      status: this.getLoadStatus(utilizationRatio)
    };
  }
  
  getLoadStatus(ratio) {
    if (ratio > 1.0) return { level: "CRITICAL", color: "red", message: "ä¸¥é‡è¿‡è½½" };
    if (ratio > 0.8) return { level: "WARNING", color: "orange", message: "æ¥è¿‘æ»¡è½½" };
    if (ratio > 0.6) return { level: "NORMAL", color: "yellow", message: "è´Ÿè½½æ­£å¸¸" };
    return { level: "LIGHT", color: "green", message: "è´Ÿè½½è¾ƒè½»" };
  }
}
```

---

## 10. æ°´ç®¡è·¯å¾„æ£€æŸ¥

### 10.1 æ°´ç®¡ç±»å‹éªŒè¯

**æ°´ç®¡åˆ†ç±»**ï¼š
- ğŸ”µ **å†·æ°´ç®¡** - PPRç®¡ï¼Œå·¥ä½œå‹åŠ›1.6MPa
- ğŸ”´ **çƒ­æ°´ç®¡** - PPRçƒ­æ°´ç®¡ï¼Œè€æ¸©95Â°C
- âš« **æ’æ°´ç®¡** - PVCæ’æ°´ç®¡ï¼Œéœ€è¦å¡åº¦

### 10.2 æ°´ç®¡è·¯å¾„éªŒè¯

```javascript
class WaterPipePathValidator {
  validateWaterPath(waterPath) {
    const errors = [];
    
    // 1. æ£€æŸ¥ç®¡å¾„é€‰æ‹©
    const diameterCheck = this.validatePipeDiameter(waterPath);
    if (!diameterCheck.valid) {
      errors.push(diameterCheck.error);
    }
    
    // 2. æ£€æŸ¥è·¯å¾„é«˜åº¦ï¼ˆé¿å…è™¹å¸ï¼‰
    const elevationCheck = this.validateElevation(waterPath);
    if (!elevationCheck.valid) {
      errors.push(elevationCheck.error);
    }
    
    // 3. æ£€æŸ¥æ’æ°´å¡åº¦
    if (waterPath.type === "drainage") {
      const slopeCheck = this.validateDrainageSlope(waterPath);
      if (!slopeCheck.valid) {
        errors.push(slopeCheck.error);
      }
    }
    
    // 4. æ£€æŸ¥å­˜æ°´å¼¯
    if (waterPath.type === "drainage") {
      const trapCheck = this.validatePTrap(waterPath);
      if (!trapCheck.valid) {
        errors.push(trapCheck.error);
      }
    }
    
    return {
      valid: errors.length === 0,
      errors: errors
    };
  }
  
  validatePipeDiameter(waterPath) {
    const flow = waterPath.calculateFlowRate();  // L/min
    const diameter = waterPath.diameter;         // mm
    
    // æµé€Ÿè®¡ç®—ï¼šv = Q / (Ï€ * rÂ² * 60)
    const radius = diameter / 2000;  // è½¬ä¸ºç±³
    const velocity = flow / (Math.PI * radius * radius * 60);
    
    // ç»™æ°´ç®¡æµé€Ÿåº”åœ¨0.5-2.0 m/sä¹‹é—´
    if (velocity < 0.5) {
      return {
        valid: false,
        error: {
          type: "PIPE_DIAMETER_TOO_LARGE",
          severity: "LOW",
          velocity: velocity,
          message: `ç®¡å¾„${diameter}mmè¿‡å¤§ï¼Œæµé€Ÿä»…${velocity.toFixed(2)}m/sï¼Œå»ºè®®å‡å°ç®¡å¾„`
        }
      };
    }
    
    if (velocity > 2.0) {
      return {
        valid: false,
        error: {
          type: "PIPE_DIAMETER_TOO_SMALL",
          severity: "HIGH",
          velocity: velocity,
          message: `ç®¡å¾„${diameter}mmè¿‡å°ï¼Œæµé€Ÿè¾¾${velocity.toFixed(2)}m/sï¼Œæ˜“äº§ç”Ÿæ°´é”¤æ•ˆåº”`
        }
      };
    }
    
    return { valid: true, velocity: velocity };
  }
}
```

---

## 11. æ°´å‹è®¡ç®—éªŒè¯

### 11.1 æ°´å‹è®¡ç®—å…¬å¼

**ä¼¯åŠªåˆ©æ–¹ç¨‹**ï¼š
```
P2 = P1 - Ïgh - Î”P_friction - Î”P_local
```

å…¶ä¸­ï¼š
- P1: å…¥å£å‹åŠ›ï¼ˆPaï¼‰
- P2: å‡ºå£å‹åŠ›ï¼ˆPaï¼‰
- Ï: æ°´çš„å¯†åº¦ï¼ˆ1000 kg/mÂ³ï¼‰
- g: é‡åŠ›åŠ é€Ÿåº¦ï¼ˆ9.8 m/sÂ²ï¼‰
- h: é«˜åº¦å·®ï¼ˆmï¼‰
- Î”P_friction: æ²¿ç¨‹é˜»åŠ›æŸå¤±
- Î”P_local: å±€éƒ¨é˜»åŠ›æŸå¤±

### 11.2 æ°´å‹éªŒè¯å®ç°

```javascript
class WaterPressureValidator {
  constructor() {
    this.waterDensity = 1000;  // kg/mÂ³
    this.gravity = 9.8;        // m/sÂ²
    this.minPressure = 150000; // æœ€å°å‡ºå£å‹åŠ› 150kPa
  }
  
  validateWaterPressure(waterPath) {
    // 1. å…¥å£å‹åŠ›ï¼ˆå¸‚æ”¿ä¾›æ°´ï¼‰
    const inletPressure = 300000;  // 300kPa (0.3MPa)
    
    // 2. è®¡ç®—é«˜åº¦å·®æŸå¤±
    const elevationDiff = waterPath.end.z - waterPath.start.z;
    const elevationLoss = this.waterDensity * this.gravity * (elevationDiff / 1000);
    
    // 3. è®¡ç®—æ²¿ç¨‹é˜»åŠ›æŸå¤±
    const frictionLoss = this.calculateFrictionLoss(waterPath);
    
    // 4. è®¡ç®—å±€éƒ¨é˜»åŠ›æŸå¤±ï¼ˆå¼¯å¤´ã€ä¸‰é€šç­‰ï¼‰
    
const localLoss = this.calculateLocalLoss(waterPath);
    
    // 5. è®¡ç®—å‡ºå£å‹åŠ›
    const outletPressure = inletPressure - elevationLoss - frictionLoss - localLoss;
    
    // 6. éªŒè¯æ˜¯å¦æ»¡è¶³æœ€å°å‹åŠ›è¦æ±‚
    if (outletPressure < this.minPressure) {
      return {
        valid: false,
        error: {
          type: "INSUFFICIENT_PRESSURE",
          severity: "HIGH",
          inletPressure: inletPressure,
          outletPressure: outletPressure,
          minRequired: this.minPressure,
          deficit: this.minPressure - outletPressure,
          message: `å‡ºå£æ°´å‹${(outletPressure/1000).toFixed(1)}kPaä¸è¶³ï¼Œæœ€ä½éœ€è¦${(this.minPressure/1000).toFixed(1)}kPa`,
          suggestions: [
            "å‡å°‘ç®¡é“é•¿åº¦",
            "å¢å¤§ç®¡å¾„",
            "å‡å°‘å¼¯å¤´æ•°é‡",
            "å®‰è£…å¢å‹æ³µ"
          ]
        }
      };
    }
    
    return {
      valid: true,
      pressureAnalysis: {
        inlet: inletPressure,
        outlet: outletPressure,
        elevationLoss: elevationLoss,
        frictionLoss: frictionLoss,
        localLoss: localLoss,
        safetyMargin: outletPressure - this.minPressure
      }
    };
  }
  
  calculateFrictionLoss(waterPath) {
    // Darcy-Weisbachå…¬å¼ï¼šÎ”P = f * (L/D) * (ÏvÂ²/2)
    const length = waterPath.calculateLength() / 1000;  // è½¬ä¸ºç±³
    const diameter = waterPath.diameter / 1000;  // è½¬ä¸ºç±³
    const velocity = waterPath.calculateVelocity();
    const frictionFactor = 0.02;  // æ‘©æ“¦ç³»æ•°ï¼ˆPPRç®¡ï¼‰
    
    return frictionFactor * (length / diameter) * 
           (this.waterDensity * velocity * velocity / 2);
  }
  
  calculateLocalLoss(waterPath) {
    // å±€éƒ¨é˜»åŠ›ç³»æ•°
    const coefficients = {
      elbow90: 0.9,      // 90åº¦å¼¯å¤´
      elbow45: 0.4,      // 45åº¦å¼¯å¤´
      tee: 1.5,          // ä¸‰é€š
      valve: 0.5         // é˜€é—¨
    };
    
    let totalLoss = 0;
    const velocity = waterPath.calculateVelocity();
    
    for (const fitting of waterPath.fittings) {
      const coefficient = coefficients[fitting.type] || 0.5;
      totalLoss += coefficient * (this.waterDensity * velocity * velocity / 2);
    }
    
    return totalLoss;
  }
}
```

---

## 12. æ’æ°´å¡åº¦æ£€æŸ¥

### 12.1 æ’æ°´å¡åº¦è§„èŒƒ

**å›½æ ‡è¦æ±‚**ï¼ˆGB 50242-2002ï¼‰ï¼š

| ç®¡å¾„ | æœ€å°å¡åº¦ | æœ€å¤§å¡åº¦ | å¤‡æ³¨ |
|------|---------|---------|------|
| DN50 | 2.5% | 5% | æ´—æ‰‹ç›† |
| DN75 | 2% | 4% | å¨æˆ¿æ°´æ§½ |
| DN100 | 1.5% | 3.5% | é©¬æ¡¶ã€åœ°æ¼ |
| DN110 | 1.2% | 3% | ä¸»æ’æ°´ç®¡ |

### 12.2 å¡åº¦éªŒè¯å®ç°

```javascript
class DrainageSlopeValidator {
  validateSlope(drainagePath) {
    const diameter = drainagePath.diameter;  // mm
    const slopeRequirement = this.getSlopeRequirement(diameter);
    
    const segments = drainagePath.getSegments();
    const violations = [];
    
    for (const segment of segments) {
      // è®¡ç®—å®é™…å¡åº¦
      const horizontalLength = Math.sqrt(
        Math.pow(segment.end.x - segment.start.x, 2) +
        Math.pow(segment.end.y - segment.start.y, 2)
      );
      const verticalDrop = segment.start.z - segment.end.z;  // ä¸‹é™ä¸ºæ­£
      const actualSlope = (verticalDrop / horizontalLength) * 100;  // ç™¾åˆ†æ¯”
      
      // æ£€æŸ¥å¡åº¦æ˜¯å¦åœ¨è§„èŒƒèŒƒå›´å†…
      if (actualSlope < slopeRequirement.min) {
        violations.push({
          error: "INSUFFICIENT_SLOPE",
          severity: "HIGH",
          segment: segment,
          actualSlope: actualSlope,
          requiredSlope: slopeRequirement.min,
          message: `æ’æ°´ç®¡å¡åº¦${actualSlope.toFixed(2)}%å°äºæœ€å°è¦æ±‚${slopeRequirement.min}%`,
          consequence: "æ’æ°´ä¸ç•…ï¼Œæ˜“å µå¡"
        });
      }
      
      if (actualSlope > slopeRequirement.max) {
        violations.push({
          error: "EXCESSIVE_SLOPE",
          severity: "MEDIUM",
          actualSlope: actualSlope,
          requiredSlope: slopeRequirement.max,
          message: `æ’æ°´ç®¡å¡åº¦${actualSlope.toFixed(2)}%è¶…è¿‡æœ€å¤§é™åˆ¶${slopeRequirement.max}%`,
          consequence: "æ°´æµè¿‡å¿«ï¼Œå†²åˆ·ç®¡é“"
        });
      }
      
      // æ£€æŸ¥åå¡ï¼ˆä¸¥é‡é”™è¯¯ï¼‰
      if (verticalDrop < 0) {
        violations.push({
          error: "REVERSE_SLOPE",
          severity: "CRITICAL",
          segment: segment,
          message: "æ£€æµ‹åˆ°åå¡ï¼Œæ’æ°´å°†æ— æ³•æµåŠ¨",
          consequence: "æ°´æµå€’çŒï¼Œå¿…é¡»ä¿®æ­£"
        });
      }
    }
    
    return {
      valid: violations.length === 0,
      violations: violations
    };
  }
  
  getSlopeRequirement(diameter) {
    const requirements = {
      50: { min: 2.5, max: 5 },
      75: { min: 2.0, max: 4 },
      100: { min: 1.5, max: 3.5 },
      110: { min: 1.2, max: 3 }
    };
    
    return requirements[diameter] || { min: 1.5, max: 4 };
  }
}
```

### 12.3 å­˜æ°´å¼¯éªŒè¯

```javascript
function validatePTrap(drainagePath) {
  // æ£€æŸ¥æ˜¯å¦æœ‰å­˜æ°´å¼¯ï¼ˆPå‹å¼¯æˆ–Så‹å¼¯ï¼‰
  const hasTrap = drainagePath.fittings.some(f => 
    f.type === "p_trap" || f.type === "s_trap"
  );
  
  if (!hasTrap) {
    return {
      valid: false,
      error: {
        type: "MISSING_P_TRAP",
        severity: "CRITICAL",
        message: "æ’æ°´ç®¡ç¼ºå°‘å­˜æ°´å¼¯ï¼Œä¼šå¯¼è‡´è‡­æ°”å€’çŒ",
        standard: "GB 50242-2002 ç¬¬3.3.9æ¡",
        solution: "åœ¨åœ°æ¼æˆ–æ´å…·ä¸‹æ–¹å®‰è£…å­˜æ°´å¼¯"
      }
    };
  }
  
  // æ£€æŸ¥å­˜æ°´å¼¯æ°´å°é«˜åº¦
  const trap = drainagePath.fittings.find(f => 
    f.type === "p_trap" || f.type === "s_trap"
  );
  
  if (trap.sealHeight < 50) {
    return {
      valid: false,
      error: {
        type: "INSUFFICIENT_SEAL_HEIGHT",
        severity: "HIGH",
        actualHeight: trap.sealHeight,
        requiredHeight: 50,
        message: `å­˜æ°´å¼¯æ°´å°é«˜åº¦${trap.sealHeight}mmä¸è¶³ï¼Œæœ€å°éœ€è¦50mm`
      }
    };
  }
  
  return { valid: true };
}
```

---

## 13. æŸœä½“ç¢°æ’æ£€æµ‹

### 13.1 æŸœä½“ä½œä¸ºéšœç¢ç‰©çš„æ£€æµ‹

**æ£€æµ‹ç­–ç•¥**ï¼š
```javascript
class CabinetObstacleDetector {
  constructor(cabinets) {
    this.cabinets = cabinets;
    this.safetyDistance = {
      electrical: 50,   // ç”µçº¿è·æŸœä½“50mm
      water: 30,        // æ°´ç®¡è·æŸœä½“30mm
      drainage: 20      // æ’æ°´ç®¡è·æŸœä½“20mm
    };
  }
  
  detectCabinetCollision(path, pathType) {
    const collisions = [];
    const requiredDistance = this.safetyDistance[pathType];
    
    for (const cabinet of this.cabinets) {
      // è·å–æŸœä½“æ‰©å±•åŒ…å›´ç›’
      const cabinetBox = this.getExpandedBoundingBox(
        cabinet,
        requiredDistance
      );
      
      // æ£€æŸ¥è·¯å¾„æ˜¯å¦è¿›å…¥å®‰å…¨åŒº
      const violation = this.checkPathVsBox(path, cabinetBox);
      
      if (violation) {
        collisions.push({
          type: "CABINET_SAFETY_VIOLATION",
          severity: "HIGH",
          cabinet: cabinet,
          pathType: pathType,
          minDistance: violation.minDistance,
          requiredDistance: requiredDistance,
          deficit: requiredDistance - violation.minDistance,
          message: `${pathType}ç®¡çº¿è·ç¦»æŸœä½“"${cabinet.name}"ä»…${violation.minDistance}mmï¼Œä¸è¶³å®‰å…¨è·ç¦»${requiredDistance}mm`
        });
      }
    }
    
    return {
      valid: collisions.length === 0,
      collisions: collisions
    };
  }
  
  getExpandedBoundingBox(cabinet, margin) {
    const box = cabinet.getBoundingBox();
    return {
      min: {
        x: box.min.x - margin,
        y: box.min.y - margin,
        z: box.min.z - margin
      },
      max: {
        x: box.max.x + margin,
        y: box.max.y + margin,
        z: box.max.z + margin
      }
    };
  }
  
  checkPathVsBox(path, box) {
    let minDistance = Infinity;
    let closestPoint = null;
    
    for (const segment of path.getSegments()) {
      const distance = this.segmentToBoxDistance(segment, box);
      if (distance < minDistance) {
        minDistance = distance;
        closestPoint = segment.getMidPoint();
      }
    }
    
    if (minDistance < 1) {  // è¿›å…¥äº†æ‰©å±•åŒ…å›´ç›’
      return {
        minDistance: minDistance,
        closestPoint: closestPoint
      };
    }
    
    return null;
  }
}
```

### 13.2 æŸœä½“å†…éƒ¨å¸ƒçº¿ç¦æ­¢

**éªŒè¯è§„åˆ™**ï¼š
```javascript
function validateNoCabinetInterior(path, cabinets) {
  const violations = [];
  
  for (const cabinet of cabinets) {
    const cabinetBox = cabinet.getBoundingBox();
    
    // æ£€æŸ¥è·¯å¾„æ˜¯å¦ç©¿è¿‡æŸœä½“å†…éƒ¨
    for (const segment of path.getSegments()) {
      if (this.segmentInsideBox(segment, cabinetBox)) {
        violations.push({
          error: "PATH_INSIDE_CABINET",
          severity: "CRITICAL",
          cabinet: cabinet,
          segment: segment,
          message: `ç®¡çº¿ç©¿è¿‡æŸœä½“"${cabinet.name}"å†…éƒ¨ï¼Œä¸¥ç¦æ­¤ç±»å¸ƒçº¿`,
          solution: "è°ƒæ•´è·¯å¾„ï¼Œç»•è¿‡æŸœä½“"
        });
      }
    }
  }
  
  return {
    valid: violations.length === 0,
    violations: violations
  };
}

function segmentInsideBox(segment, box) {
  // æ£€æŸ¥çº¿æ®µä¸­ç‚¹æ˜¯å¦åœ¨ç›’å†…
  const mid = segment.getMidPoint();
  
  return (
    mid.x > box.min.x && mid.x < box.max.x &&
    mid.y > box.min.y && mid.y < box.max.y &&
    mid.z > box.min.z && mid.z < box.max.z
  );
}
```

---

## 14. å®‰å…¨è·ç¦»éªŒè¯

### 14.1 å¤šç³»ç»Ÿé—´è·è§„èŒƒ

**å›½å®¶æ ‡å‡†è·ç¦»è¦æ±‚**ï¼š

| ç³»ç»ŸA | ç³»ç»ŸB | æœ€å°é—´è· | æ ‡å‡†ä¾æ® |
|-------|-------|---------|---------|
| å¼ºç”µ | å¼±ç”µ | 300mm | GB 50303-2015 |
| å¼ºç”µ | ç»™æ°´ç®¡ | 100mm | GB 50242-2002 |
| å¼ºç”µ | ç‡ƒæ°”ç®¡ | 500mm | GB 50028-2006 |
| ç»™æ°´ç®¡ | æ’æ°´ç®¡ | 150mm | GB 50242-2002 |
| çƒ­æ°´ç®¡ | å†·æ°´ç®¡ | 50mm | æ–½å·¥è§„èŒƒ |
| ä»»ä½•ç®¡çº¿ | æŸœä½“ | 30-50mm | è®¾è®¡è§„èŒƒ |

### 14.2 
å®‰å…¨è·ç¦»éªŒè¯å®ç°

```javascript
class SafetyDistanceValidator {
  constructor() {
    // å®‰å…¨è·ç¦»çŸ©é˜µï¼ˆmmï¼‰
    this.distanceMatrix = {
      "electrical_weak": 300,
      "electrical_water": 100,
      "electrical_gas": 500,
      "water_drainage": 150,
      "hot_cold": 50,
      "any_cabinet": 30
    };
  }
  
  validateAllDistances(project) {
    const violations = [];
    
    // è·å–æ‰€æœ‰ç³»ç»Ÿ
    const electrical = project.getElectricalPaths();
    const weak = project.getWeakCurrentPaths();
    const water = project.getWaterPaths();
    const drainage = project.getDrainagePaths();
    const cabinets = project.getCabinets();
    
    // æ£€æŸ¥å¼ºå¼±ç”µé—´è·
    violations.push(...this.checkDistanceBetween(
      electrical, weak, "electrical_weak", "å¼ºç”µ", "å¼±ç”µ"
    ));
    
    // æ£€æŸ¥ç”µæ°´é—´è·
    violations.push(...this.checkDistanceBetween(
      electrical, water, "electrical_water", "å¼ºç”µ", "ç»™æ°´ç®¡"
    ));
    
    // æ£€æŸ¥ç»™æ’æ°´é—´è·
    violations.push(...this.checkDistanceBetween(
      water, drainage, "water_drainage", "ç»™æ°´ç®¡", "æ’æ°´ç®¡"
    ));
    
    // æ£€æŸ¥æ‰€æœ‰ç®¡çº¿ä¸æŸœä½“é—´è·
    const allPaths = [...electrical, ...weak, ...water, ...drainage];
    violations.push(...this.checkPathCabinetDistance(allPaths, cabinets));
    
    return {
      valid: violations.length === 0,
      violations: violations,
      summary: this.generateDistanceSummary(violations)
    };
  }
  
  checkDistanceBetween(paths1, paths2, key, name1, name2) {
    const violations = [];
    const requiredDistance = this.distanceMatrix[key];
    
    for (const path1 of paths1) {
      for (const path2 of paths2) {
        const minDist = this.calculateMinDistance(path1, path2);
        
        if (minDist < requiredDistance) {
          violations.push({
            error: "INSUFFICIENT_DISTANCE",
            severity: this.getSeverity(requiredDistance - minDist),
            system1: name1,
            system2: name2,
            path1: path1.id,
            path2: path2.id,
            actualDistance: minDist,
            requiredDistance: requiredDistance,
            deficit: requiredDistance - minDist,
            message: `${name1}ä¸${name2}é—´è·${minDist}mmä¸è¶³ï¼Œéœ€è¦${requiredDistance}mm`
          });
        }
      }
    }
    
    return violations;
  }
  
  getSeverity(deficit) {
    if (deficit > 200) return "CRITICAL";
    if (deficit > 100) return "HIGH";
    if (deficit > 50) return "MEDIUM";
    return "LOW";
  }
}
```

---

## 15. ç©¿å¢™ç‚¹æ£€æŸ¥

### 15.1 ç©¿å¢™ç‚¹ä½ç½®éªŒè¯

**éªŒè¯è§„åˆ™**ï¼š
- âŒ ä¸èƒ½ç©¿æ‰¿é‡å¢™
- âœ… ç©¿å¢™ç‚¹åº”é«˜äºåœ°é¢300mm
- âœ… ç©¿å¢™ç‚¹åº”å‚ç›´äºå¢™é¢
- âœ… åŒä¸€å¢™é¢ç©¿å¢™ç‚¹é—´è·â‰¥500mm

```javascript
class WallCrossingValidator {
  validateWallCrossing(path, walls) {
    const crossings = this.findWallCrossings(path, walls);
    const violations = [];
    
    for (const crossing of crossings) {
      const wall = crossing.wall;
      
      // 1. æ£€æŸ¥æ˜¯å¦æ‰¿é‡å¢™
      if (wall.isLoadBearing) {
        violations.push({
          error: "LOAD_BEARING_WALL_PENETRATION",
          severity: "CRITICAL",
          wall: wall,
          position: crossing.point,
          message: "ç¦æ­¢åœ¨æ‰¿é‡å¢™ä¸Šå¼€å­”å¸ƒçº¿",
          standard: "å»ºç­‘ç»“æ„å®‰å…¨è§„èŒƒ",
          solution: "æ”¹èµ°éæ‰¿é‡å¢™æˆ–åŠé¡¶/åœ°é¢"
        });
      }
      
      // 2. æ£€æŸ¥ç©¿å¢™é«˜åº¦
      if (crossing.point.z < 300) {
        violations.push({
          error: "WALL_CROSSING_TOO_LOW",
          severity: "MEDIUM",
          position: crossing.point,
          height: crossing.point.z,
          message: `ç©¿å¢™ç‚¹é«˜åº¦${crossing.point.z}mmè¿‡ä½ï¼Œå»ºè®®â‰¥300mm`
        });
      }
      
      // 3. æ£€æŸ¥ç©¿å¢™è§’åº¦
      const angle = this.calculateCrossingAngle(path, wall, crossing.point);
      if (Math.abs(angle - 90) > 15) {
        violations.push({
          error: "NON_PERPENDICULAR_CROSSING",
          severity: "LOW",
          angle: angle,
          message: `ç©¿å¢™è§’åº¦${angle}Â°ä¸å‚ç›´ï¼Œå»ºè®®å‚ç›´ç©¿å¢™ï¼ˆ90Â°ï¼‰`
        });
      }
      
      // 4. æ£€æŸ¥ç©¿å¢™ç‚¹å¯†åº¦
      const nearbyCount = this.countNearbyCrossings(crossing, crossings, 500);
      if (nearbyCount > 3) {
        violations.push({
          error: "TOO_MANY_CROSSINGS",
          severity: "LOW",
          count: nearbyCount,
          message: `500mmèŒƒå›´å†…æœ‰${nearbyCount}ä¸ªç©¿å¢™ç‚¹ï¼Œè¿‡äºå¯†é›†`
        });
      }
    }
    
    return {
      valid: violations.length === 0,
      violations: violations
    };
  }
}
```

### 15.2 ç©¿å¢™å¥—ç®¡éªŒè¯

```javascript
function validateWallSleeve(crossing) {
  const pipeOuterDiameter = crossing.pipe.outerDiameter;
  const sleeveInnerDiameter = crossing.sleeve ? crossing.sleeve.innerDiameter : 0;
  
  // å¥—ç®¡å†…å¾„åº”å¤§äºç®¡é“å¤–å¾„20mmä»¥ä¸Š
  const requiredSleeveDiameter = pipeOuterDiameter + 20;
  
  if (!crossing.sleeve) {
    return {
      valid: false,
      error: {
        type: "MISSING_WALL_SLEEVE",
        severity: "HIGH",
        message: "ç©¿å¢™å¤„ç¼ºå°‘ä¿æŠ¤å¥—ç®¡",
        requiredDiameter: requiredSleeveDiameter,
        solution: "å®‰è£…é’¢åˆ¶æˆ–PVCå¥—ç®¡"
      }
    };
  }
  
  if (sleeveInnerDiameter < requiredSleeveDiameter) {
    return {
      valid: false,
      error: {
        type: "SLEEVE_TOO_SMALL",
        severity: "MEDIUM",
        actualDiameter: sleeveInnerDiameter,
        requiredDiameter: requiredSleeveDiameter,
        message: `å¥—ç®¡å†…å¾„${sleeveInnerDiameter}mmè¿‡å°ï¼Œéœ€è¦${requiredSleeveDiameter}mm`
      }
    };
  }
  
  return { valid: true };
}
```

---

## 16. å›½å®¶æ ‡å‡†æ£€æŸ¥

### 16.1 ç”µæ°”æ ‡å‡†æ£€æŸ¥æ¸…å•

**GB 50303-2015ã€Šå»ºç­‘ç”µæ°”å·¥ç¨‹æ–½å·¥è´¨é‡éªŒæ”¶è§„èŒƒã€‹**ï¼š

```javascript
class ElectricalStandardsChecker {
  checkStandards(electricalSystem) {
    const checks = [];
    
    // 1. çº¿ç¼†é€‰æ‹©ï¼ˆ12.2.2æ¡ï¼‰
    checks.push(this.check_12_2_2_CableSelection(electricalSystem));
    
    // 2. çº¿è·¯æ•·è®¾ï¼ˆ12.2.3æ¡ï¼‰
    checks.push(this.check_12_2_3_CableInstallation(electricalSystem));
    
    // 3. å¯¼ç®¡é€‰æ‹©ï¼ˆ13.1.1æ¡ï¼‰
    checks.push(this.check_13_1_1_ConduitSelection(electricalSystem));
    
    // 4. æ¥åœ°ä¿æŠ¤ï¼ˆ17.1.1æ¡ï¼‰
    checks.push(this.check_17_1_1_GroundingProtection(electricalSystem));
    
    // 5. å¼€å…³æ’åº§ï¼ˆ22.1.1æ¡ï¼‰
    checks.push(this.check_22_1_1_SwitchSocket(electricalSystem));
    
    return {
      totalChecks: checks.length,
      passed: checks.filter(c => c.passed).length,
      failed: checks.filter(c => !c.passed).length,
      details: checks
    };
  }
  
  check_12_2_2_CableSelection(system) {
    // çº¿ç¼†è½½æµé‡åº”â‰¥è®¡ç®—ç”µæµçš„1.25å€
    const violations = [];
    
    for (const circuit of system.circuits) {
      const calculatedCurrent = circuit.calculateCurrent();
      const cableCurrent = this.getCableCurrent(circuit.cableSpec);
      
      if (cableCurrent < calculatedCurrent * 1.25) {
        violations.push({
          circuit: circuit.name,
          calculatedCurrent: calculatedCurrent,
          cableCurrent: cableCurrent,
          required: calculatedCurrent * 1.25,
          message: `çº¿ç¼†è½½æµé‡ä¸è¶³ï¼Œéœ€è¦${(calculatedCurrent * 1.25).toFixed(1)}A`
        });
      }
    }
    
    return {
      standard: "GB 50303-2015 ç¬¬12.2.2æ¡",
      name: "çº¿ç¼†é€‰æ‹©",
      passed: violations.length === 0,
      violations: violations
    };
  }
  
  check_12_2_3_CableInstallation(system) {
    // åŒä¸€ç®¡å†…å¯¼çº¿ä¸è¶…è¿‡8æ ¹
    const violations = [];
    
    for (const conduit of system.conduits) {
      if (conduit.cables.length > 8) {
        violations.push({
          conduit: conduit.id,
          cableCount: conduit.cables.length,
          message: `å¯¼ç®¡å†…å¯¼çº¿${conduit.cables.length}æ ¹è¶…è¿‡æœ€å¤§å€¼8æ ¹`
        });
      }
      
      // å¯¼ç®¡å¡«å……ç‡ä¸è¶…è¿‡40%
      const fillRatio = this.calculateConduitFillRatio(conduit);
      if (fillRatio > 0.4) {
        violations.push({
          conduit: conduit.id,
          fillRatio: fillRatio,
          message: `å¯¼ç®¡å¡«å……ç‡${(fillRatio * 100).toFixed(1)}%è¶…è¿‡40%`
        });
      }
    }
    
    return {
      standard: "GB 50303-2015 ç¬¬12.2.3æ¡",
      name: "çº¿è·¯æ•·è®¾",
      passed: violations.length === 0,
      violations: violations
    };
  }
}
```

### 16.2 ç»™æ’æ°´æ ‡å‡†æ£€æŸ¥æ¸…å•

**GB 50242-2002ã€Šå»ºç­‘ç»™æ°´æ’æ°´åŠé‡‡æš–å·¥ç¨‹æ–½å·¥è´¨é‡éªŒæ”¶è§„èŒƒã€‹**ï¼š

```javascript
class PlumbingStandardsChecker {
  checkStandards(plumbingSystem) {
    const checks = [];
    
    // 1. ç®¡æç®¡ä»¶ï¼ˆ3.3.2æ¡ï¼‰
    checks.push(this.check_3_3_2_PipeMaterial(plumbingSystem));
    
    // 2. ç®¡é“å¡åº¦ï¼ˆ3.3.10æ¡ï¼‰
    checks.push(this.check_3_3_10_PipeSlope(plumbingSystem));
    
    // 3. å­˜æ°´å¼¯è®¾ç½®ï¼ˆ3.3.9æ¡ï¼‰
    checks.push(this.check_3_3_9_PTrap(plumbingSystem));
    
    // 4. è¯•å‹è¦æ±‚ï¼ˆ3.3.14æ¡ï¼‰
    checks.push(this.check_3_3_14_PressureTest(plumbingSystem));
    
    return {
      totalChecks: checks.length,
      passed: checks.filter(c => c.passed).length,
      failed: checks.filter(c => !c.passed).length,
      details: checks
    };
  }
  
  check_3_3_10_PipeSlope(system) {
    const violations = [];
    
    for (const pipe of system.drainagePipes) {
      const slope = pipe.calculateSlope();
      const required = this.getRequiredSlope(pipe.diameter);
      
      if (slope < required.min || slope > required.max) {
        violations.push({
          pipe: pipe.id,
          diameter: pipe.diameter,
          actualSlope: slope,
          requiredRange: `${required.min}%-${required.max}%`,
          message: `DN${pipe.diameter}æ’æ°´ç®¡å¡åº¦${slope.toFixed(2)}%ä¸ç¬¦åˆè§„èŒƒ`
        });
      }
    }
    
    return {
      standard: "GB 50242-2002 ç¬¬3.3.10æ¡",
      name: "ç®¡é“å¡åº¦",
      passed: violations.length === 0,
      violations: violations
    };
  }
}
```

---

## 17. å¸ƒçº¿è§„èŒƒéªŒè¯

### 17.1 æ¨ªå¹³ç«–ç›´è§„èŒƒ

**è§„èŒƒè¦æ±‚**ï¼š
- âœ… ç”µçº¿èµ°å‘ï¼šæ¨ªå¹³ç«–ç›´ï¼ˆ0Â°ã€90Â°ã€180Â°ã€270Â°ï¼‰
- âœ… æ°´ç®¡èµ°å‘ï¼šæ­£äº¤å¸ƒçº¿
- âš ï¸ ç‰¹æ®Šæƒ…å†µï¼šè½¬è§’æŸœå¯æ–œçº¿ï¼ˆ45Â°ã€135Â°ï¼‰

```javascript
function validateOrthogonalRouting(path, 
allowDiagonal = false) {
  const ALLOWED_ANGLES = allowDiagonal 
    ? [0, 45, 90, 135, 180, 225, 270, 315]  // å…è®¸æ–œçº¿
    : [0, 90, 180, 270];  // ä»…æ¨ªå¹³ç«–ç›´
  
  const ANGLE_TOLERANCE = 5;  // 5åº¦å®¹å·®
  const violations = [];
  
  const segments = path.getSegments();
  for (let i = 0; i < segments.length; i++) {
    const segment = segments[i];
    const angle = this.calculateSegmentAngle(segment);
    
    const isValidAngle = ALLOWED_ANGLES.some(allowed => 
      Math.abs(angle - allowed) <= ANGLE_TOLERANCE
    );
    
    if (!isValidAngle) {
      violations.push({
        error: "NON_ORTHOGONAL_ROUTING",
        severity: "MEDIUM",
        segment: i,
        angle: angle,
        message: `çº¿æ®µ${i}è§’åº¦${angle}Â°ä¸ç¬¦åˆæ¨ªå¹³ç«–ç›´è§„èŒƒ`,
        suggestion: `è°ƒæ•´ä¸ºæœ€è¿‘çš„æ ‡å‡†è§’åº¦ï¼š${this.getNearestAngle(angle, ALLOWED_ANGLES)}Â°`
      });
    }
  }
  
  return {
    valid: violations.length === 0,
    violations: violations
  };
}
```

### 17.2 å¼€æ§½æ·±åº¦éªŒè¯

```javascript
function validateSlotDepth(path, wallThickness) {
  const violations = [];
  
  // å¼€æ§½æ·±åº¦ä¸åº”è¶…è¿‡å¢™åšçš„1/3
  const maxSlotDepth = wallThickness / 3;
  
  for (const segment of path.getSegments()) {
    const requiredDepth = segment.calculateRequiredSlotDepth();
    
    if (requiredDepth > maxSlotDepth) {
      violations.push({
        error: "SLOT_TOO_DEEP",
        severity: "CRITICAL",
        wallThickness: wallThickness,
        requiredDepth: requiredDepth,
        maxAllowed: maxSlotDepth,
        message: `å¼€æ§½æ·±åº¦${requiredDepth}mmè¶…è¿‡å¢™åš${wallThickness}mmçš„1/3`,
        solution: "æ”¹èµ°åŠé¡¶æˆ–åœ°é¢ï¼Œä¸èƒ½ç ´åå¢™ä½“ç»“æ„"
      });
    }
  }
  
  return {
    valid: violations.length === 0,
    violations: violations
  };
}
```

---

## 18. æ–½å·¥å¯è¡Œæ€§æ£€æŸ¥

### 18.1 æ–½å·¥éš¾åº¦è¯„ä¼°

```javascript
class ConstructionFeasibilityChecker {
  assessDifficulty(path) {
    let difficultyScore = 0;
    const factors = [];
    
    // 1. è½¬è§’æ•°é‡ï¼ˆæ¯ä¸ªè½¬è§’+10åˆ†ï¼‰
    const turnCount = path.getTurnCount();
    difficultyScore += turnCount * 10;
    factors.push({ name: "è½¬è§’æ•°é‡", count: turnCount, score: turnCount * 10 });
    
    // 2. ç©¿å¢™æ•°é‡ï¼ˆæ¯ä¸ªç©¿å¢™+20åˆ†ï¼‰
    const wallCrossings = path.getWallCrossings().length;
    difficultyScore += wallCrossings * 20;
    factors.push({ name: "ç©¿å¢™æ•°é‡", count: wallCrossings, score: wallCrossings * 20 });
    
    // 3. æŸœä½“é¿è®©ï¼ˆæ¯æ¬¡é¿è®©+15åˆ†ï¼‰
    const cabinetAvoidances = path.getCabinetAvoidances().length;
    difficultyScore += cabinetAvoidances * 15;
    factors.push({ name: "æŸœä½“é¿è®©", count: cabinetAvoidances, score: cabinetAvoidances * 15 });
    
    // 4. é«˜åº¦å˜åŒ–ï¼ˆæ¯æ¬¡å˜åŒ–+5åˆ†ï¼‰
    const elevationChanges = path.getElevationChanges().length;
    difficultyScore += elevationChanges * 5;
    factors.push({ name: "é«˜åº¦å˜åŒ–", count: elevationChanges, score: elevationChanges * 5 });
    
    // 5. è·¯å¾„é•¿åº¦ï¼ˆæ¯ç±³+2åˆ†ï¼‰
    const length = path.calculateLength() / 1000;
    difficultyScore += Math.floor(length * 2);
    factors.push({ name: "è·¯å¾„é•¿åº¦", value: length + "m", score: Math.floor(length * 2) });
    
    // éš¾åº¦ç­‰çº§åˆ¤å®š
    let level, description, estimatedTime, estimatedCost;
    if (difficultyScore < 30) {
      level = "EASY";
      description = "ç®€å•";
      estimatedTime = "0.5-1å°æ—¶";
      estimatedCost = 100;
    } else if (difficultyScore < 60) {
      level = "MEDIUM";
      description = "ä¸­ç­‰";
      estimatedTime = "1-2å°æ—¶";
      estimatedCost = 200;
    } else if (difficultyScore < 100) {
      level = "HARD";
      description = "å›°éš¾";
      estimatedTime = "2-4å°æ—¶";
      estimatedCost = 400;
    } else {
      level = "VERY_HARD";
      description = "æå›°éš¾";
      estimatedTime = "4å°æ—¶ä»¥ä¸Š";
      estimatedCost = 600;
    }
    
    return {
      difficultyScore: difficultyScore,
      level: level,
      description: description,
      estimatedTime: estimatedTime,
      estimatedCost: estimatedCost,
      factors: factors,
      recommendation: this.getRecommendation(difficultyScore)
    };
  }
  
  getRecommendation(score) {
    if (score > 80) {
      return "å»ºè®®é‡æ–°è§„åˆ’è·¯å¾„ï¼Œé™ä½æ–½å·¥éš¾åº¦å’Œæˆæœ¬";
    } else if (score > 50) {
      return "æ–½å·¥éš¾åº¦è¾ƒå¤§ï¼Œå»ºè®®ä¼˜åŒ–éƒ¨åˆ†è·¯å¾„";
    } else {
      return "æ–½å·¥éš¾åº¦å¯æ¥å—";
    }
  }
}
```

### 18.2 ææ–™å¯è¾¾æ€§æ£€æŸ¥

```javascript
function checkMaterialAccessibility(path) {
  const inaccessible = [];
  
  // æ£€æŸ¥æ˜¯å¦æœ‰éš¾ä»¥æ–½å·¥çš„ä½ç½®
  for (const segment of path.getSegments()) {
    // åŠé¡¶å†…éƒ¨è·¯å¾„
    if (segment.location === "ceiling" && segment.height < 400) {
      inaccessible.push({
        type: "LOW_CEILING",
        segment: segment,
        height: segment.height,
        message: `åŠé¡¶é«˜åº¦${segment.height}mmè¿‡ä½ï¼Œæ–½å·¥å›°éš¾`,
        solution: "è€ƒè™‘èµ°åœ°é¢æˆ–å¢™é¢"
      });
    }
    
    // ç‹­çª„ç©ºé—´
    if (segment.clearance < 200) {
      inaccessible.push({
        type: "NARROW_SPACE",
        segment: segment,
        clearance: segment.clearance,
        message: `æ–½å·¥ç©ºé—´ä»…${segment.clearance}mmï¼Œæ“ä½œå›°éš¾`
      });
    }
  }
  
  return {
    accessible: inaccessible.length === 0,
    issues: inaccessible
  };
}
```

---

## 19. æ¡ˆä¾‹1ï¼šå¨æˆ¿æ°´ç”µè‡ªæ£€

### 19.1 åœºæ™¯æè¿°

**å¨æˆ¿å¸ƒå±€**ï¼š
- é¢ç§¯ï¼š8mÂ²ï¼ˆ3m Ã— 2.7mï¼‰
- æŸœä½“ï¼šåœ°æŸœ3ç±³ï¼ŒåŠæŸœ3ç±³
- ç”µå™¨ï¼šå†°ç®±ã€çƒ¤ç®±ã€æ´—ç¢—æœºã€æ²¹çƒŸæœº
- æ°´ç‚¹ï¼šæ°´æ§½ï¼ˆå†·çƒ­æ°´ï¼‰ã€å‡€æ°´å™¨

### 19.2 è‡ªæ£€æ‰§è¡Œ

```javascript
const kitchenValidation = {
  room: "å¨æˆ¿",
  area: 8,
  
  // 1. ç”µè·¯è‡ªæ£€
  electricalCheck: function() {
    const circuits = [
      { name: "ç…§æ˜", power: 200, cable: "1.5mmÂ²", breaker: "10A" },
      { name: "æ™®é€šæ’åº§", power: 2200, cable: "2.5mmÂ²", breaker: "16A" },
      { name: "å†°ç®±ä¸“çº¿", power: 150, cable: "2.5mmÂ²", breaker: "16A" },
      { name: "çƒ¤ç®±ä¸“çº¿", power: 3000, cable: "4mmÂ²", breaker: "20A" },
      { name: "æ´—ç¢—æœºä¸“çº¿", power: 2000, cable: "4mmÂ²", breaker: "20A" },
      { name: "æ²¹çƒŸæœº", power: 200, cable: "2.5mmÂ²", breaker: "16A" }
    ];
    
    const results = [];
    for (const circuit of circuits) {
      const current = circuit.power / 220;
      const cableRating = getCableRating(circuit.cable);
      const loadRatio = current / cableRating;
      
      results.push({
        circuit: circuit.name,
        power: circuit.power + "W",
        current: current.toFixed(1) + "A",
        cable: circuit.cable,
        breaker: circuit.breaker,
        loadRatio: (loadRatio * 100).toFixed(1) + "%",
        status: loadRatio < 0.8 ? "âœ… é€šè¿‡" : "âŒ è¿‡è½½"
      });
    }
    
    return results;
  },
  
  // 2. æ°´è·¯è‡ªæ£€
  plumbingCheck: function() {
    const waterPaths = [
      { name: "å†·æ°´ä¸»ç®¡", from: "å…¥æˆ·", to: "æ°´æ§½", length: 5000, diameter: 20 },
      { name: "çƒ­æ°´ç®¡", from: "çƒ­æ°´å™¨", to: "æ°´æ§½", length: 8000, diameter: 20 },
      { name: "å‡€æ°´å™¨è¿›æ°´", from: "å†·æ°´ä¸»ç®¡", to: "å‡€æ°´å™¨", length: 2000, diameter: 15 },
      { name: "æ°´æ§½æ’æ°´", from: "æ°´æ§½", to: "ä¸»æ’æ°´ç®¡", length: 3000, diameter: 50, slope: 2.5 }
    ];
    
    const results = [];
    for (const path of waterPaths) {
      if (path.slope !== undefined) {
        // æ’æ°´ç®¡æ£€æŸ¥å¡åº¦
        const slopeCheck = path.slope >= 2.0 && path.slope <= 5.0;
        results.push({
          path: path.name,
          length: path.length + "mm",
          diameter: "DN" + path.diameter,
          slope: path.slope + "%",
          status: slopeCheck ? "âœ… å¡åº¦åˆæ ¼" : "âŒ å¡åº¦ä¸åˆæ ¼"
        });
      } else {
        // ç»™æ°´ç®¡æ£€æŸ¥å‹åŠ›
        results.push({
          path: path.name,
          length: path.length + "mm",
          diameter: "DN" + path.diameter,
          status: "âœ… é€šè¿‡"
        });
      }
    }
    
    return results;
  },
  
  // 3. æŸœä½“é¿è®©æ£€æŸ¥
  cabinetAvoidanceCheck: function() {
    const cabinets = [
      { name: "æ°´æ§½æŸœ", x: 0, width: 800 },
      { name: "ç¶å°æŸœ", x: 800, width: 800 },
      { name: "å†°ç®±æŸœ", x: 1600, width: 600 }
    ];
    
    const paths = this.electricalCheck().concat(this.plumbingCheck());
    const violations = [];
    
    // æ£€æŸ¥æ¯æ¡ç®¡çº¿æ˜¯å¦ç©¿è¿‡æŸœä½“
    for (const cabinet of cabinets) {
      for (const path of paths) {
        // ç®€åŒ–æ£€æŸ¥ï¼ˆå®é™…éœ€è¦3Dç¢°æ’æ£€æµ‹ï¼‰
        if (this.pathIntersectsCabinet(path, cabinet)) {
          violations.push({
            path: path.name || path.circuit,
            cabinet: cabinet.name,
            message: `âš ï¸ ${path.name || path.circuit}å¯èƒ½ç©¿è¿‡${cabinet.name}`
          });
        }
      }
    }
    
    return violations.length === 0 
      ? "âœ… æ‰€æœ‰ç®¡çº¿å‡æ­£ç¡®é¿è®©æŸœä½“" 
      : violations;
  }
};

// æ‰§è¡Œè‡ªæ£€
console.log("=== å¨æˆ¿æ°´ç”µè‡ªæ£€æŠ¥å‘Š ===");
console.log("1. ç”µè·¯æ£€æŸ¥ï¼š", kitchenValidation.electricalCheck());
console.log("2. æ°´è·¯æ£€æŸ¥ï¼š", kitchenValidation.plumbingCheck());
console.log("3. æŸœä½“é¿è®©ï¼š", kitchenValidation.cabinetAvoidanceCheck());
```

### 19.3 è‡ªæ£€æŠ¥å‘Š

```
=== å¨æˆ¿æ°´ç”µè‡ªæ£€æŠ¥å‘Š ===

ã€ç”µè·¯æ£€æŸ¥ã€‘
âœ… ç…§æ˜å›è·¯ï¼š200W / 10Aæ–­è·¯å™¨ / 1.5mmÂ² - è´Ÿè½½9.1% - é€šè¿‡
âœ… æ™®é€šæ’åº§ï¼š2200W / 16Aæ–­è·¯å™¨ / 2.5mmÂ² - è´Ÿè½½68.8% - é€šè¿‡
âœ… å†°ç®±ä¸“çº¿ï¼š150W / 16Aæ–­è·¯å™¨ / 2.5mmÂ² - è´Ÿè½½4.3% - é€šè¿‡
âœ… çƒ¤ç®±ä¸“çº¿ï¼š3000W / 20Aæ–­è·¯å™¨ / 4mmÂ² - è´Ÿè½½68.2% - é€šè¿‡
âœ… æ´—ç¢—æœºä¸“çº¿ï¼š2000W / 20Aæ–­è·¯å™¨ / 4mmÂ² - 
é€šè¿‡
âœ… æ²¹çƒŸæœºï¼š200W / 16Aæ–­è·¯å™¨ / 2.5mmÂ² - è´Ÿè½½5.7% - é€šè¿‡

ã€æ°´è·¯æ£€æŸ¥ã€‘
âœ… å†·æ°´ä¸»ç®¡ï¼š5m / DN20 - é€šè¿‡
âœ… çƒ­æ°´ç®¡ï¼š8m / DN20 - é€šè¿‡
âœ… å‡€æ°´å™¨è¿›æ°´ï¼š2m / DN15 - é€šè¿‡
âœ… æ°´æ§½æ’æ°´ï¼š3m / DN50 / å¡åº¦2.5% - é€šè¿‡

ã€æŸœä½“é¿è®©æ£€æŸ¥ã€‘
âœ… æ‰€æœ‰ç®¡çº¿å‡æ­£ç¡®é¿è®©æŸœä½“
âœ… å®‰å…¨è·ç¦»ï¼šç”µçº¿50mmï¼Œæ°´ç®¡30mm

ã€ç»¼åˆè¯„ä¼°ã€‘
âœ… ç”µè·¯ç³»ç»Ÿï¼š6ä¸ªå›è·¯å…¨éƒ¨é€šè¿‡
âœ… æ°´è·¯ç³»ç»Ÿï¼š4æ¡ç®¡çº¿å…¨éƒ¨é€šè¿‡
âœ… è§„èŒƒæ€§ï¼šç¬¦åˆå›½æ ‡è¦æ±‚
âœ… æ–½å·¥éš¾åº¦ï¼šä¸­ç­‰ï¼ˆé¢„è®¡æ–½å·¥æ—¶é—´4-6å°æ—¶ï¼‰
âœ… é¢„ä¼°æˆæœ¬ï¼šææ–™è´¹1800å…ƒ + äººå·¥è´¹800å…ƒ = 2600å…ƒ

ã€å»ºè®®ã€‘
- âœ… é…ç½®åˆç†ï¼Œå¯ä»¥å¼€å§‹æ–½å·¥
- âš ï¸ çƒ¤ç®±å’Œæ´—ç¢—æœºå»ºè®®é”™å³°ä½¿ç”¨ï¼Œé¿å…åŒæ—¶ä½¿ç”¨å¯¼è‡´è·³é—¸
```

---

## 20. æ¡ˆä¾‹2ï¼šå®¢å…ç”µè·¯éªŒè¯

### 20.1 åœºæ™¯æè¿°

**å®¢å…é…ç½®**ï¼š
- é¢ç§¯ï¼š25mÂ²
- ç…§æ˜ï¼šä¸»ç¯ + ç­’ç¯ + ç¯å¸¦
- ç”µå™¨ï¼šç”µè§†ã€ç©ºè°ƒã€éŸ³å“ç³»ç»Ÿ
- å¼±ç”µï¼šç½‘ç»œã€æœ‰çº¿ç”µè§†ã€éŸ³å“çº¿

### 20.2 å¼ºå¼±ç”µåˆ†ç¦»éªŒè¯

```javascript
const livingRoomCheck = {
  // å¼ºç”µå›è·¯
  strongCircuits: [
    { id: "LC1", type: "lighting", devices: ["ä¸»ç¯", "ç­’ç¯x6", "ç¯å¸¦"], power: 300 },
    { id: "LC2", type: "socket", devices: ["ç”µè§†æ’åº§", "éŸ³å“æ’åº§"], power: 500 },
    { id: "LC3", type: "aircon", devices: ["ç©ºè°ƒ3åŒ¹"], power: 2200 }
  ],
  
  // å¼±ç”µå›è·¯
  weakCircuits: [
    { id: "WC1", type: "network", devices: ["ç½‘ç»œé¢æ¿x2"], voltage: 24 },
    { id: "WC2", type: "cable_tv", devices: ["æœ‰çº¿ç”µè§†"], voltage: 12 },
    { id: "WC3", type: "audio", devices: ["éŸ³å“çº¿x4"], voltage: 5 }
  ],
  
  // æ‰§è¡ŒéªŒè¯
  validate: function() {
    const validator = new SafetyDistanceValidator();
    
    // 1. æ£€æŸ¥å¼ºå¼±ç”µé—´è·
    const separationCheck = validator.validateStrongWeakSeparation(
      this.strongCircuits,
      this.weakCircuits
    );
    
    // 2. æ£€æŸ¥è´Ÿè½½
    const loadCheck = this.strongCircuits.map(circuit => {
      const current = circuit.power / 220;
      return {
        circuit: circuit.id,
        devices: circuit.devices.join(", "),
        current: current.toFixed(1) + "A",
        status: current < 16 ? "âœ…" : "âŒ"
      };
    });
    
    // 3. æ£€æŸ¥ä¸ç”µè§†æŸœçš„é¿è®©
    const tvCabinet = { x: 0, width: 2000, depth: 450 };
    const avoidanceCheck = this.checkCabinetAvoidance(tvCabinet);
    
    return {
      separation: separationCheck,
      load: loadCheck,
      avoidance: avoidanceCheck,
      overall: separationCheck.valid && avoidanceCheck.valid ? "âœ… é€šè¿‡" : "âŒ æœ‰é—®é¢˜"
    };
  },
  
  checkCabinetAvoidance: function(cabinet) {
    // æ£€æŸ¥ç”µè§†æŸœåé¢çš„çº¿è·¯æ˜¯å¦é¢„ç•™è¶³å¤Ÿç©ºé—´
    const backClearance = 100;  // ç”µè§†æŸœåé¢„ç•™100mm
    
    if (backClearance >= 50) {
      return {
        valid: true,
        message: "âœ… ç”µè§†æŸœåé¢„ç•™ç©ºé—´å……è¶³"
      };
    } else {
      return {
        valid: false,
        message: "âŒ ç”µè§†æŸœåç©ºé—´ä¸è¶³ï¼Œç®¡çº¿å¯èƒ½è¢«æŒ¤å‹"
      };
    }
  }
};

// æ‰§è¡ŒéªŒè¯
const result = livingRoomCheck.validate();
console.log(result);
```

### 20.3 éªŒè¯ç»“æœ

```json
{
  "separation": {
    "valid": true,
    "violations": [],
    "message": "âœ… å¼ºå¼±ç”µé—´è·ç¬¦åˆ300mmè¦æ±‚"
  },
  "load": [
    { "circuit": "LC1", "devices": "ä¸»ç¯, ç­’ç¯x6, ç¯å¸¦", "current": "1.4A", "status": "âœ…" },
    { "circuit": "LC2", "devices": "ç”µè§†æ’åº§, éŸ³å“æ’åº§", "current": "2.3A", "status": "âœ…" },
    { "circuit": "LC3", "devices": "ç©ºè°ƒ3åŒ¹", "current": "10.0A", "status": "âœ…" }
  ],
  "avoidance": {
    "valid": true,
    "message": "âœ… ç”µè§†æŸœåé¢„ç•™ç©ºé—´å……è¶³"
  },
  "overall": "âœ… é€šè¿‡"
}
```

---

## 21. æ¡ˆä¾‹3ï¼šå«ç”Ÿé—´æ°´è·¯æ£€æŸ¥

### 21.1 åœºæ™¯æè¿°

**å«ç”Ÿé—´é…ç½®**ï¼š
- é¢ç§¯ï¼š5mÂ²
- æ´å…·ï¼šé©¬æ¡¶ã€æ·‹æµ´ã€æ´—æ‰‹ç›†
- æ’æ°´ï¼šä¸»æ’æ°´ç®¡DN110ã€åœ°æ¼DN50
- ç‰¹æ®Šè¦æ±‚ï¼šé˜²æ°´ã€æ’æ°´å¿«é€Ÿ

### 21.2 å®Œæ•´éªŒè¯æµç¨‹

```javascript
class BathroomWaterSystemValidator {
  constructor() {
    this.fixtures = {
      toilet: { water: "DN20", drainage: "DN110", flowRate: 6 },
      shower: { water: "DN15", drainage: "DN50", flowRate: 8 },
      basin: { water: "DN15", drainage: "DN40", flowRate: 5 },
      floorDrain: { drainage: "DN50", flowRate: 10 }
    };
  }
  
  validateBathroomSystem() {
    const report = {
      waterSupply: this.validateWaterSupply(),
      drainage: this.validateDrainage(),
      waterProofing: this.validateWaterProofing(),
      ventilation: this.validateVentilation()
    };
    
    report.overall = this.assessOverall(report);
    return report;
  }
  
  validateWaterSupply() {
    const checks = [];
    
    // 1. å†·æ°´ä¾›åº”
    const coldWater = {
      mainPipe: "DN20",
      branches: [
        { to: "é©¬æ¡¶", diameter: "DN15", length: 2000 },
        { to: "æ·‹æµ´", diameter: "DN15", length: 3000 },
        { to: "æ´—æ‰‹ç›†", diameter: "DN15", length: 1500 }
      ]
    };
    
    // è®¡ç®—æ€»æµé‡
    const totalFlow = 
      this.fixtures.toilet.flowRate +
      this.fixtures.shower.flowRate +
      this.fixtures.basin.flowRate;
    
    // DN20ç®¡é“æœ€å¤§æµé‡çº¦15 L/min
    if (totalFlow <= 15) {
      checks.push({
        item: "å†·æ°´ä¸»ç®¡",
        diameter: coldWater.mainPipe,
        totalFlow: totalFlow + " L/min",
        capacity: "15 L/min",
        status: "âœ… é€šè¿‡"
      });
    }
    
    // 2. çƒ­æ°´ä¾›åº”
    const hotWater = {
      from: "çƒ­æ°´å™¨",
      to: ["æ·‹æµ´", "æ´—æ‰‹ç›†"],
      diameter: "DN15",
      totalLength: 6000
    };
    
    // æ£€æŸ¥çƒ­æ°´ç®¡æ˜¯å¦ä¿æ¸©
    if (!hotWater.insulated) {
      checks.push({
        item: "çƒ­æ°´ç®¡ä¿æ¸©",
        status: "âš ï¸ å»ºè®®",
        message: "çƒ­æ°´ç®¡å»ºè®®åšä¿æ¸©å¤„ç†ï¼Œå‡å°‘çƒ­é‡æŸå¤±"
      });
    }
    
    return {
      valid: true,
      checks: checks
    };
  }
  
  validateDrainage() {
    const checks = [];
    
    // 1. ä¸»æ’æ°´ç®¡
    const mainDrain = {
      diameter: 110,
      length: 5000,
      slope: 2.0,
      fixtures: ["é©¬æ¡¶", "æ·‹æµ´", "æ´—æ‰‹ç›†", "åœ°æ¼"]
    };
    
    // æ£€æŸ¥ç®¡å¾„
    const totalDrainageLoad = 
      this.fixtures.toilet.flowRate +
      this.fixtures.shower.flowRate +
      this.fixtures.basin.flowRate +
      this.fixtures.floorDrain.flowRate;
    
    if (mainDrain.diameter >= 110 && totalDrainageLoad <= 30) {
      checks.push({
        item: "ä¸»æ’æ°´ç®¡",
        diameter: "DN" + mainDrain.diameter,
        load: totalDrainageLoad + " L/min",
        status: "âœ… é€šè¿‡"
      });
    }
    
    // 2. æ£€æŸ¥æ’æ°´å¡åº¦
    if (mainDrain.slope >= 1.2 && mainDrain.slope <= 3.0) {
      checks.push({
        item: "æ’æ°´å¡åº¦",
        slope: mainDrain.slope + "%",
        standard: "1.2%-3.0%",
        status: "âœ… é€šè¿‡"
      });
    } else {
      checks.push({
        item: "æ’æ°´å¡åº¦",
        slope: mainDrain.slope + "%",
        standard: "1.2%-3.0%",
        status: "âŒ ä¸åˆæ ¼"
      });
    }
    
    // 3. æ£€æŸ¥å­˜æ°´å¼¯
    const traps = [
      { fixture: "é©¬æ¡¶", hasTrap: true, sealHeight: 60 },
      { fixture: "æ·‹æµ´åœ°æ¼", hasTrap: true, sealHeight: 50 },
      { fixture: "æ´—æ‰‹ç›†", hasTrap: true, sealHeight: 50 },
      { fixture: "åœ°æ¼", hasTrap: true, sealHeight: 50 }
    ];
    
    for (const trap of traps) {
      if (!trap.hasTrap || trap.sealHeight < 50) {
        checks.push({
          item: trap.fixture + "å­˜æ°´å¼¯",
          status: "âŒ ä¸åˆæ ¼",
          message: trap.hasTrap ? `æ°´å°${trap.sealHeight}mmä¸è¶³` : "ç¼ºå°‘å­˜æ°´å¼¯"
        });
      } else {
        checks.push({
          item: trap.fixture + "å­˜æ°´å¼¯",
          sealHeight: trap.sealHeight + "mm",
          status: "âœ… é€šè¿‡"
        });
      }
    }
    
    return {
      valid: checks.every(c => c.status.includes("âœ…")),
      checks: checks
    };
  }
  
  validateWaterProofing() {
    return {
      valid: true,
      checks: [
        { item: "åœ°é¢é˜²æ°´é«˜åº¦", height: "300mm", standard: "â‰¥300mm", status: "âœ…" },
        { item: "æ·‹æµ´åŒºé˜²æ°´é«˜åº¦", height: "1800mm", standard: "â‰¥1800mm", status: "âœ…" },
        { item: "é˜²æ°´æ¶‚åˆ·å±‚æ•°", layers: 2, standard: "â‰¥2å±‚", status: "âœ…" }
      ]
    };
  }
  
  validateVentilation() {
    return {
      valid: true,
      checks: [
        { item: "æ’æ°”æ‰‡", power: "30W", airflow: "150mÂ³/h", status: "âœ…" },
        { item: "æ’æ°”ç®¡", diameter: "DN100", length: "2m", status: "âœ…" }
      ]
    
};
  }
  
  assessOverall(report) {
    const allValid = 
      report.waterSupply.valid &&
      report.drainage.valid &&
      report.waterProofing.valid &&
      report.ventilation.valid;
    
    return {
      valid: allValid,
      status: allValid ? "âœ… ç³»ç»Ÿåˆæ ¼" : "âŒ éœ€è¦æ•´æ”¹",
      score: this.calculateScore(report)
    };
  }
  
  calculateScore(report) {
    let score = 100;
    
    if (!report.waterSupply.valid) score -= 25;
    if (!report.drainage.valid) score -= 30;
    if (!report.waterProofing.valid) score -= 25;
    if (!report.ventilation.valid) score -= 20;
    
    return score;
  }
}

// æ‰§è¡ŒéªŒè¯
const validator = new BathroomWaterSystemValidator();
const report = validator.validateBathroomSystem();
console.log("å«ç”Ÿé—´æ°´è·¯ç³»ç»Ÿè¯„åˆ†ï¼š", report.overall.score + "/100");
```

---

## 22. é”™è¯¯ä»£ç ç´¢å¼•

### 22.1 ç”µè·¯é”™è¯¯ä»£ç 

| é”™è¯¯ä»£ç  | ä¸¥é‡ç¨‹åº¦ | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|---------|---------|------|---------|
| `E001` - CIRCUIT_OVERLOAD | CRITICAL | å›è·¯è¿‡è½½ | å¢å¤§çº¿å¾„æˆ–æ‹†åˆ†å›è·¯ |
| `E002` - BREAKER_TOO_SMALL | CRITICAL | æ–­è·¯å™¨å®¹é‡ä¸è¶³ | æ›´æ¢æ›´å¤§å®¹é‡æ–­è·¯å™¨ |
| `E003` - INSUFFICIENT_SEPARATION | HIGH | å¼ºå¼±ç”µé—´è·ä¸è¶³ | è°ƒæ•´è·¯å¾„ï¼Œä¿æŒ300mm |
| `E004` - VOLTAGE_MISMATCH | HIGH | ç”µå‹ä¸åŒ¹é… | æ£€æŸ¥è®¾å¤‡é¢å®šç”µå‹ |
| `E005` - PATH_TOO_LONG | MEDIUM | å›è·¯é•¿åº¦è¶…é™ | å¢åŠ é…ç”µç®±æˆ–è°ƒæ•´å¸ƒå±€ |
| `E006` - NON_ORTHOGONAL_ROUTING | MEDIUM | æœªæ¨ªå¹³ç«–ç›´ | è°ƒæ•´ä¸º90åº¦è½¬è§’ |
| `E007` - CABLE_TOO_THIN | HIGH | çº¿å¾„ä¸è¶³ | æ›´æ¢æ›´å¤§çº¿å¾„ |
| `E008` - MISSING_GROUND | CRITICAL | ç¼ºå°‘æ¥åœ° | æ·»åŠ æ¥åœ°çº¿ |
| `E009` - CABINET_COLLISION | HIGH | ç©¿è¿‡æŸœä½“ | è°ƒæ•´è·¯å¾„é¿è®© |
| `E010` - WALL_CROSSING_INVALID | CRITICAL | ç©¿æ‰¿é‡å¢™ | æ”¹èµ°å…¶ä»–è·¯å¾„ |

### 22.2 æ°´è·¯é”™è¯¯ä»£ç 

| é”™è¯¯ä»£ç  | ä¸¥é‡ç¨‹åº¦ | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|---------|---------|------|---------|
| `W001` - INSUFFICIENT_PRESSURE | HIGH | æ°´å‹ä¸è¶³ | å¢å¤§ç®¡å¾„æˆ–å®‰è£…å¢å‹æ³µ |
| `W002` - PIPE_DIAMETER_WRONG | MEDIUM | ç®¡å¾„é€‰æ‹©ä¸å½“ | é‡æ–°è®¡ç®—æµé‡é€‰æ‹©ç®¡å¾„ |
| `W003` - INSUFFICIENT_SLOPE | HIGH | æ’æ°´å¡åº¦ä¸è¶³ | è°ƒæ•´å¡åº¦â‰¥æœ€å°è¦æ±‚ |
| `W004` - REVERSE_SLOPE | CRITICAL | åå¡ | å¿…é¡»è°ƒæ•´ï¼Œç¡®ä¿ä¸‹å¡ |
| `W005` - MISSING_P_TRAP | CRITICAL | ç¼ºå°‘å­˜æ°´å¼¯ | å®‰è£…På‹æˆ–Så‹å­˜æ°´å¼¯ |
| `W006` - SEAL_HEIGHT_LOW | HIGH | æ°´å°é«˜åº¦ä¸è¶³ | ç¡®ä¿æ°´å°â‰¥50mm |
| `W007` - HOT_COLD_TOO_CLOSE | MEDIUM | å†·çƒ­æ°´ç®¡è·ç¦»è¿‡è¿‘ | ä¿æŒâ‰¥50mmé—´è· |
| `W008` - EXCESSIVE_VELOCITY | HIGH | æµé€Ÿè¿‡å¤§ | å¢å¤§ç®¡å¾„ |
| `W009` - DRAINAGE_CONFLICT | MEDIUM | ç»™æ’æ°´è·ç¦»ä¸è¶³ | ä¿æŒâ‰¥150mmé—´è· |
| `W010` - MISSING_SLEEVE | MEDIUM | ç¼ºå°‘ç©¿å¢™å¥—ç®¡ | å®‰è£…ä¿æŠ¤å¥—ç®¡ |

### 22.3 ç»¼åˆé”™è¯¯ä»£ç 

| é”™è¯¯ä»£ç  | ä¸¥é‡ç¨‹åº¦ | è¯´æ˜ | è§£å†³æ–¹æ¡ˆ |
|---------|---------|------|---------|
| `C001` - PATH_DISCONTINUITY | CRITICAL | è·¯å¾„ä¸è¿ç»­ | æ£€æŸ¥è·¯å¾„è¿æ¥ç‚¹ |
| `C002` - OBSTACLE_COLLISION | HIGH | éšœç¢ç‰©ç¢°æ’ | è°ƒæ•´è·¯å¾„é¿è®© |
| `C003` - SAFETY_DISTANCE_VIOLATED | HIGH | å®‰å…¨è·ç¦»ä¸è¶³ | å¢åŠ é—´è· |
| `C004` - CONSTRUCTION_INFEASIBLE | HIGH | æ–½å·¥ä¸å¯è¡Œ | é‡æ–°è§„åˆ’è·¯å¾„ |
| `C005` - COST_TOO_HIGH | LOW | æˆæœ¬è¿‡é«˜ | ä¼˜åŒ–è·¯å¾„é™ä½ææ–™ç”¨é‡ |

---

## 23. éªŒè¯è§„åˆ™é…ç½®

### 23.1 è§„åˆ™é…ç½®æ–‡ä»¶

```json
{
  "validationRules": {
    "electrical": {
      "maxCircuitLength": {
        "lighting": 30000,
        "socket": 25000,
        "dedicated": 20000
      },
      "cableSpec": {
        "1.5mmÂ²": { "maxCurrent": 15, "minBreaker": 10, "maxBreaker": 16 },
        "2.5mmÂ²": { "maxCurrent": 20, "minBreaker": 16, "maxBreaker": 20 },
        "4mmÂ²": { "maxCurrent": 27, "minBreaker": 20, "maxBreaker": 32 },
        "6mmÂ²": { "maxCurrent": 34, "minBreaker": 25, "maxBreaker": 40 }
      },
      "safetyDistance": {
        "toWeak": 300,
        "toWater": 100,
        "toGas": 500,
        "toCabinet": 50
      }
    },
    "plumbing": {
      "pipeVelocity": {
        "min": 0.5,
        "max": 2.0
      },
      "drainageSlope": {
        "DN50": { "min": 2.5, "max": 5.0 },
        "DN75": { "min": 2.0, "max": 4.0 },
        "DN100": { "min": 1.5, "max": 3.5 },
        "DN110": { "min": 1.2, "max": 3.0 }
      },
      "minPressure": 150000,
      "pTrapMinHeight": 50,
      "safetyDistance": {
        "toDrainage": 150,
        "toCabinet": 30
      }
    },
    "construction": {
      "maxSlotDepthRatio": 0.33,
      "minWallCrossingHeight": 300,
      "minCrossingSpacing": 500,
      "allowedAngles": [0, 90, 180, 270]
    }
  }
}
```

### 23.2 è‡ªå®šä¹‰è§„åˆ™æ‰©å±•

```javascript
class CustomValidationRule {
  constructor(name, validator, severity) {
    this.name = name;
    this.validator = validator;
    this.severity = severity;
  }
  
  validate(context) {
    return this.validator(context);
  }
}

// ç¤ºä¾‹ï¼šæ·»åŠ è‡ªå®šä¹‰è§„åˆ™
const customRule = new CustomValidationRule(
  "å¨æˆ¿æ’åº§é«˜åº¦æ£€æŸ¥",
  (context) => {
    const sockets = context.getSockets().filter(s => s.room === "å¨æˆ¿");
    const violations = [];
    
    for (const socket of sockets) {
      // å¨æˆ¿å°é¢æ’åº§åº”åœ¨1000-1200mmé«˜åº¦
      if (socket.height < 1000 || socket.height > 1200) {
        violations.push({
          socket: socket.id,
          height: socket.height,
          message: `æ’åº§é«˜åº¦${socket.height}mmä¸åœ¨æ¨èèŒƒå›´1000-1200mm`
        });
      }
    }
    
    return {
      valid: violations.length === 0,
      violations: violations
    };
  },
  "MEDIUM"
);

// æ³¨å†Œè‡ªå®šä¹‰è§„åˆ™
validationEngine.registerRule(customRule);
```

---

## 24. FAQå¸¸è§é—®é¢˜

### Q1: æ°´ç”µè‡ªæ£€ç³»ç»Ÿä½•æ—¶æ‰§è¡ŒéªŒè¯ï¼Ÿ

**A**: ä¸‰ä¸ªæ—¶æœºè‡ªåŠ¨è§¦å‘éªŒè¯ï¼š

1. **å®æ—¶éªŒè¯** - ç”¨æˆ·æ·»åŠ ç‚¹ä½æˆ–ä¿®æ”¹å‚æ•°æ—¶ï¼ˆ100mså†…åé¦ˆï¼‰
2. **ä¿å­˜éªŒè¯** - ç”¨æˆ·ä¿å­˜è®¾è®¡æ—¶ï¼ˆå…¨é¢æ£€æŸ¥ï¼‰
3. **ç”ŸæˆéªŒè¯** - ç”Ÿæˆæ–½å·¥å›¾å‰ï¼ˆæœ€ä¸¥æ ¼æ£€æŸ¥ï¼‰

### Q2: å¦‚ä½•å¤„ç†éªŒè¯å¤±è´¥çš„æƒ…å†µï¼Ÿ

**A**: åˆ†çº§å¤„ç†ç­–ç•¥ï¼š

- ğŸ”´ **CRITICALï¼ˆä¸¥é‡ï¼‰** - é˜»æ­¢ä¿å­˜ï¼Œå¿…é¡»ä¿®å¤
  - ç¤ºä¾‹ï¼šç©¿æ‰¿é‡å¢™ã€å›è·¯ä¸¥é‡è¿‡è½½
  
- ğŸŸ  **HIGHï¼ˆé«˜ï¼‰** - å¼ºçƒˆè­¦å‘Šï¼Œå»ºè®®ä¿®å¤
  - ç¤ºä¾‹ï¼šè´Ÿè½½æ¥è¿‘æ»¡è½½ã€å®‰å…¨è·ç¦»ç•¥ä¸è¶³
  
- ğŸŸ¡ **MEDIUMï¼ˆä¸­ï¼‰** - ä¸€èˆ¬è­¦å‘Šï¼Œå¯é€‰æ‹©å¿½ç•¥
  - ç¤ºä¾‹ï¼šè·¯å¾„ä¸å¤Ÿä¼˜åŒ–ã€æ–½å·¥éš¾åº¦è¾ƒå¤§
  
- ğŸŸ¢ **LOWï¼ˆä½ï¼‰** - ä¼˜åŒ–å»ºè®®ï¼Œä¸å½±å“åŠŸèƒ½
  - ç¤ºä¾‹ï¼šæˆæœ¬å¯è¿›ä¸€æ­¥é™ä½

### Q3: æŸœä½“é¿è®©æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ

**A**: ä¸‰æ­¥é¿è®©ç­–ç•¥ï¼š

1. **æŸœä½“è¯†åˆ«** - ä»åœºæ™¯ä¸­è·å–æ‰€æœ‰æŸœä½“ä½œä¸ºéšœç¢ç‰©
2. **ç¢°æ’æ£€æµ‹** - ä½¿ç”¨AABBç®—æ³•æ£€æµ‹ç®¡çº¿æ˜¯å¦ç©¿è¿‡æŸœä½“
3. **è·¯å¾„é‡è§„åˆ’** - å¦‚æœç¢°æ’ï¼Œä½¿ç”¨A*ç®—æ³•é‡æ–°è§„åˆ’é¿è®©è·¯å¾„

**æºç è¯æ®**ï¼š
- æŸœä½“ä½œä¸ºéšœç¢ç‰©ï¼š[`todo/concealed-work-cabinet-integration-complete.md:62-76`](todo/concealed-work-cabinet-integration-complete.md:62)

### Q4: æ°´å‹è®¡ç®—å‡†ç¡®å—ï¼Ÿ

**A**: åŸºäº**ä¼¯åŠªåˆ©æ–¹ç¨‹**çš„å·¥ç¨‹çº§è®¡ç®—ï¼š

```
ç²¾åº¦è¯„ä¼°ï¼š
- é«˜åº¦æŸå¤±ï¼š100%å‡†ç¡®ï¼ˆÏghå…¬å¼ï¼‰
- æ²¿ç¨‹é˜»åŠ›ï¼š90%å‡†ç¡®ï¼ˆDarcy-Weisbachå…¬å¼ï¼Œéœ€è¦å®æµ‹æ‘©æ“¦ç³»æ•°ï¼‰
- å±€éƒ¨é˜»åŠ›ï¼š85%å‡†ç¡®ï¼ˆç»éªŒç³»æ•°ï¼Œä¸åŒç®¡ä»¶æœ‰å·®å¼‚ï¼‰
```

