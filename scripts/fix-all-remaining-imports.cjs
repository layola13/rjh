const fs = require('fs'); const path = require('path');  const manualMappings = {   './14908': './Module84236',   './71373': './ModuleReExports',   './57678': './ReExport57678',   './746362': './HSRender',   './41861': '../utils/Logger', };  function buildMappingsFromFiles(modulesDir) {   const files = fs.readdirSync(modulesDir).filter(f => f.endsWith('.ts') || f.endsWith('.d.ts'));   const additionalMappings = {};      files.forEach(fileName => {     const filePath = path.join(modulesDir, fileName);     try {       const content = fs.readFileSync(filePath, 'utf-8');       const reExportMatch = content.match(/export\s+[*{][^}]*from\s+['"]\.\/([\d]+)['"]/);       if (reExportMatch) {         const number = reExportMatch[1];         const moduleName = fileName.replace(/\.(d\.ts|ts)$/, '');         additionalMappings['./'+number] = './'+moduleName;         console.log('发现映射: ./'+number+' -> ./'+moduleName);       }     } catch (error) {}   });   return additionalMappings; }  function fixImportsInFile(filePath, allMappings) {   try {     const content = fs.readFileSync(filePath, 'utf-8');     let newContent = content;     let modified = false;      for (const [oldPath, newPath] of Object.entries(allMappings)) {       const regex = new RegExp('(from\\s+)(['"])' + oldPath.replace(/[./]/g, '\\$&') + '\\2', 'g');       if (regex.test(content)) {         newContent = newContent.replace(regex, ''+newPath+'');         modified = true;         console.log('  '+path.basename(filePath)+': '+oldPath+' -> '+newPath);       }     }      if (modified) {       fs.writeFileSync(filePath, newContent, 'utf-8');       return true;     }     return false;   } catch (error) {     return false;   } }  function processDirectory(dirPath, allMappings) {   const entries = fs.readdirSync(dirPath, { withFileTypes: true });   let fixedCount = 0;   for (const entry of entries) {     const fullPath = path.join(dirPath, entry.name);     if (entry.isDirectory()) {       fixedCount += processDirectory(fullPath, allMappings);     } else if (entry.isFile() && /\.(ts|tsx)$/.test(entry.name)) {       if (fixImportsInFile(fullPath, allMappings)) {         fixedCount++;       }     }   }   return fixedCount; }  const modulesDir = path.join(__dirname, '../source/core/modules'); console.log('构建映射...\n'); const autoMappings = buildMappingsFromFiles(modulesDir); const allMappings = { ...autoMappings, ...manualMappings }; console.log('\n总共 '+Object.keys(allMappings).length+' 个映射\n'); const fixedCount = processDirectory(modulesDir, allMappings); console.log('\n修复了 '+fixedCount+' 个文件'); 